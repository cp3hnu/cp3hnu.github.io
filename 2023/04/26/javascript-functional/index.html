<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript 函数式编程 | Study &amp; Product</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="《Mostly Adequate Guide to Functional Programming》学习笔记">
    <meta name="algolia-site-verification" content="23333450F18E92C1">
    
    <link rel="preload" href="/assets/css/0.styles.cd1f7b12.css" as="style"><link rel="preload" href="/assets/js/app.b07256e7.js" as="script"><link rel="preload" href="/assets/js/34.49b71b2c.js" as="script"><link rel="preload" href="/assets/js/3.276926dd.js" as="script"><link rel="preload" href="/assets/js/26.5ce52eaa.js" as="script"><link rel="prefetch" href="/assets/js/10.7c5bc6fc.js"><link rel="prefetch" href="/assets/js/100.f675d046.js"><link rel="prefetch" href="/assets/js/101.92ede1ec.js"><link rel="prefetch" href="/assets/js/102.678a907d.js"><link rel="prefetch" href="/assets/js/103.959ad108.js"><link rel="prefetch" href="/assets/js/104.b15677eb.js"><link rel="prefetch" href="/assets/js/105.377da8a5.js"><link rel="prefetch" href="/assets/js/106.29a8c44d.js"><link rel="prefetch" href="/assets/js/107.64b19904.js"><link rel="prefetch" href="/assets/js/108.a3e75a67.js"><link rel="prefetch" href="/assets/js/109.283d92d8.js"><link rel="prefetch" href="/assets/js/11.e6a0311f.js"><link rel="prefetch" href="/assets/js/110.cbb6ea81.js"><link rel="prefetch" href="/assets/js/111.252f143f.js"><link rel="prefetch" href="/assets/js/112.df62c9fe.js"><link rel="prefetch" href="/assets/js/113.66189350.js"><link rel="prefetch" href="/assets/js/114.890cd7de.js"><link rel="prefetch" href="/assets/js/115.53823707.js"><link rel="prefetch" href="/assets/js/116.caaa6eaa.js"><link rel="prefetch" href="/assets/js/117.b7b0f88f.js"><link rel="prefetch" href="/assets/js/118.03168974.js"><link rel="prefetch" href="/assets/js/119.90f4d7b7.js"><link rel="prefetch" href="/assets/js/12.8da07182.js"><link rel="prefetch" href="/assets/js/120.b654e5ee.js"><link rel="prefetch" href="/assets/js/121.92d87086.js"><link rel="prefetch" href="/assets/js/13.a9f90626.js"><link rel="prefetch" href="/assets/js/14.b18d5210.js"><link rel="prefetch" href="/assets/js/15.835c7671.js"><link rel="prefetch" href="/assets/js/16.eb29ed80.js"><link rel="prefetch" href="/assets/js/17.c4871518.js"><link rel="prefetch" href="/assets/js/18.606b879c.js"><link rel="prefetch" href="/assets/js/19.777086a8.js"><link rel="prefetch" href="/assets/js/20.c8e69fcc.js"><link rel="prefetch" href="/assets/js/21.6cda2658.js"><link rel="prefetch" href="/assets/js/22.19e356e1.js"><link rel="prefetch" href="/assets/js/23.ca8661ea.js"><link rel="prefetch" href="/assets/js/24.9f090eaf.js"><link rel="prefetch" href="/assets/js/25.be2c8a0c.js"><link rel="prefetch" href="/assets/js/27.d75e1151.js"><link rel="prefetch" href="/assets/js/28.6863d7e4.js"><link rel="prefetch" href="/assets/js/29.d8a1c4f2.js"><link rel="prefetch" href="/assets/js/30.178b8dc0.js"><link rel="prefetch" href="/assets/js/31.4c488d0e.js"><link rel="prefetch" href="/assets/js/32.ce3ae3c7.js"><link rel="prefetch" href="/assets/js/33.828dd0d1.js"><link rel="prefetch" href="/assets/js/35.9496ed4c.js"><link rel="prefetch" href="/assets/js/36.33ada8e1.js"><link rel="prefetch" href="/assets/js/37.e9705ffe.js"><link rel="prefetch" href="/assets/js/38.f9c57096.js"><link rel="prefetch" href="/assets/js/39.75b77f83.js"><link rel="prefetch" href="/assets/js/4.c651aa9d.js"><link rel="prefetch" href="/assets/js/40.4496a5db.js"><link rel="prefetch" href="/assets/js/41.260393e3.js"><link rel="prefetch" href="/assets/js/42.083f9350.js"><link rel="prefetch" href="/assets/js/43.8d311a8e.js"><link rel="prefetch" href="/assets/js/44.df55763b.js"><link rel="prefetch" href="/assets/js/45.e19037c7.js"><link rel="prefetch" href="/assets/js/46.9529f37b.js"><link rel="prefetch" href="/assets/js/47.8d631e39.js"><link rel="prefetch" href="/assets/js/48.3acad59c.js"><link rel="prefetch" href="/assets/js/49.9a12a900.js"><link rel="prefetch" href="/assets/js/5.373c53f3.js"><link rel="prefetch" href="/assets/js/50.f30877b8.js"><link rel="prefetch" href="/assets/js/51.e8b2adf9.js"><link rel="prefetch" href="/assets/js/52.e6a458bb.js"><link rel="prefetch" href="/assets/js/53.e4027d0c.js"><link rel="prefetch" href="/assets/js/54.5a4be38d.js"><link rel="prefetch" href="/assets/js/55.924ee4f8.js"><link rel="prefetch" href="/assets/js/56.11ff1ccf.js"><link rel="prefetch" href="/assets/js/57.14327960.js"><link rel="prefetch" href="/assets/js/58.cea182b0.js"><link rel="prefetch" href="/assets/js/59.2db874c7.js"><link rel="prefetch" href="/assets/js/6.6878fac4.js"><link rel="prefetch" href="/assets/js/60.e3e4017b.js"><link rel="prefetch" href="/assets/js/61.d5cd385e.js"><link rel="prefetch" href="/assets/js/62.6929f93f.js"><link rel="prefetch" href="/assets/js/63.3f8bf719.js"><link rel="prefetch" href="/assets/js/64.e89e1572.js"><link rel="prefetch" href="/assets/js/65.a4335c65.js"><link rel="prefetch" href="/assets/js/66.cc9fb484.js"><link rel="prefetch" href="/assets/js/67.d5da8f2f.js"><link rel="prefetch" href="/assets/js/68.91a38f6d.js"><link rel="prefetch" href="/assets/js/69.800ca600.js"><link rel="prefetch" href="/assets/js/7.6f2558ea.js"><link rel="prefetch" href="/assets/js/70.f7b16ee7.js"><link rel="prefetch" href="/assets/js/71.e34929dc.js"><link rel="prefetch" href="/assets/js/72.175a64bf.js"><link rel="prefetch" href="/assets/js/73.c3dcfd4b.js"><link rel="prefetch" href="/assets/js/74.65978082.js"><link rel="prefetch" href="/assets/js/75.718d5152.js"><link rel="prefetch" href="/assets/js/76.2ed620b3.js"><link rel="prefetch" href="/assets/js/77.f8726387.js"><link rel="prefetch" href="/assets/js/78.1dea2e59.js"><link rel="prefetch" href="/assets/js/79.f62213a1.js"><link rel="prefetch" href="/assets/js/8.81ebcef8.js"><link rel="prefetch" href="/assets/js/80.7600ac29.js"><link rel="prefetch" href="/assets/js/81.ab94746f.js"><link rel="prefetch" href="/assets/js/82.26baf7f8.js"><link rel="prefetch" href="/assets/js/83.89a3942a.js"><link rel="prefetch" href="/assets/js/84.1a5577ac.js"><link rel="prefetch" href="/assets/js/85.eb62de22.js"><link rel="prefetch" href="/assets/js/86.7635121c.js"><link rel="prefetch" href="/assets/js/87.5bee4d72.js"><link rel="prefetch" href="/assets/js/88.04d56860.js"><link rel="prefetch" href="/assets/js/89.09a7d920.js"><link rel="prefetch" href="/assets/js/9.7f69b9b1.js"><link rel="prefetch" href="/assets/js/90.dac6a66e.js"><link rel="prefetch" href="/assets/js/91.14f101dd.js"><link rel="prefetch" href="/assets/js/92.d398eb09.js"><link rel="prefetch" href="/assets/js/93.7a5477fa.js"><link rel="prefetch" href="/assets/js/94.c4bf7674.js"><link rel="prefetch" href="/assets/js/95.a0c3c94c.js"><link rel="prefetch" href="/assets/js/96.c3a44db5.js"><link rel="prefetch" href="/assets/js/97.6956ed39.js"><link rel="prefetch" href="/assets/js/98.ad65fe08.js"><link rel="prefetch" href="/assets/js/99.4fe76e2f.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.cb5d1302.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd1f7b12.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Study &amp; Product </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Study &amp; Product </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper blog-page"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div itemprop="articleBody" class="content__default"><h1 id="javascript-函数式编程"><a href="#javascript-函数式编程" class="header-anchor">#</a> Javascript 函数式编程</h1> <h2 id="纯函数"><a href="#纯函数" class="header-anchor">#</a> 纯函数</h2> <h3 id="什么是纯函数"><a href="#什么是纯函数" class="header-anchor">#</a> 什么是纯函数</h3> <p>纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，例如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>任何时候调用 <code>add(1,2)</code> 得到的结果永远是 <code>3</code></p> <h3 id="什么是副作用"><a href="#什么是副作用" class="header-anchor">#</a> 什么是副作用</h3> <p>副作用是在计算结果的过程中，系统状态的一种变化，或者与外部世界进行的可观察的交互。</p> <p>副作用包含，但不限于：</p> <ul><li>更改文件系统</li> <li>往数据库插入记录</li> <li>发送一个 http 请求</li> <li>可变数据</li> <li>打印 log</li> <li>获取用户输入</li> <li>DOM 查询</li> <li>访问系统状态</li></ul> <p>概括来讲，只要是跟函数外部环境发生的交互就都是副作用。函数式编程的哲学就是假定副作用是造成不正当行为的主要原因。</p> <h3 id="纯函数的作用"><a href="#纯函数的作用" class="header-anchor">#</a> 纯函数的作用</h3> <h4 id="可缓存性"><a href="#可缓存性" class="header-anchor">#</a> 可缓存性</h4> <p>纯函数总能够根据输入来做缓存，实现缓存的一种典型方式是 memoize 技术</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> squareNumber  <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> x<span class="token operator">*</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//=&gt; 16</span>

<span class="token function">squareNumber</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从缓存中读取输入值为 4 的结果</span>
<span class="token comment">//=&gt; 16</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="自文档化"><a href="#自文档化" class="header-anchor">#</a> 自文档化</h4> <p>纯函数的依赖很明确，因此更易于观察和理解—没有偷偷摸摸的小动作</p> <h4 id="可移植性"><a href="#可移植性" class="header-anchor">#</a> 可移植性</h4> <p>可移植性可以意味着把函数序列化（serializing）并通过 socket 发送，也意味着代码能够在 web workers 中运行</p> <h4 id="可测试性"><a href="#可测试性" class="header-anchor">#</a> 可测试性</h4> <p>纯函数让测试更加容易，只需简单地给函数一个输入，然后断言输出就好了</p> <h4 id="合理性"><a href="#合理性" class="header-anchor">#</a> 合理性</h4> <p>由于纯函数总是能够根据相同的输入返回相同的输出，所以它们就能够保证总是返回同一个结果，这也就保证了引用透明性。我们可以使用一种叫做 <strong>等式推导</strong> 的技术来分析代码。</p> <h4 id="并行性"><a href="#并行性" class="header-anchor">#</a> 并行性</h4> <p>纯函数也不会因副作用而进入竞争态</p> <h2 id="柯里化-curry"><a href="#柯里化-curry" class="header-anchor">#</a> 柯里化 Curry</h2> <p>只传递给函数一部分参数来调用它，让它返回一个函数去处理剩下的参数。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> arity <span class="token operator">=</span> fn<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">$curry</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> arity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">$curry</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Curry 的应用非常广泛，例如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> match <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">what<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>what<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hasSpaces <span class="token operator">=</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// function(x) { return x.match(/\s+/g) }</span>

<span class="token function">hasSpaces</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ ' ' ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="组合-compose"><a href="#组合-compose" class="header-anchor">#</a> 组合 Compose</h2> <p>将多个函数组合，产生一个崭新的函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">compose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fns<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">...</span>res<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Compose 满足结合律</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就像搭积木一样，可以随心所欲地组合函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">,</span> head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> last <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> reverse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> angry <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>exclaim<span class="token punctuation">,</span> toUpperCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loudLastUpper <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>angry<span class="token punctuation">,</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="pointfree"><a href="#pointfree" class="header-anchor">#</a> Pointfree</h3> <p><strong>Pointfree</strong> 模式指的是函数无须提及将要操作的数据是什么样的（即不需要指明参数）。一等公民的函数、柯里化以及组合协作起来非常有助于实现这种模式。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 非 pointfree，因为提到了数据：word</span>
<span class="token keyword">const</span> <span class="token function-variable function">snakeCase</span> <span class="token operator">=</span> <span class="token parameter">word</span> <span class="token operator">=&gt;</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// pointfree</span>
<span class="token keyword">const</span> snakeCase <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> toLowerCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="debug"><a href="#debug" class="header-anchor">#</a> Debug</h3> <p>使用组合时，如果组合的函数很多，可能会导致错误（主要是传递的参数类型和函数想要的参数类型不一致），可以使用不纯的 <code>trace</code> 函数来追踪代码的执行情况。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> trace <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>来看一个例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">intercalate</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  toLower<span class="token punctuation">,</span>
  <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{2,}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token string">'The world is a vampire'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TypeError: Cannot read property 'apply' of undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>报错了，来 <code>trace</code> 一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">intercalate</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  toLower<span class="token punctuation">,</span>
  <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'after split'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{2,}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token string">'The world is a vampire'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// after split [ 'The', 'world', 'is', 'a', 'vampire' ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>哦，<code>toLower</code> 的参数是一个数组，所以需要先用 <code>map</code> 一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> dasherize <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">intercalate</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span>toLower<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s{2,}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token string">'The world is a vampire'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 'the-world-is-a-vampire'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="范畴学"><a href="#范畴学" class="header-anchor">#</a> 范畴学</h3> <p>在范畴学中，有一个概念叫做...范畴。有着以下这些组件（component）的搜集（collection）就构成了一个范畴：</p> <ul><li>对象的搜集</li> <li>态射的搜集</li> <li>态射的组合</li> <li>identity 这个独特的态射</li></ul> <h4 id="对象的搜集"><a href="#对象的搜集" class="header-anchor">#</a> 对象的搜集</h4> <p>对象就是数据类型，例如 <code>String</code>、<code>Boolean</code>、<code>Number</code> 和 <code>Object</code> 等</p> <h4 id="态射的搜集"><a href="#态射的搜集" class="header-anchor">#</a> 态射的搜集</h4> <p>态射是标准的、普通的纯函数。</p> <h4 id="态射的组合"><a href="#态射的组合" class="header-anchor">#</a> 态射的组合</h4> <p>就是 <code>compose</code></p> <h4 id="identity-这个独特的态射"><a href="#identity-这个独特的态射" class="header-anchor">#</a> identity 这个独特的态射</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">id</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>id</code> 函数跟组合一起使用简直完美。下面这个特性对所有的一元函数（接收一个参数的函数） <code>f</code> 都成立</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 结合律和同一律</span>
<span class="token function">compose</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> id<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="示例应用"><a href="#示例应用" class="header-anchor">#</a> 示例应用</h2> <h3 id="声明式-vs-命令式"><a href="#声明式-vs-命令式" class="header-anchor">#</a> 声明式 vs 命令式</h3> <ul><li><strong>命令式编程（Imperative）</strong>：详细的命令机器怎么（How）去处理一件事情以达到你想要的结果（What）；</li> <li><strong>声明式编程（ Declarative）</strong>：只告诉你想要的结果（What），机器自己摸索过程（How）</li></ul> <p><strong>声明式编程</strong>意味着我们要写表达式，而不是一步一步的指示。通过下面的列子，我们来体会一下<strong>声明式编程</strong>和<strong>命令式编程</strong>不同之处。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// imperative</span>
<span class="token keyword">const</span> <span class="token function-variable function">authenticate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">form</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">toUser</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">logIn</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// declarative</span>
<span class="token keyword">const</span> authenticate <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>logIn<span class="token punctuation">,</span> toUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="函数式-flickr-应用"><a href="#函数式-flickr-应用" class="header-anchor">#</a> 函数式 Flickr 应用</h3> <p>Flickr 应用将做 4 件事：</p> <ol><li>根据特定搜索关键字构造 url</li> <li>向 flickr 发送 api 请求</li> <li>把返回的 json 转为 html 图片</li> <li>把图片显示在屏幕上</li></ol> <p>下面是 Flickr 应用源代码，感受一下函数式编程</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 封装不纯的函数</span>
<span class="token keyword">const</span> Impure <span class="token operator">=</span> <span class="token punctuation">{</span>
  getJSON<span class="token operator">:</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  setHtml<span class="token operator">:</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  trace<span class="token operator">:</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> x<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 构造 flickr url</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">'api.flickr.com'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token string">'/services/feeds/photos_public.gne'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">query</span> <span class="token operator">=</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">?tags=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>t<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;format=json&amp;jsoncallback=?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">url</span> <span class="token operator">=</span> <span class="token parameter">t</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">query</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> prop <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">property<span class="token punctuation">,</span> object</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> object<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">img</span> <span class="token operator">=</span> <span class="token parameter">src</span> <span class="token operator">=&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;img /&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> src <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// image link -&gt; &lt;img&gt; tag</span>
<span class="token keyword">const</span> mediaUrl <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'media'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 解析 json response</span>
<span class="token keyword">const</span> mediaToImg <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> mediaUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 组合</span>
<span class="token keyword">const</span> images <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>mediaToImg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// json response -&gt; &lt;img&gt; tag</span>

<span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>Impure<span class="token punctuation">.</span><span class="token function">setHtml</span><span class="token punctuation">(</span><span class="token string">'#js-main'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> images<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// json response -&gt; 显示图片</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>Impure<span class="token punctuation">.</span><span class="token function">getJSON</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// url -&gt; json response</span>

<span class="token function">app</span><span class="token punctuation">(</span><span class="token string">'cats'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="hindley-milner-类型签名"><a href="#hindley-milner-类型签名" class="header-anchor">#</a> Hindley-Milner 类型签名</h2> <p>函数的类型签名，是很好的文档，同时通过函数的类型签名，能推测出这个函数的作用。下面是 <em>ramdajs</em> 的 <a href="https://ramdajs.com/docs/#filter" target="_blank" rel="noopener noreferrer"><code>filter</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的函数签名。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>filter <span class="token operator">:</span><span class="token operator">:</span> Filterable <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>a → Boolean<span class="token punctuation">)</span> → f a → f a
<span class="token keyword">const</span> filter <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> xs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> xs<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="容器-container"><a href="#容器-container" class="header-anchor">#</a> 容器 Container</h2> <h3 id="函子-functor"><a href="#函子-functor" class="header-anchor">#</a> 函子 Functor</h3> <p><strong>Functor</strong> 是实现了 <code>map</code> 函数并遵守一些特定规则的对象</p> <h3 id="identity"><a href="#identity" class="header-anchor">#</a> Identity</h3> <p><strong>Identity</strong> 可以装载任意类型的值，然后通过 <code>map</code> 来处理封装的值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Identity</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> constructor<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">two</span> <span class="token operator">=&gt;</span> two <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//=&gt; Identity(4)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="maybe"><a href="#maybe" class="header-anchor">#</a> Maybe</h3> <p><strong>Maybe</strong> 是另一种容器，调用  <code>map</code> 的时候会先判断值是不是 <code>null</code> 或者 <code>undefined</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Maybe</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Maybe</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">get</span> <span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isNothing <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// safeHead :: [a] -&gt; Maybe(a)</span>
<span class="token keyword">const</span> <span class="token function-variable function">safeHead</span> <span class="token operator">=</span> <span class="token parameter">xs</span> <span class="token operator">=&gt;</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>xs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// streetName :: Object -&gt; Maybe String</span>
<span class="token keyword">const</span> streetName <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'street'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> safeHead<span class="token punctuation">,</span> <span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'addresses'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">streetName</span><span class="token punctuation">(</span><span class="token punctuation">{</span> addresses<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Nothing</span>

<span class="token function">streetName</span><span class="token punctuation">(</span><span class="token punctuation">{</span> addresses<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> street<span class="token operator">:</span> <span class="token string">'Shady Ln.'</span><span class="token punctuation">,</span> number<span class="token operator">:</span> <span class="token number">4201</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Just('Shady Ln.')</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="释放容器里的值"><a href="#释放容器里的值" class="header-anchor">#</a> 释放容器里的值</h4> <p>如果我们想从 Maybe 容器返回一个自定义的值，然后还能继续执行后面的代码，可以借助一个帮助函数 <code>maybe</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//  maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</span>
<span class="token keyword">const</span> maybe <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> f<span class="token punctuation">,</span> m</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> v <span class="token operator">:</span> <span class="token function">f</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>__value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>maybe</code> 可以帮助我们避免普通命令式的 <code>if/else</code> 语句：<code>if(x !== null) { return f(x) }</code></p> <p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// withdraw :: Number -&gt; Account -&gt; Maybe(Account)</span>
<span class="token keyword">const</span> withdraw <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">amount<span class="token punctuation">,</span> <span class="token punctuation">{</span> balance <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>balance <span class="token operator">&gt;=</span> amount <span class="token operator">?</span> <span class="token punctuation">{</span> balance<span class="token operator">:</span> balance <span class="token operator">-</span> amount <span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// remainingBalance :: Account -&gt; String</span>
<span class="token keyword">const</span> <span class="token function-variable function">remainingBalance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> balance <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Your balance is $</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>balance<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// getTwenty :: Account -&gt; String</span>
<span class="token keyword">const</span> getTwenty <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">maybe</span><span class="token punctuation">(</span><span class="token string">'You are broke!'</span><span class="token punctuation">,</span> remainingBalance<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">withdraw</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getTwenty</span><span class="token punctuation">(</span><span class="token punctuation">{</span> balance<span class="token operator">:</span> <span class="token number">200.00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 'Your balance is $180.00'</span>

<span class="token function">getTwenty</span><span class="token punctuation">(</span><span class="token punctuation">{</span> balance<span class="token operator">:</span> <span class="token number">10.00</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 'You are broke!'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="either"><a href="#either" class="header-anchor">#</a> Either</h3> <p>使用 <strong>Either</strong> 代替 <code>throw/catch</code>，以一种平静温和的方式处理错误</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Either</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Right</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Left</span> <span class="token keyword">extends</span> <span class="token class-name">Either</span> <span class="token punctuation">{</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Right</span> <span class="token keyword">extends</span> <span class="token class-name">Either</span> <span class="token punctuation">{</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">left</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Left</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// either :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c</span>
<span class="token keyword">const</span> either <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> e<span class="token punctuation">.</span>isLeft <span class="token operator">?</span> <span class="token function">f</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>$value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">g</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'rain'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">b</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// Right('brain')</span>

<span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'rain'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">str</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">It's gonna </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, better bring your umbrella!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// Left('rain')</span>

Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">:</span> <span class="token number">80</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Right('localhost')</span>

<span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'rolls eyes...'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Left('rolls eyes...')</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="io"><a href="#io" class="header-anchor">#</a> IO</h3> <p><strong>IO</strong> 把非纯执行动作捕获到包裹函数里，目的是延迟执行这个非纯动作。这样做的目的是由用户决定什么时候执行这个非纯的动作。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">IO</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>unsafePerformIO <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>unsafePerformIO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// $ :: String -&gt; IO [DOM]</span>
<span class="token keyword">const</span> <span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token parameter">selector</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IO</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#myDiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">div</span> <span class="token operator">=&gt;</span> div<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unsafePerformIO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// I am some inner html</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="task"><a href="#task" class="header-anchor">#</a> Task</h3> <p><strong>Task</strong> 处理异步任务</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fork</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fork <span class="token operator">=</span> fork<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reject<span class="token punctuation">,</span> _</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reject<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token function">compose</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// -- Pure application -------------------------------------------------</span>
<span class="token comment">// blogPage :: Posts -&gt; HTML</span>
<span class="token keyword">const</span> blogPage <span class="token operator">=</span> Handlebars<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>blogTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// renderPage :: Posts -&gt; HTML</span>
<span class="token keyword">const</span> renderPage <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>blogPage<span class="token punctuation">,</span> <span class="token function">sortBy</span><span class="token punctuation">(</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// blog :: Params -&gt; Task Error HTML</span>
<span class="token keyword">const</span> blog <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>renderPage<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getJSON</span><span class="token punctuation">(</span><span class="token string">'/posts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// -- Impure calling code ----------------------------------------------</span>
<span class="token function">blog</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#error'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token parameter">page</span> <span class="token operator">=&gt;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#main'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="compose"><a href="#compose" class="header-anchor">#</a> Compose</h3> <p>组合多个 Functor</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> createCompose <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">F</span><span class="token punctuation">,</span> <span class="token constant">G</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">class</span> <span class="token class-name">Compose</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$value <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">static</span> <span class="token keyword">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Compose</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">(</span><span class="token constant">G</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Compose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Example</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TaskMaybe <span class="token operator">=</span> <span class="token function">createCompose</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span>of<span class="token punctuation">,</span> Maybe<span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> sayHi <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> TaskMaybe<span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token string">'cp3hnu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Task(Maybe('Hello cp3hnu'))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="定律"><a href="#定律" class="header-anchor">#</a> 定律</h3> <h4 id="同一律-identity"><a href="#同一律-identity" class="header-anchor">#</a> 同一律 identity</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">map</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">===</span> id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="组合-composition"><a href="#组合-composition" class="header-anchor">#</a> 组合 composition</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="其它"><a href="#其它" class="header-anchor">#</a> 其它</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span><span class="token constant">P</span><span class="token punctuation">.</span>of<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">P</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/javascript-functional-functor-1.24f3cba9.png" alt=""></p> <h2 id="单子-monad"><a href="#单子-monad" class="header-anchor">#</a> 单子 Monad</h2> <h3 id="指向函子-pointed-functor"><a href="#指向函子-pointed-functor" class="header-anchor">#</a> 指向函子 Pointed Functor</h3> <p><strong>Pointed Functor</strong> 是实现了 <code>of</code> 方法的 <strong>Functor</strong></p> <h3 id="单子-monad-2"><a href="#单子-monad-2" class="header-anchor">#</a> 单子 Monad</h3> <p><strong>Monad</strong> 是可以变扁（flatten）的 <strong>Pointed Functor</strong></p> <p><strong>Monad</strong> 是拥有 <code>of</code> 和 <code>chain</code> 函数的 <strong>Functor</strong></p> <h3 id="join"><a href="#join" class="header-anchor">#</a> <code>join</code></h3> <p>将相同类型的双层嵌套容器变扁，返回单层容器。</p> <p><code>join</code> 的实现很简单，我们用 Maybe 举例说明一下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Maybe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">join</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">;</span>

<span class="token comment">// join :: Monad m =&gt; m (m a) -&gt; m a</span>
<span class="token keyword">const</span> <span class="token function-variable function">join</span> <span class="token operator">=</span> <span class="token parameter">mma</span> <span class="token operator">=&gt;</span> mma<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="chain"><a href="#chain" class="header-anchor">#</a> <code>chain</code></h3> <p>和 <code>map</code> 类似，对容器里的数据进行转换。但是转换后的数据类型是容器类型，<code>map</code> 将行成双层嵌套容器，而 <code>chain</code> 会将双层嵌套容器变扁返回单层容器。<code>chain</code> 在很多语言里叫做 <code>flatMap</code>，比如 Swift.</p> <blockquote><p>这种方式只适用于两个相同类型的嵌套容器</p></blockquote> <p>可以使用 <code>map/join</code> 来实现 <code>chain</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Maybe</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">chain</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// chain :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</span>
<span class="token keyword">const</span> chain <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> m<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>

<span class="token comment">// chain :: Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b</span>
<span class="token keyword">const</span> <span class="token function-variable function">chain</span> <span class="token operator">=</span> <span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token function">compose</span><span class="token punctuation">(</span>join<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="各容器-join、-chain-的实现"><a href="#各容器-join、-chain-的实现" class="header-anchor">#</a> 各容器 <code>join</code>、 <code>chain</code> 的实现</h3> <p><a href="https://github.com/MostlyAdequate/mostly-adequate-guide/blob/master/appendix_b.md" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="定律-2"><a href="#定律-2" class="header-anchor">#</a> 定律</h3> <h4 id="结合律-associativity"><a href="#结合律-associativity" class="header-anchor">#</a> 结合律 associativity</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token function">compose</span><span class="token punctuation">(</span>join<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>join<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">compose</span><span class="token punctuation">(</span>join<span class="token punctuation">,</span> join<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/javascript-functional-monad-1.5f94e4a0.png" alt=""></p> <h4 id="同一律-identity-2"><a href="#同一律-identity-2" class="header-anchor">#</a> 同一律 identity</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span>join<span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span>join<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> id<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/javascript-functional-monad-2.262d44d6.png" alt=""></p> <h4 id="其它-2"><a href="#其它-2" class="header-anchor">#</a> 其它</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mcompose</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">chain</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// left identity</span>
<span class="token comment">// chain(M.of) === id </span>
<span class="token function">mcompose</span><span class="token punctuation">(</span><span class="token constant">M</span><span class="token punctuation">.</span>of<span class="token punctuation">,</span> f<span class="token punctuation">)</span> <span class="token operator">===</span> f<span class="token punctuation">;</span>

<span class="token comment">// right identity</span>
<span class="token comment">// compose(chain(f), M.of) === f;</span>
<span class="token function">mcompose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token constant">M</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span> <span class="token operator">===</span> f<span class="token punctuation">;</span>

<span class="token comment">// associativity</span>
<span class="token function">mcompose</span><span class="token punctuation">(</span><span class="token function">mcompose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">mcompose</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token function">mcompose</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="应用函子-applicative-functor"><a href="#应用函子-applicative-functor" class="header-anchor">#</a> 应用函子 Applicative Functor</h2> <h3 id="应用函子-applicative-functor-2"><a href="#应用函子-applicative-functor-2" class="header-anchor">#</a> 应用函子 Applicative Functor</h3> <p><strong>Applicative Functor</strong> 是实现了 <code>ap</code> 方法的 <strong>Pointed Functor</strong></p> <p><code>ap</code> 方法的目的是让两个容器相互应用，比如两个容器进行计算</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">add</span><span class="token punctuation">(</span>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// NAN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>要想实现这种运算可以使用 <code>ap</code> 方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Identity(5)</span>

<span class="token comment">// or</span>
<span class="token function">map</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Identity(5)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>ap</code> 方法的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Identity</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">ap</span> <span class="token operator">=</span> <span class="token parameter">otherIdentity</span> <span class="token operator">=&gt;</span> otherIdentity<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>ap</code> 方法遵循下面的规律</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此上面的运算也可以这样实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Identity(5)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="举个栗子"><a href="#举个栗子" class="header-anchor">#</a> 举个栗子</h3> <p>假设我们要创建一个旅游网站，既需要获取游客目的地的列表，还需要获取地方事件的列表。这两个请求就是相互独立的 api 调用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// Http.get :: String -&gt; Task Error HTML</span>

<span class="token keyword">var</span> renderPage <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">destinations<span class="token punctuation">,</span> events</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* render page */</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Task<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>renderPage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/destinations'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>Http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/events'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>两个请求将会同时立即执行，当两者的响应都返回之后，<code>renderPage</code> 就会被调用，类似于 <code>Promise.all</code></p> <h3 id="抬升-lift"><a href="#抬升-lift" class="header-anchor">#</a> 抬升 Lift</h3> <p>一个函数在调用的时候，如果被 <code>map</code> 包裹了，那么它就会从一个非 functor 函数转换为一个 functor 函数，我们把这个过程叫做 <strong>Lift</strong></p> <p>我们现在以一种 Pointfree 的方式调用 Applicative Functor</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> liftA2 <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">g<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> liftA3 <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">g<span class="token punctuation">,</span> f1<span class="token punctuation">,</span> f2<span class="token punctuation">,</span> f3</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f1<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>f3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// liftA4, etc</span>

<span class="token comment">// exmaple</span>
<span class="token function">liftA2</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Identity<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="各容器-ap-的实现"><a href="#各容器-ap-的实现" class="header-anchor">#</a> 各容器 <code>ap</code> 的实现</h3> <p><a href="https://github.com/MostlyAdequate/mostly-adequate-guide/blob/master/appendix_b.md" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="定律-3"><a href="#定律-3" class="header-anchor">#</a> 定律</h3> <h4 id="同一律-identity-3"><a href="#同一律-identity-3" class="header-anchor">#</a> 同一律 identity</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> v
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="同态-homomorphism"><a href="#同态-homomorphism" class="header-anchor">#</a> 同态 homomorphism</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="互换-interchange"><a href="#互换-interchange" class="header-anchor">#</a> 互换 interchange</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>v<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="组合-composition-2"><a href="#组合-composition-2" class="header-anchor">#</a> 组合 composition</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>compose<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">===</span> u<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">ap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="自然变换-natural-transformations"><a href="#自然变换-natural-transformations" class="header-anchor">#</a> 自然变换 Natural Transformations</h2> <p><strong>Natural Transformations</strong> 实现类型转换，解决多种不同类型容器嵌套的问题。例如下面的场景</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// getValue :: Selector -&gt; Task Error (Maybe String)</span>
<span class="token comment">// validate :: String -&gt; Either ValidationError String</span>
<span class="token comment">// postComment :: String -&gt; Task Error Comment</span>

<span class="token comment">// saveComment :: () -&gt; Task Error (Maybe (Either ValidationError (Task Error Comment)))</span>
<span class="token keyword">const</span> saveComment <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>postComment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>validate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">'#comment'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>多种类型容器嵌套，同时转换数据时要使用多个嵌套 <code>map</code> 方法</p> <h3 id="有原则的类型转换"><a href="#有原则的类型转换" class="header-anchor">#</a> 有原则的类型转换</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// idToMaybe :: Identity a -&gt; Maybe a</span>
<span class="token keyword">const</span> <span class="token function-variable function">idToMaybe</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// idToIO :: Identity a -&gt; IO a</span>
<span class="token keyword">const</span> <span class="token function-variable function">idToIO</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// eitherToTask :: Either a b -&gt; Task a b</span>
<span class="token keyword">const</span> eitherToTask <span class="token operator">=</span> <span class="token function">either</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span>rejected<span class="token punctuation">,</span> Task<span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ioToTask :: IO a -&gt; Task () a</span>
<span class="token keyword">const</span> <span class="token function-variable function">ioToTask</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reject<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">unsafePerform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// maybeToTask :: Maybe a -&gt; Task () a</span>
<span class="token keyword">const</span> <span class="token function-variable function">maybeToTask</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>isNothing <span class="token operator">?</span> Task<span class="token punctuation">.</span><span class="token function">rejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Task<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// arrayToMaybe :: [a] -&gt; Maybe a</span>
<span class="token keyword">const</span> <span class="token function-variable function">arrayToMaybe</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>在 JavaScript 里，并不能把异步变到同步，所以无法实现 <code>taskToIO</code> 方法，那是个&quot;超自然&quot;变换</p></blockquote> <h3 id="同构-isomorphic"><a href="#同构-isomorphic" class="header-anchor">#</a> 同构 Isomorphic</h3> <p>当把一个值前后怎么转换都不会丢失任何数据时，可称之为<strong>同构</strong>，Promise 和 Task 就是同构</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// promiseToTask :: Promise a b -&gt; Task a b</span>
<span class="token keyword">const</span> <span class="token function-variable function">promiseToTask</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reject<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>reject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// taskToPromise :: Task a b -&gt; Promise a b</span>
<span class="token keyword">const</span> <span class="token function-variable function">taskToPromise</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> x <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">taskToPromise</span><span class="token punctuation">(</span><span class="token function">promiseToTask</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> x<span class="token punctuation">;</span>

<span class="token keyword">const</span> y <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">promiseToTask</span><span class="token punctuation">(</span><span class="token function">taskToPromise</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> y<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="解决问题"><a href="#解决问题" class="header-anchor">#</a> 解决问题</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// getValue :: Selector -&gt; Task Error (Maybe String)</span>
<span class="token comment">// validate :: String -&gt; Either ValidationError String</span>
<span class="token comment">// postComment :: String -&gt; Task Error Comment</span>

<span class="token comment">// saveComment :: () -&gt; Task Error Comment</span>
<span class="token keyword">const</span> saveComment <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">chain</span><span class="token punctuation">(</span>postComment<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">chain</span><span class="token punctuation">(</span>eitherToTask<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span>validate<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">chain</span><span class="token punctuation">(</span>maybeToTask<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">'#comment'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="定律-4"><a href="#定律-4" class="header-anchor">#</a> 定律</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// nt :: (Functor f, Functor g) =&gt; f a -&gt; g a</span>
<span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span> nt<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">compose</span><span class="token punctuation">(</span>nt<span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><img src="/assets/img/javascript-functional-nt.1cb3b421.png"> <h2 id="遍历-traversing"><a href="#遍历-traversing" class="header-anchor">#</a> 遍历 Traversing</h2> <p>将嵌套的容器类型翻转</p> <h3 id="抛出问题"><a href="#抛出问题" class="header-anchor">#</a> 抛出问题</h3> <p>第一个问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// readFile :: FileName -&gt; Task Error String</span>

<span class="token comment">// firstWords :: String -&gt; String</span>
<span class="token keyword">const</span> firstWords <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">intercalate</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// tldr :: FileName -&gt; Task Error String</span>
<span class="token keyword">const</span> tldr <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>firstWords<span class="token punctuation">)</span><span class="token punctuation">,</span> readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">map</span><span class="token punctuation">(</span>tldr<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'file1'</span><span class="token punctuation">,</span> <span class="token string">'file2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [Task('hail the monarchy'), Task('smash the patriarchy')]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>List (Task)</code> 数据没有多大的意义，希望得到 <code>Task (List)</code>，要么失败，要么成功返回结果列表</p> <p>第二个问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// getAttribute :: String -&gt; Node -&gt; Maybe String</span>
<span class="token comment">// $ :: Selector -&gt; IO Node</span>

<span class="token comment">// getControlNode :: Selector -&gt; IO (Maybe (IO Node))</span>
<span class="token keyword">const</span> getControlNode <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-controls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  $
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>getControlNode</code> 的类型是 <code>IO (Maybe (IO))</code>，如果里面的 <code>Maybe (IO)</code> 能翻转类型成 <code>IO (Maybe)</code>，再利用 <code>join</code> 方法就能简化为 <code>IO (Maybe)</code></p> <h3 id="traversable-接口"><a href="#traversable-接口" class="header-anchor">#</a> Traversable 接口</h3> <p><code>Traversable</code> 接口有两个方法：<code>sequence</code> 和 <code>traverse</code></p> <p><code>sequence</code> 单纯地进行类型翻转； <code>traverse</code> 数据转换的同时进行类型翻转</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// sequence :: (Applicative f, Traversable t) =&gt; (a -&gt; f a) -&gt; t (f a) -&gt; f (t a)</span>
<span class="token keyword">const</span> sequence <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span><span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">sequence</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// traverse :: (Applicative f, Traversable t) =&gt; (a -&gt; f a) -&gt; (a -&gt; f b) -&gt; t a -&gt; f (t b)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">curry</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span><span class="token punctuation">,</span> fn<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>看看类型翻转的例子</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">sequence</span><span class="token punctuation">(</span>List<span class="token punctuation">.</span>of<span class="token punctuation">,</span> Maybe<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'the facts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [Just('the facts')]</span>
<span class="token function">sequence</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span>of<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> Task<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token operator">:</span> Task<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Task(Map({ a: 1, b: 2 }))</span>
<span class="token function">sequence</span><span class="token punctuation">(</span><span class="token constant">IO</span><span class="token punctuation">.</span>of<span class="token punctuation">,</span> Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'buckle my shoe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IO(Right('buckle my shoe'))</span>
<span class="token function">sequence</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span>of<span class="token punctuation">,</span> <span class="token punctuation">[</span>Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">'wing'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Right(['wing'])</span>
<span class="token function">sequence</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span>of<span class="token punctuation">,</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token string">'wing'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Task(Left('wing'))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>sequence</code> 的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Right</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sequence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数 of 被忽略了</span>
<span class="token class-name">Left</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sequence</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数 of 仅仅是为了在 map 不可用的情况下而被传入的，比如 Left</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>traverse</code> 的实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Right</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">traverse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span><span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="各容器-sequence、traverse-的实现"><a href="#各容器-sequence、traverse-的实现" class="header-anchor">#</a> 各容器 <code>sequence</code>、<code>traverse</code> 的实现</h3> <p><a href="https://github.com/MostlyAdequate/mostly-adequate-guide/blob/master/appendix_b.md" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="解决问题-2"><a href="#解决问题-2" class="header-anchor">#</a> 解决问题</h3> <p>第一个问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// readFile :: FileName -&gt; Task Error String</span>

<span class="token comment">// firstWords :: String -&gt; String</span>
<span class="token keyword">const</span> firstWords <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">intercalate</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// tldr :: FileName -&gt; Task Error String</span>
<span class="token keyword">const</span> tldr <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>firstWords<span class="token punctuation">)</span><span class="token punctuation">,</span> readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">traverse</span><span class="token punctuation">(</span>Task<span class="token punctuation">.</span>of<span class="token punctuation">,</span> tldr<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'file1'</span><span class="token punctuation">,</span> <span class="token string">'file2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Task(['hail the monarchy', 'smash the patriarchy']);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>第二个问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// getAttribute :: String -&gt; Node -&gt; Maybe String</span>
<span class="token comment">// $ :: Selector -&gt; IO Node</span>

<span class="token comment">// getControlNode :: Selector -&gt; IO (Maybe Node)</span>
<span class="token keyword">const</span> getControlNode <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span>
  <span class="token function">chain</span><span class="token punctuation">(</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token constant">IO</span><span class="token punctuation">.</span>of<span class="token punctuation">,</span> $<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-controls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  $
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="定律-5"><a href="#定律-5" class="header-anchor">#</a> 定律</h3> <h4 id="同一律-identity-4"><a href="#同一律-identity-4" class="header-anchor">#</a> 同一律 identity</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">sequence</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">A</span><span class="token punctuation">.</span>of

<span class="token function">traverse</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>of<span class="token punctuation">,</span> <span class="token constant">A</span><span class="token punctuation">.</span>of<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">A</span><span class="token punctuation">.</span>of<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="自然-naturality"><a href="#自然-naturality" class="header-anchor">#</a> 自然 naturality</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span><span class="token punctuation">,</span> nt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">compose</span><span class="token punctuation">(</span>nt<span class="token punctuation">,</span> <span class="token function">sequence</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">of</span><span class="token punctuation">,</span> nt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token function">sequence</span><span class="token punctuation">(</span><span class="token keyword">of</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">map</span><span class="token punctuation">(</span>nt<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="幺半群-monoid"><a href="#幺半群-monoid" class="header-anchor">#</a> 幺半群 Monoid</h2> <h3 id="半群-semigroup"><a href="#半群-semigroup" class="header-anchor">#</a> 半群 Semigroup</h3> <p>一个拥有 <code>concat</code> 函数的对象，其中<code>concat</code> 方法是满足结合律的二元运算。例如 <code>Array</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>让我们为加法实现这个方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Sum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	x<span class="token punctuation">,</span>
	<span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Sum</span><span class="token punctuation">(</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Sum(4)</span>
<span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Sum(41)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>还有很多</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Product</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Product</span><span class="token punctuation">(</span>x <span class="token operator">*</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Min</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Min</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> other<span class="token punctuation">.</span>x <span class="token operator">?</span> x <span class="token operator">:</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Max</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Max</span><span class="token punctuation">(</span>x <span class="token operator">&gt;</span> other<span class="token punctuation">.</span>x <span class="token operator">?</span> x <span class="token operator">:</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">Any</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Any</span><span class="token punctuation">(</span>x <span class="token operator">||</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">All</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">All</span><span class="token punctuation">(</span>x <span class="token operator">&amp;&amp;</span> other<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="functor-也可以是-semigroup"><a href="#functor-也可以是-semigroup" class="header-anchor">#</a> Functor 也可以是 Semigroup</h3> <p>当容器的值是 Semigroup 时，这个容器也是 Semigroup，例如 <code>Identity</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Identity</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">concat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Identity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$value<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>$value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>同样的，任何由 Semigroup 组成的对象同样也都是 Semigroup</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Analytics</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">clicks<span class="token punctuation">,</span> path<span class="token punctuation">,</span> idleTime</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
	clicks<span class="token punctuation">,</span>
	path<span class="token punctuation">,</span>
	idleTime<span class="token punctuation">,</span>
	<span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
		<span class="token function">Analytics</span><span class="token punctuation">(</span>
			clicks<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>clicks<span class="token punctuation">)</span><span class="token punctuation">,</span>
			path<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
			idleTime<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>idleTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="幺半群-monoid-2"><a href="#幺半群-monoid-2" class="header-anchor">#</a> 幺半群 Monoid</h3> <p><strong>Monoid</strong> = <strong>Semigroup</strong> + 一个特殊的单位元（Identity）</p> <h4 id="单位元-identity"><a href="#单位元-identity" class="header-anchor">#</a> 单位元 Identity</h4> <p>因为任一个数加 0 等于这个数本身，所以加法的单位元是 0。可以把这个单位元命名为 <code>empty</code></p> <p><strong>Monoid</strong> 来自以 <code>concat</code> 为态射，以 <code>empty</code> 为 identity 的单对象范畴</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Sum<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
Product<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
Min<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Min</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span>
Max<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">Infinity</span><span class="token punctuation">)</span>
Any<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
All<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">All</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
Array<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
String<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="单位元的作用"><a href="#单位元的作用" class="header-anchor">#</a> 单位元的作用</h4> <p>可以作为函数的缺省值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">settings</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">prefix<span class="token operator">=</span>String<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> overrides<span class="token operator">=</span>Array<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> total<span class="token operator">=</span>Sum<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以作为变量的默认值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>累加器初始值</p> <p>我们先来看一下累加器常见的错误</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// concat :: Semigroup s =&gt; s -&gt; s -&gt; s</span>
<span class="token keyword">const</span> <span class="token function-variable function">concat</span> <span class="token operator">=</span> <span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token parameter">y</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>concat<span class="token punctuation">)</span> 
<span class="token comment">// Sum(3)</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>concat<span class="token punctuation">)</span> 
<span class="token comment">// TypeError: Reduce of empty array with no initial value</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果 <code>reduce</code> 没有初始值时，当遇到一个空数组时，就会 Boom 💥</p> <p>让我们用柯里化的 <code>reduce</code> 写一个安全的函数，这个函数的 <code>empty</code> 不再是可选的，我们把它命名为 <code>fold</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// fold :: Monoid m =&gt; m -&gt; [m] -&gt; m</span>
<span class="token keyword">const</span> fold <span class="token operator">=</span> <span class="token function">reduce</span><span class="token punctuation">(</span>concat<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>初始的 <code>m</code> 是起始点 <code>empty</code> 值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fold</span><span class="token punctuation">(</span>Sum<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Sum(3)</span>
<span class="token function">fold</span><span class="token punctuation">(</span>Sum<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Sum(0)</span>

<span class="token function">fold</span><span class="token punctuation">(</span>Any<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Any(true)</span>
<span class="token function">fold</span><span class="token punctuation">(</span>Any<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Any(false)</span>

<span class="token function">fold</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>Max<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Right(Max(21))</span>
<span class="token function">fold</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>Max<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">'error retrieving value'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// Left('error retrieving value')</span>

<span class="token function">fold</span><span class="token punctuation">(</span><span class="token constant">IO</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'.link'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// IO([&lt;a&gt;, &lt;button class=&quot;link&quot;/&gt;, &lt;a&gt;])</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在最后的两个例子里，我们手动制造了一个 <code>empty</code> 值，因为我们没办法在类型上定义一个 <code>empty</code>，但是并无大碍。</p> <p>拥有类型的语言可以自己解决这个问题，在这例子里我们是自己传进去的</p> <h3 id="不能成为-monoid"><a href="#不能成为-monoid" class="header-anchor">#</a> 不能成为 Monoid</h3> <p>有一些 Semigroup 是不能变成 Monoid 的，因为他们没法提供初始值。例如 <code>First</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">First</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">other</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">First</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token function">First</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span> isPaid<span class="token operator">:</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> points<span class="token operator">:</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
	<span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token function">First</span><span class="token punctuation">(</span><span class="token number">2242</span><span class="token punctuation">)</span><span class="token punctuation">,</span> isPaid<span class="token operator">:</span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> points<span class="token operator">:</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token comment">// Map({id: First(123), isPaid: Any(true), points: Sum(14)})</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="组合-compose-作为-monoid"><a href="#组合-compose-作为-monoid" class="header-anchor">#</a> 组合 Compose 作为 Monoid</h3> <p>类型 <code>a -&gt; a</code> 的函数，它的定义域与值域在相同的集合内，称作<strong>自同态（endomorphisms）</strong></p> <p><code>Endo</code> 就是这样的 Monoid</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Endo</span> <span class="token operator">=</span> <span class="token parameter">run</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  run<span class="token punctuation">,</span>
  <span class="token function-variable function">concat</span><span class="token operator">:</span> <span class="token parameter">other</span> <span class="token operator">=&gt;</span>
    <span class="token function">Endo</span><span class="token punctuation">(</span><span class="token function">compose</span><span class="token punctuation">(</span>run<span class="token punctuation">,</span> other<span class="token punctuation">.</span>run<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Endo<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Endo</span><span class="token punctuation">(</span>identity<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Example</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// thingDownFlipAndReverse :: Endo [String] -&gt; [String]</span>
<span class="token keyword">const</span> thingDownFlipAndReverse <span class="token operator">=</span> <span class="token function">fold</span><span class="token punctuation">(</span>Endo<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">Endo</span><span class="token punctuation">(</span>reverse<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Endo</span><span class="token punctuation">(</span>sort<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Endo</span><span class="token punctuation">(</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'thing down'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

thingDownFlipAndReverse<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'let me work it'</span><span class="token punctuation">,</span> <span class="token string">'is it worth it?'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// ['thing down', 'let me work it', 'is it worth it?']</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="https://github.com/MostlyAdequate/mostly-adequate-guide" target="_blank" rel="noopener noreferrer">Mostly Adequate Guide to Functional Programming<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/llh911001/mostly-adequate-guide-chinese" target="_blank" rel="noopener noreferrer">Mostly Adequate Guide to Functional Programming 中文版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/hemanth/functional-programming-jargon" target="_blank" rel="noopener noreferrer">Functional Programming Jargon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/getify/Functional-Light-JS" target="_blank" rel="noopener noreferrer">Functional-Light-JS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://ramdajs.com/docs/#" target="_blank" rel="noopener noreferrer">ramdajs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/gcanti/fp-ts" target="_blank" rel="noopener noreferrer">fp-ts<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/origamitower/folktale" target="_blank" rel="noopener noreferrer">folktale<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/ReactiveX/rxjs" target="_blank" rel="noopener noreferrer">rxjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.mathsisfun.com/numbers/index.html" target="_blank" rel="noopener noreferrer">Math is Fun<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#纯函数" title="纯函数">纯函数</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#什么是纯函数" title="什么是纯函数">什么是纯函数</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#什么是副作用" title="什么是副作用">什么是副作用</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#纯函数的作用" title="纯函数的作用">纯函数的作用</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#柯里化-curry" title="柯里化 Curry">柯里化 Curry</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#组合-compose" title="组合 Compose">组合 Compose</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#pointfree" title="Pointfree">Pointfree</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#debug" title="Debug">Debug</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#范畴学" title="范畴学">范畴学</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#示例应用" title="示例应用">示例应用</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#声明式-vs-命令式" title="声明式 vs 命令式">声明式 vs 命令式</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#函数式-flickr-应用" title="函数式 Flickr 应用">函数式 Flickr 应用</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#hindley-milner-类型签名" title="Hindley-Milner 类型签名">Hindley-Milner 类型签名</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#容器-container" title="容器 Container">容器 Container</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#函子-functor" title="函子 Functor">函子 Functor</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#identity" title="Identity">Identity</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#maybe" title="Maybe">Maybe</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#either" title="Either">Either</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#io" title="IO">IO</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#task" title="Task">Task</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#compose" title="Compose">Compose</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#定律" title="定律">定律</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#单子-monad" title="单子 Monad">单子 Monad</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#指向函子-pointed-functor" title="指向函子 Pointed Functor">指向函子 Pointed Functor</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#单子-monad-2" title="单子 Monad">单子 Monad</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#join" title="join">join</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#chain" title="chain">chain</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#各容器-join、-chain-的实现" title="各容器 join、 chain 的实现">各容器 join、 chain 的实现</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#定律-2" title="定律">定律</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#应用函子-applicative-functor" title="应用函子 Applicative Functor">应用函子 Applicative Functor</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#应用函子-applicative-functor-2" title="应用函子 Applicative Functor">应用函子 Applicative Functor</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#举个栗子" title="举个栗子">举个栗子</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#抬升-lift" title="抬升 Lift">抬升 Lift</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#各容器-ap-的实现" title="各容器 ap 的实现">各容器 ap 的实现</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#定律-3" title="定律">定律</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#自然变换-natural-transformations" title="自然变换 Natural Transformations">自然变换 Natural Transformations</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#有原则的类型转换" title="有原则的类型转换">有原则的类型转换</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#同构-isomorphic" title="同构 Isomorphic">同构 Isomorphic</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#解决问题" title="解决问题">解决问题</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#定律-4" title="定律">定律</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#遍历-traversing" title="遍历 Traversing">遍历 Traversing</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#抛出问题" title="抛出问题">抛出问题</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#traversable-接口" title="Traversable 接口">Traversable 接口</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#各容器-sequence、traverse-的实现" title="各容器 sequence、traverse 的实现">各容器 sequence、traverse 的实现</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#解决问题-2" title="解决问题">解决问题</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#定律-5" title="定律">定律</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#幺半群-monoid" title="幺半群 Monoid">幺半群 Monoid</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#半群-semigroup" title="半群 Semigroup">半群 Semigroup</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#functor-也可以是-semigroup" title="Functor 也可以是 Semigroup">Functor 也可以是 Semigroup</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#幺半群-monoid-2" title="幺半群 Monoid">幺半群 Monoid</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#不能成为-monoid" title="不能成为 Monoid">不能成为 Monoid</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#组合-compose-作为-monoid" title="组合 Compose 作为 Monoid">组合 Compose 作为 Monoid</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#references" title="References">References</a></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b07256e7.js" defer></script><script src="/assets/js/34.49b71b2c.js" defer></script><script src="/assets/js/3.276926dd.js" defer></script><script src="/assets/js/26.5ce52eaa.js" defer></script>
  </body>
</html>
