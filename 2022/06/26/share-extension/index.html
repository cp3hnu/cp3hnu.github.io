<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Share Extension | Study &amp; Product</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="Share Extension 是 iOS 8 推出的一项扩展服务，为用户提供了一种方便的共享内容的方式，最常见的就是分享相册里的相片。">
    <meta name="algolia-site-verification" content="23333450F18E92C1">
    
    <link rel="preload" href="/assets/css/0.styles.cd1f7b12.css" as="style"><link rel="preload" href="/assets/js/app.b07256e7.js" as="script"><link rel="preload" href="/assets/js/34.49b71b2c.js" as="script"><link rel="preload" href="/assets/js/3.276926dd.js" as="script"><link rel="preload" href="/assets/js/18.606b879c.js" as="script"><link rel="prefetch" href="/assets/js/10.7c5bc6fc.js"><link rel="prefetch" href="/assets/js/100.f675d046.js"><link rel="prefetch" href="/assets/js/101.92ede1ec.js"><link rel="prefetch" href="/assets/js/102.678a907d.js"><link rel="prefetch" href="/assets/js/103.959ad108.js"><link rel="prefetch" href="/assets/js/104.b15677eb.js"><link rel="prefetch" href="/assets/js/105.377da8a5.js"><link rel="prefetch" href="/assets/js/106.29a8c44d.js"><link rel="prefetch" href="/assets/js/107.64b19904.js"><link rel="prefetch" href="/assets/js/108.a3e75a67.js"><link rel="prefetch" href="/assets/js/109.283d92d8.js"><link rel="prefetch" href="/assets/js/11.e6a0311f.js"><link rel="prefetch" href="/assets/js/110.cbb6ea81.js"><link rel="prefetch" href="/assets/js/111.252f143f.js"><link rel="prefetch" href="/assets/js/112.df62c9fe.js"><link rel="prefetch" href="/assets/js/113.66189350.js"><link rel="prefetch" href="/assets/js/114.890cd7de.js"><link rel="prefetch" href="/assets/js/115.53823707.js"><link rel="prefetch" href="/assets/js/116.caaa6eaa.js"><link rel="prefetch" href="/assets/js/117.b7b0f88f.js"><link rel="prefetch" href="/assets/js/118.03168974.js"><link rel="prefetch" href="/assets/js/119.90f4d7b7.js"><link rel="prefetch" href="/assets/js/12.8da07182.js"><link rel="prefetch" href="/assets/js/120.b654e5ee.js"><link rel="prefetch" href="/assets/js/121.92d87086.js"><link rel="prefetch" href="/assets/js/13.a9f90626.js"><link rel="prefetch" href="/assets/js/14.b18d5210.js"><link rel="prefetch" href="/assets/js/15.835c7671.js"><link rel="prefetch" href="/assets/js/16.eb29ed80.js"><link rel="prefetch" href="/assets/js/17.c4871518.js"><link rel="prefetch" href="/assets/js/19.777086a8.js"><link rel="prefetch" href="/assets/js/20.c8e69fcc.js"><link rel="prefetch" href="/assets/js/21.6cda2658.js"><link rel="prefetch" href="/assets/js/22.19e356e1.js"><link rel="prefetch" href="/assets/js/23.ca8661ea.js"><link rel="prefetch" href="/assets/js/24.9f090eaf.js"><link rel="prefetch" href="/assets/js/25.be2c8a0c.js"><link rel="prefetch" href="/assets/js/26.5ce52eaa.js"><link rel="prefetch" href="/assets/js/27.d75e1151.js"><link rel="prefetch" href="/assets/js/28.6863d7e4.js"><link rel="prefetch" href="/assets/js/29.d8a1c4f2.js"><link rel="prefetch" href="/assets/js/30.178b8dc0.js"><link rel="prefetch" href="/assets/js/31.4c488d0e.js"><link rel="prefetch" href="/assets/js/32.ce3ae3c7.js"><link rel="prefetch" href="/assets/js/33.828dd0d1.js"><link rel="prefetch" href="/assets/js/35.9496ed4c.js"><link rel="prefetch" href="/assets/js/36.33ada8e1.js"><link rel="prefetch" href="/assets/js/37.e9705ffe.js"><link rel="prefetch" href="/assets/js/38.f9c57096.js"><link rel="prefetch" href="/assets/js/39.75b77f83.js"><link rel="prefetch" href="/assets/js/4.c651aa9d.js"><link rel="prefetch" href="/assets/js/40.4496a5db.js"><link rel="prefetch" href="/assets/js/41.260393e3.js"><link rel="prefetch" href="/assets/js/42.083f9350.js"><link rel="prefetch" href="/assets/js/43.8d311a8e.js"><link rel="prefetch" href="/assets/js/44.df55763b.js"><link rel="prefetch" href="/assets/js/45.e19037c7.js"><link rel="prefetch" href="/assets/js/46.9529f37b.js"><link rel="prefetch" href="/assets/js/47.8d631e39.js"><link rel="prefetch" href="/assets/js/48.3acad59c.js"><link rel="prefetch" href="/assets/js/49.9a12a900.js"><link rel="prefetch" href="/assets/js/5.373c53f3.js"><link rel="prefetch" href="/assets/js/50.f30877b8.js"><link rel="prefetch" href="/assets/js/51.e8b2adf9.js"><link rel="prefetch" href="/assets/js/52.e6a458bb.js"><link rel="prefetch" href="/assets/js/53.e4027d0c.js"><link rel="prefetch" href="/assets/js/54.5a4be38d.js"><link rel="prefetch" href="/assets/js/55.924ee4f8.js"><link rel="prefetch" href="/assets/js/56.11ff1ccf.js"><link rel="prefetch" href="/assets/js/57.14327960.js"><link rel="prefetch" href="/assets/js/58.cea182b0.js"><link rel="prefetch" href="/assets/js/59.2db874c7.js"><link rel="prefetch" href="/assets/js/6.6878fac4.js"><link rel="prefetch" href="/assets/js/60.e3e4017b.js"><link rel="prefetch" href="/assets/js/61.d5cd385e.js"><link rel="prefetch" href="/assets/js/62.6929f93f.js"><link rel="prefetch" href="/assets/js/63.3f8bf719.js"><link rel="prefetch" href="/assets/js/64.e89e1572.js"><link rel="prefetch" href="/assets/js/65.a4335c65.js"><link rel="prefetch" href="/assets/js/66.cc9fb484.js"><link rel="prefetch" href="/assets/js/67.d5da8f2f.js"><link rel="prefetch" href="/assets/js/68.91a38f6d.js"><link rel="prefetch" href="/assets/js/69.800ca600.js"><link rel="prefetch" href="/assets/js/7.6f2558ea.js"><link rel="prefetch" href="/assets/js/70.f7b16ee7.js"><link rel="prefetch" href="/assets/js/71.e34929dc.js"><link rel="prefetch" href="/assets/js/72.175a64bf.js"><link rel="prefetch" href="/assets/js/73.c3dcfd4b.js"><link rel="prefetch" href="/assets/js/74.65978082.js"><link rel="prefetch" href="/assets/js/75.718d5152.js"><link rel="prefetch" href="/assets/js/76.2ed620b3.js"><link rel="prefetch" href="/assets/js/77.f8726387.js"><link rel="prefetch" href="/assets/js/78.1dea2e59.js"><link rel="prefetch" href="/assets/js/79.f62213a1.js"><link rel="prefetch" href="/assets/js/8.81ebcef8.js"><link rel="prefetch" href="/assets/js/80.7600ac29.js"><link rel="prefetch" href="/assets/js/81.ab94746f.js"><link rel="prefetch" href="/assets/js/82.26baf7f8.js"><link rel="prefetch" href="/assets/js/83.89a3942a.js"><link rel="prefetch" href="/assets/js/84.1a5577ac.js"><link rel="prefetch" href="/assets/js/85.eb62de22.js"><link rel="prefetch" href="/assets/js/86.7635121c.js"><link rel="prefetch" href="/assets/js/87.5bee4d72.js"><link rel="prefetch" href="/assets/js/88.04d56860.js"><link rel="prefetch" href="/assets/js/89.09a7d920.js"><link rel="prefetch" href="/assets/js/9.7f69b9b1.js"><link rel="prefetch" href="/assets/js/90.dac6a66e.js"><link rel="prefetch" href="/assets/js/91.14f101dd.js"><link rel="prefetch" href="/assets/js/92.d398eb09.js"><link rel="prefetch" href="/assets/js/93.7a5477fa.js"><link rel="prefetch" href="/assets/js/94.c4bf7674.js"><link rel="prefetch" href="/assets/js/95.a0c3c94c.js"><link rel="prefetch" href="/assets/js/96.c3a44db5.js"><link rel="prefetch" href="/assets/js/97.6956ed39.js"><link rel="prefetch" href="/assets/js/98.ad65fe08.js"><link rel="prefetch" href="/assets/js/99.4fe76e2f.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.cb5d1302.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd1f7b12.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Study &amp; Product </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Study &amp; Product </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper blog-page"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div itemprop="articleBody" class="content__default"><h1 id="share-extension"><a href="#share-extension" class="header-anchor">#</a> Share Extension</h1> <p>Share Extension 是 iOS 8 推出的一项扩展服务，为用户提供了一种方便的共享内容的方式，最常见的就是分享相册里的相片。</p> <blockquote><p>本文的样例代码在 <a href="https://gitee.com/cp3hnu/share-demo" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p><img src="/assets/img/share-extension-photos.70ce21ff.jpeg" alt=""></p> <h2 id="创建"><a href="#创建" class="header-anchor">#</a> 创建</h2> <p>在工程里添加一个 targets，选择 Share Extension，点击 &quot;next&quot;，一个 Share Extension 就创建好了</p> <p><img src="/assets/img/share-extension-create.4bea31d4.png" alt=""></p> <p>Xcode 自动创建了 3 个文件</p> <h5 id="shareviewcontroller"><a href="#shareviewcontroller" class="header-anchor">#</a> ShareViewController</h5> <p>主视图控制器，继承自 <a href="https://developer.apple.com/documentation/social/slcomposeserviceviewcontroller#" target="_blank" rel="noopener noreferrer">SLComposeServiceViewController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，提供了默认 UI：textView、取消按钮、发布按钮和图片预览 view。我们可以自定义 UI，这个将在后面介绍。</p> <p><img src="/assets/img/share-extension-default-ui.589d1d9f.jpeg" alt=""></p> <h5 id="maininterface-storyboard"><a href="#maininterface-storyboard" class="header-anchor">#</a> MainInterface.storyboard</h5> <p>主 Storyboard</p> <h5 id="info-plist"><a href="#info-plist" class="header-anchor">#</a> Info.plist</h5> <p>对 Extension 进行配置，下节进行详细讲解</p> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>这里主要介绍与 Share Extention 相关的 property list key，详情请参考 <a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AppExtensionKeys.html" target="_blank" rel="noopener noreferrer">App Extension Keys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>NSExtension</p> <ul><li><p>NSExtensionAttributes</p> <ul><li>NSExtensionActivationRule 见下文</li> <li>NSExtensionActivationDictionaryVersion - 确定怎样匹配 host 提供的 asset 类型和 extension 能处理的 asset 类型，1：只有 当 extension 能处理 host 提供的所有 asset 类型时，extension 才能被选中，2：只要 extension 能处理 host 提供的其中一种 asset 类型，extension 就能被选中</li> <li>NSExtensionActivationUsesStrictMatching - 严格（true）还是模糊（false）匹配 extension 能处理的 asset 类型</li></ul></li> <li><p>NSExtensionMainStoryboard - 指定 extension 的 storeboard 的文件名</p></li> <li><p>NSExtensionPointIdentifier - 指定 extension 支持的扩展点，对应 Share Extention 是 <code>com.apple.share-services</code></p></li> <li><p>NSExtensionPrincipalClass - 指定实现 extension 主要功能的自定义类的名称，与 <code>NSExtensionMainStoryboard</code> 互斥</p></li></ul> <h3 id="nsextensionactivationrule"><a href="#nsextensionactivationrule" class="header-anchor">#</a> NSExtensionActivationRule</h3> <p>确定 extension 能处理的 asset 类型和数量，Dictionary 或者 String 类型</p> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>NSExtensionActivationSupportsAttachmentsWithMaxCount</code></td> <td style="text-align:left;">支持的 attachment 数量的最大值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsAttachmentsWithMinCount</code></td> <td style="text-align:left;">支持的 attachment 数量的最小值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsFileWithMaxCount</code></td> <td style="text-align:left;">支持的 file 数量的最大值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsImageWithMaxCount</code></td> <td style="text-align:left;">支持的 image 数量的最大值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsMovieWithMaxCount</code></td> <td style="text-align:left;">支持的 video 数量的最大值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsText</code></td> <td style="text-align:left;">是否支持 text</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsWebURLWithMaxCount</code></td> <td style="text-align:left;">支持的 web url 数量的最大值</td></tr> <tr><td style="text-align:left;"><code>NSExtensionActivationSupportsWebPageWithMaxCount</code></td> <td style="text-align:left;">支持的 web page 数量的最大值</td></tr></tbody></table> <p><code>NSExtensionActivationRule</code> 除了可以设置这些预置的 key 之外，也可以设置字符串，详情请参考 <a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/ExtensionScenarios.html#//apple_ref/doc/uid/TP40014214-CH21-SW8" target="_blank" rel="noopener noreferrer">Declaring Supported Data Types for a Share or Action Extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><code>NSExtensionActivationRule</code> 的默认值是 <code>TRUEPREDICATE</code>，表示支持数量和类型没有限制，上架之前必须修改。</p> <h2 id="获取数据"><a href="#获取数据" class="header-anchor">#</a> 获取数据</h2> <p>Share Extension 使用 <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621411-extensioncontext#" target="_blank" rel="noopener noreferrer"><code>extensionContext</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来获取数据</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> attachments <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>extensionContext<span class="token operator">?</span><span class="token punctuation">.</span>inputItems<span class="token punctuation">.</span><span class="token builtin">first</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">NSExtensionItem</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>attachments <span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token keyword">let</span> provider <span class="token keyword">in</span> attachments <span class="token punctuation">{</span>
  <span class="token keyword">let</span> contentType <span class="token operator">=</span> <span class="token builtin">UTType</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>identifier
  <span class="token keyword">if</span> provider<span class="token punctuation">.</span><span class="token function">hasItemConformingToTypeIdentifier</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  provider<span class="token punctuation">.</span><span class="token function">loadItem</span><span class="token punctuation">(</span>forTypeIdentifier<span class="token punctuation">:</span> contentType<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
  	<span class="token keyword">guard</span> error <span class="token operator">==</span> <span class="token constant">nil</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> data <span class="token keyword">as</span><span class="token operator">?</span> <span class="token constant">URL</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span> 
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token function">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> url<span class="token punctuation">)</span>
    <span class="token keyword">return</span> data                                                               
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="文件类型判断"><a href="#文件类型判断" class="header-anchor">#</a> 文件类型判断</h2> <p>如果要指定 Share Extension 只能处理 PDF、Word 类型的文件，要怎么做呢？最好的方法是通过设置 <code>NSExtensionActivationRule</code> 指定 Share Extension 支持的文件类型，比如下面申明 Share Extension 只支持一个 PDF 文件</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token constant">SUBQUERY</span> <span class="token punctuation">(</span>
    extensionItems<span class="token punctuation">,</span>
    $extensionItem<span class="token punctuation">,</span>
    <span class="token constant">SUBQUERY</span> <span class="token punctuation">(</span>
        $extensionItem<span class="token punctuation">.</span>attachments<span class="token punctuation">,</span>
        $attachment<span class="token punctuation">,</span>
        <span class="token constant">ANY</span> $attachment<span class="token punctuation">.</span>registeredTypeIdentifiers <span class="token constant">UTI</span><span class="token operator">-</span><span class="token constant">CONFORMS</span><span class="token operator">-</span><span class="token constant">TO</span> <span class="token string">&quot;com.adobe.pdf&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>@<span class="token builtin">count</span> <span class="token operator">==</span> $extensionItem<span class="token punctuation">.</span>attachments<span class="token punctuation">.</span>@<span class="token builtin">count</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span>@<span class="token builtin">count</span> <span class="token operator">==</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>但是这个语法太生涩了，而且如果处理的类型太多，这个字符串也很长。还有一种办法是通过 <a href="https://developer.apple.com/documentation/foundation/nsitemprovider" target="_blank" rel="noopener noreferrer"><code>NSItemProvider</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://developer.apple.com/documentation/foundation/nsitemprovider/1403921-hasitemconformingtotypeidentifie#" target="_blank" rel="noopener noreferrer"><code>hasItemConformingToTypeIdentifier(_:)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 判断是否是自己需要的文件类型。比如下面指定 Share Extension 只能处理 图片、PDF 和 Word 类型的文件。</p> <blockquote><p><code>com.microsoft.word.doc</code> 是 .doc Word 文件</p> <p><code>org.openxmlformats.wordprocessingml.document</code> 是 .docx Word 文件</p> <p>要想指定文件的 Type Id 请参考 <a href="https://escapetech.eu/manuals/qdrop/uti.html" target="_blank" rel="noopener noreferrer">Uniform Type Identifiers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>如果在 <a href="https://escapetech.eu/manuals/qdrop/uti.html" target="_blank" rel="noopener noreferrer">Uniform Type Identifiers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 还没有找到，可以打印 <code>NSItemProvider</code> 的 <a href="https://developer.apple.com/documentation/foundation/nsitemprovider/1403923-registeredtypeidentifiers" target="_blank" rel="noopener noreferrer"><code>registeredTypeIdentifiers</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看</p> <p>比如 <a href="https://daringfireball.net/linked/2011/08/05/markdown-uti" target="_blank" rel="noopener noreferrer">Markdown<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文件的 Type Id 是 <code>net.daringfireball.markdown</code></p></blockquote> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">hasItemConformingToTypeIds</span><span class="token punctuation">(</span>provider<span class="token punctuation">:</span> <span class="token builtin">NSItemProvider</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">UTType</span><span class="token punctuation">.</span>image<span class="token punctuation">,</span> <span class="token builtin">UTType</span><span class="token punctuation">.</span>pdf<span class="token punctuation">,</span> <span class="token function">UTType</span><span class="token punctuation">(</span><span class="token string">&quot;com.microsoft.word.doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">UTType</span><span class="token punctuation">(</span><span class="token string">&quot;org.openxmlformats.wordprocessingml.document&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>compactMap <span class="token punctuation">{</span> $<span class="token number">0</span> <span class="token punctuation">}</span>
 <span class="token keyword">for</span> id <span class="token keyword">in</span> ids <span class="token punctuation">{</span>
    <span class="token keyword">if</span> provider<span class="token punctuation">.</span><span class="token function">hasItemConformingToTypeIdentifier</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="数据共享"><a href="#数据共享" class="header-anchor">#</a> 数据共享</h2> <p>虽然 Extension 嵌套在 Containing app 中，但是他们不能直接访问彼此的容器，为了 Extension 和 Containing app 能共享数据，需要创建特殊的共享容器。</p> <p><img src="/assets/img/share-extension-share-container.740e747a.png" alt=""></p> <h3 id="app-groups"><a href="#app-groups" class="header-anchor">#</a> App Groups</h3> <p>首先我们需要创建 App Groups。在 Extension 和 Containing app 中添加 <code>Capabilities</code> -&gt; <code>App Groups</code></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjIAAACNCAYAAACtz5DQAAABQmlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSCwoyGFhYGDIzSspCnJ3UoiIjFJgf8bAxiDNwMugysCRmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsismS8Xib0O+Z3isGeC5lHbD3yY6lEAV0pqcTKQ/gPESckFRSUMDIwJQLZyeUkBiN0CZIsUAR0FZM8AsdMh7DUgdhKEfQCsJiTIGci+AmQLJGckpgDZT4BsnSQk8XQkNtReEOAINDKxNAg3JOBU0kFJakUJiHbOL6gsykzPKFFwBIZQqoJnXrKejoKRgZERAwMovCGqP98AhyOjGAdCLCuGgcFMk4GBSRUhlhbBwLCvCOhlXYSYmhIDA3cqA8Oe2wWJRYlwBzB+YylOMzaCsLm3MzCwTvv//3M4AwM70My/1////739//+/yxgYmG8xMBz4BgCqy12xdqrrZAAAAFZlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA5KGAAcAAAASAAAARKACAAQAAAABAAACMqADAAQAAAABAAAAjQAAAABBU0NJSQAAAFNjcmVlbnNob3SMUOKAAAAB1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4xNDE8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NTYyPC9leGlmOlBpeGVsWERpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6VXNlckNvbW1lbnQ+U2NyZWVuc2hvdDwvZXhpZjpVc2VyQ29tbWVudD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cugn3QkAAB8CSURBVHgB7ZwJuFVV+Ye/OzAp8yggEJNM4ogIEmqSCoiUoWlhgqZYmmOlPpmWWqZp5YSB4T/IVP5KiCBIOWSgIhAEiAIKCDKjjMogcO/t/Jas4+Z4hnvuvdA++77f85y799lr2Gu9a5+9fvtb3755JTEzDAIQgAAEIAABCOQggfwcbDNNhgAEIAABCEAAAo4AQoYLAQIQgAAEIACBnCWAkMnZoaPhEIAABCAAAQggZLgGIAABCEAAAhDIWQIImZwdOhoOAQhAAAIQgABChmsAAhCAAAQgAIGcJYCQydmho+EQgAAEIAABCCBkuAYgAAEIQAACEMhZAgiZnB06Gg4BCEAAAhCAAEKGawACEIAABCAAgZwlgJDJ2aGj4RCAAAQgAAEIIGS4BiAAAQhAAAIQyFkCCJkKHLrdu3dXYG1UBQEIQAACEIBAJgKRFzJr1qyxM844wzp27GhLlizJxCPr9KKiInv44YftnHPOseOOO85OPfVU+/3vf286jkEAAhCAAAQgcHAJFJa3+u3bt1vt2rW/VM3evXvdsSpVqnwpLXjgs88+s02bNllxcXH8cM2aNa1u3bqWLi2eOcPOlClTbO3atS7XCy+8YB06dMhQIrvkkSNH2vDhw61x48b27W9/22bMmGGPPfaYlZSU2I9//OPsKiM3BCAAAQhAAAJZESiXR2bDhg325ptvmrweQZO4mTZtmi1evDh4OOn+iBEjnNDYunWrbdmyxZYvX27PPPOMrVy50h599FFbunSprV+/3pS+efNme/rpp23nzp1J60p2UOKlefPmTsBI1HibPXu29enTx+644w7nTZEn5f7773fJe/bscWnXX3+9DRkyxE4++WS75ppr7NNPP/XF49tx48aZhNfYsWPtzjvvNH0/+uijbf78+S7PqFGjXF1K69mzp7388suunhtvvNF69Ohhp59+uv3mN79xHhz1UW3y7Zg7d677/txzz1mmNs2ZM8cGDRpkXbt2tTPPPNOeffbZeBvZgQAEIAABCESVQLmETJMmTZxIePvtt+NiRp6YhQsXOl6tWrXKyG3Hjh3WrVs369KlixMvEkXdu3d33phjjjnGiYSZM2day5YtTd9btGjhJvWMFccyLFu2zC0nSRxoclfd8+bNc0UVz6LvEyZMcGmNGjUyiY6JEye6dKVNnTrV1AcJjpdeesnuueeeA0778ccfOxGm9jZr1swJLImt++67zwkkeZm2bdvmziNhd+GFF7r233zzzSZRNXjwYOvVq5eNGTPGiTbl13kl6GS+jV5ApWvTXXfdZRs3bjQJwxNPPNEJK1/ugEbzBQIQgAAEIBAhAuVeWpIHYN++fSYxIxGjZZxdu3bZSSedlHTJKRU7eXFUh5aUgrEs8sZIMMi7I8GQjckbI2vfvr3VqlXL7U+ePNnFsrgvsT+XXHKJyfNy7rnnOs+MPBt9+/Z1yccff7zzsmiZqHfv3qa0oHnBUadOHXf49ddft2uvvTaeZdasWfF9eV3ERLEzWn5S3fLySLxIME2fPt0Jm3iBFDup2lS/fn3HaPTo0U4YXnXVVU4EpqiGwxCAAAQgAIFIECiXR8YT0FKK4mQkNsoiYiQUJAaGDh1qbdu2NU3Kxx57rBMw8i7Im+JFjERTXl6eP3Xa7ZNPPunSb7vtNidW9OWJJ544IBDXx/BUrVrV5VX93nyazldYWOgEm0/TVt6a/Px80zKVyml56tVXX7VOnTpZjRo14uJJeevVq6eNEy7K68+n8ol1+7effJyRK7j/T6o2PfDAA3bTTTe59jzyyCM2cOBA590JlmUfAhCAAAQgEDUC5fbICIgmV3kbFNeioNdkwb+pwGlZSROvn6AlajSxn3LKKU7UaElHaQsWLHBVKE0xKZlMy1vy8uhNInlDZHfffbfzfAQ9JX/961+dF+iVV15xebR85U35HnroIRefI8+Q3kwKmsSIlosUtyMPyIABA0xxLYsWLbL+/fsnFVzqywknnGCqW+XWrVvnlp/OO+88J+aqVatmb7zxhotx8R6l4DmTtUlenVtuucVxUeyN+E+aNMn1X/FBGAQgAAEIQCCqBCpEyAiOJuh27dplzemss84yfZKZlnj8Mk+y9HTHfGDvFVdcYa1bt3ZZta8lHKX5c0pUPPjgg86T1K9fPzv//PPjHhuJIOVdsWKFde7c2RTbkmg//elP3ZLa+PHjXYCz0vW6t7xAqezee++16667zi1bSZjJ46TlrYKCAhs2bJiLl7n99tvttNNO+1IVydokr47igCTYFOOjsVCQsjxDGAQgAAEIQCDKBPJiHpCSKHcwVd8kaCRsJBjkVdFbQVoOkmlfnhmJKC3ZKGg2kxdIr4qvXr3aFACdKa9vkwKdJTr8MpM/ruU5xdIE6ylNmzSUiifS0pxEEQYBCEAAAhCIOoEK88jkGihN9NWrV3fLWNr3Isb3Q2kSGbKgoPDpiVstCSm+Jxs7/PDDk2ZPbIvPlKlNiuXR21cYBCAAAQhAoLIQqLQemcoywPQTAhCAAAQgEGUCFfLWUpQB0TcIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCCAkMkAiGQIQAACEIAABMJLACET3rGhZRCAAAQgAAEIZCBQmCGdZAhAAAIVRmD51hK7dGqxzVhXYnuLk1dbJfZ41aNZno0+O9/a1M1LnomjEIAABPYTwCPDpQABCBwSAiUlZkNeLLFpq2Mipih2ytj3ZB+lTV9VYoMnF5vKVHbbs2eP/fOf/7R58+YdMhTTpk2zTz/99KCfb9asWbZq1aoKPc/OnTtt9erVsWvni4tHx1577bUKPQ+VhYcAQiY8Y0FLIJCWwJYtW0yfXLV9MQ/MW2tif+SJSfEZ1jnPRvSJ3ZZi6bPWlpjKVHb79a9/bX/4wx9sw4YNhwzFz3/+c1u7du1BP9+YMWMqTGB89tln9pOf/MR69uxp3/nOd9z2X//6l+vDxx9/bDfffPNB6c/WrVutQ4cO7tOpUycbOHCg3XfffVZUJLWOHQoCCJlDQZlzRJ7Am2++aR07drQlS5ZUeF+XLVtm3/rWt6xPnz526qmn2oABA2zx4sUVfp6DXWFR7AF5377YWVKImOY182xk/wK7oOPnQqY4Ng+oTGW3hQsX2o033mhnn3125FAMHz7cvve971VIv+Rx+c9//uOE0fTp0x2z22+//QDPTIWcKKES7/l55513bP78+XbLLbfYSy+9ZBKg2KEhgJA5NJw5S8QJPP/8866HEydOrNCeyr1/1VVXuadLiaWZM2faKaecYldffbUVF+eWu8J5+lOIGImbUX0/vx1dPjmmYPbnC6wOHMD16aeftq997WvWvXt3++1vf2vnnXeeS3/mmWccm/79+9sVV1zhjv3ud7+z3r17u4/2vemYXz6RAL3oooviddxwww124YUX2rHHHms//OEP4/l8WW1V9tprr7UTTjjBvv71r1tw7FOds2/fvvaLX/zClVGbJ02aZGeccYadeOKJNnLkyGD1bl/j/O6779pNN91kDz74oFteuvTSS+P5xo4da/fcc4/7rglUnpTTTz/diV6xkL333nuOz/XXX2/HH3+8u542btxo8lZccsklLo/+vPLKK3Fm8YOxnffff9+++93v2nHHHWff//73bdOmTS5ZE7f6cPTRRzsvxKJFi9zxxDFIdX5lVntfeOEFV05s7rzzTjvppJPsggsusH//+9/uuK5zMdPxs846y375y1+6fC4x8GfdunXWpEkTq1u3rjs6aNAg58nyQkMeEnll1A+12y9ppeqHeIq7fm+PPfaYq1OesV69ejm+ugYTrWrVqi7/o48+ak8++aRt377dZXnxxRetX79+7npV+/1vV+f42c9+Fr8+dQ2p78ccc4xdd911tnfvXld+8uTJpmta18k111yT9HpMbEtl+o6QqUyjTV8PCoFdu3bZyy+/bLp5aWLyNymdTDev+++/392ENdkpXaab+/nnn+9urJostZ/My/LGG29YQUGBe7qsXr26HXbYYc59fuaZZ9pHH33k6tI5br31VjdJ6YlQdcu1rhu2tt5LNHr0aHvooYdcGf3RTfQf//hHvI5k7dTNX5OLbt5f/epX7fHHH4+XL9POfoEysH2e6eMFyw3d861vmzx7amGxPbc45obZny/ZOcRJrnuJBXFfuXKlaelAtmPHDps7d64TN3ra/9vf/uaejjW56qMnZR2T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" alt=""></p> <p>然后就可以使用 UserDefaults、FileManager 、Core Data、SQLite、<a href="https://developer.apple.com/documentation/foundation/nsfilecoordinator" target="_blank" rel="noopener noreferrer">NSFileCoordinator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 访问共享容器。这里我们介绍前面两种方式。</p> <h3 id="userdefaults"><a href="#userdefaults" class="header-anchor">#</a> UserDefaults</h3> <p>使用 UserDefaults 有文件大小的限制，在我的手机（iPhoneXR 15.5）提示不能超过 4M.</p> <blockquote><p>Attempting to store &gt;= 4194304 bytes of data in CFPreferences/NSUserDefaults on this platform is invalid. This is a bug in ImageShare or a library it uses.</p></blockquote> <h4 id="extension"><a href="#extension" class="header-anchor">#</a> Extension</h4> <p>保存数据</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> appGroupName <span class="token operator">=</span> <span class="token string">&quot;group.com.funnylearning.ShareDemo&quot;</span>
<span class="token keyword">let</span> userDefaults <span class="token operator">=</span> <span class="token function">UserDefaults</span><span class="token punctuation">(</span>suiteName<span class="token punctuation">:</span> appGroupName<span class="token punctuation">)</span>
userDefaults<span class="token operator">?</span><span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> forKey<span class="token punctuation">:</span> <span class="token string">&quot;imageData&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="containing-app"><a href="#containing-app" class="header-anchor">#</a> Containing app</h4> <p>读取数据</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> appGroupName <span class="token operator">=</span> <span class="token string">&quot;group.com.funnylearning.ShareDemo&quot;</span>
<span class="token keyword">let</span> userDefaults <span class="token operator">=</span> <span class="token function">UserDefaults</span><span class="token punctuation">(</span>suiteName<span class="token punctuation">:</span> appGroupName<span class="token punctuation">)</span>
<span class="token keyword">let</span> imageData <span class="token operator">=</span> userDefaults<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>forKey<span class="token punctuation">:</span> <span class="token string">&quot;imageData&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="filemanager"><a href="#filemanager" class="header-anchor">#</a> FileManager</h3> <h4 id="extension-2"><a href="#extension-2" class="header-anchor">#</a> Extension</h4> <p>保存数据</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> appGroupName <span class="token operator">=</span> <span class="token string">&quot;group.com.funnylearning.ShareDemo&quot;</span>
<span class="token keyword">let</span> documentsDirectory <span class="token operator">=</span> <span class="token builtin">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">containerURL</span><span class="token punctuation">(</span>forSecurityApplicationGroupIdentifier<span class="token punctuation">:</span> appGroupName<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> archiveURL <span class="token operator">=</span> documentsDirectory<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string">&quot;file.data&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> imageData<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> archiveURL<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Write data error =&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
 	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>更好的方式是使用 <a href="https://developer.apple.com/documentation/foundation/filemanager/1412957-copyitem#" target="_blank" rel="noopener noreferrer">copyItem(at:to:)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> fileManager <span class="token operator">=</span> <span class="token builtin">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> data <span class="token keyword">as</span><span class="token operator">?</span> <span class="token constant">URL</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
<span class="token keyword">guard</span> <span class="token keyword">let</span> documentsDirectory <span class="token operator">=</span> fileManager<span class="token punctuation">.</span><span class="token function">containerURL</span><span class="token punctuation">(</span>forSecurityApplicationGroupIdentifier<span class="token punctuation">:</span> appGroupName<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
                    
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> archiveURL <span class="token operator">=</span> documentsDirectory<span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string">&quot;file.data&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> fileManager<span class="token punctuation">.</span><span class="token function">fileExists</span><span class="token punctuation">(</span>atPath<span class="token punctuation">:</span> archiveURL<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> fileManager<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> archiveURL<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> fileManager<span class="token punctuation">.</span><span class="token function">copyItem</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> url<span class="token punctuation">,</span> to<span class="token punctuation">:</span> archiveURL<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;FileManager Error = &quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="containing-app-2"><a href="#containing-app-2" class="header-anchor">#</a> Containing App</h4> <p>读取数据</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">let</span> appGroupName <span class="token operator">=</span> <span class="token string">&quot;group.com.funnylearning.ShareDemo&quot;</span>
<span class="token keyword">let</span> documentsDirectory <span class="token operator">=</span> <span class="token builtin">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">containerURL</span><span class="token punctuation">(</span>forSecurityApplicationGroupIdentifier<span class="token punctuation">:</span> appGroupName<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">let</span> archiveURL <span class="token operator">=</span> documentsDirectory<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">appendingPathComponent</span><span class="token punctuation">(</span><span class="token string">&quot;file.data&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token builtin">FileManager</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">fileExists</span><span class="token punctuation">(</span>atPath<span class="token punctuation">:</span> archiveURL<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> imageData <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token function">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> archiveURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> imageData
		<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="打开-containing-app"><a href="#打开-containing-app" class="header-anchor">#</a> 打开 Containing App</h2> <p>iOS 只有 Today extension 和  iMessage app extension 通过 <a href="https://developer.apple.com/documentation/foundation/nsextensioncontext" target="_blank" rel="noopener noreferrer">NSExtensionContext<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的  <a href="https://developer.apple.com/documentation/foundation/nsextensioncontext/1416791-open#" target="_blank" rel="noopener noreferrer">open(_:completionHandler:)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 打开 Containing app，在 <a href="https://stackoverflow.com/questions/27506413/share-extension-to-open-containing-app#44499222" target="_blank" rel="noopener noreferrer">Stack Overflow<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上找到一个方法使别的 Extension 也能打开 Containing app.</p> <blockquote><p>在我的手机（iPhoneXR 15.5）上测试可行</p></blockquote> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">openURL</span><span class="token punctuation">(</span><span class="token function">URL</span><span class="token punctuation">(</span>string<span class="token punctuation">:</span> <span class="token string">&quot;myapp://com.myapp.share&quot;</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>

<span class="token atrule">@objc</span> <span class="token keyword">func</span> <span class="token function">openURL</span><span class="token punctuation">(</span><span class="token number">_</span> url<span class="token punctuation">:</span> <span class="token constant">URL</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> responder<span class="token punctuation">:</span> <span class="token builtin">UIResponder</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">self</span>
  <span class="token keyword">while</span> responder <span class="token operator">!=</span> <span class="token constant">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> application <span class="token operator">=</span> responder <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">UIApplication</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> application<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span>#<span class="token function">selector</span><span class="token punctuation">(</span><span class="token function">openURL</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> url<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">nil</span>
    <span class="token punctuation">}</span>
    responder <span class="token operator">=</span> responder<span class="token operator">?</span><span class="token punctuation">.</span>next
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="自定义-ui"><a href="#自定义-ui" class="header-anchor">#</a> 自定义 UI</h2> <p>如果不满意系统默认的 UI，我们可以自定义 UI。</p> <p>删除 Xcode 自动创建的 ShareViewController，创建一个新的 CustomViewController，设置 view。</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">import</span> <span class="token builtin">Foundation</span>
<span class="token keyword">import</span> <span class="token builtin">UIKit</span>
<span class="token keyword">import</span> <span class="token builtin">UniformTypeIdentifiers</span>

<span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">CustomViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">let</span> imgView <span class="token operator">=</span> <span class="token function">UIImageView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// MARK: - Init</span>
  <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    view<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token builtin">UIColor</span><span class="token punctuation">.</span>white
    <span class="token function">setupNaviBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">setupView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// MARK: - Setup</span>
<span class="token keyword">private</span> <span class="token keyword">extension</span> <span class="token builtin">CustomViewController</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function">setupNaviBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>navigationItem<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;Share Demo&quot;</span>
        
    <span class="token keyword">let</span> itemCancel <span class="token operator">=</span> <span class="token function">UIBarButtonItem</span><span class="token punctuation">(</span>barButtonSystemItem<span class="token punctuation">:</span> <span class="token punctuation">.</span>cancel<span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span>cancelAction<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>navigationItem<span class="token punctuation">.</span><span class="token function">setLeftBarButton</span><span class="token punctuation">(</span>itemCancel<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        
    <span class="token keyword">let</span> itemDone <span class="token operator">=</span> <span class="token function">UIBarButtonItem</span><span class="token punctuation">(</span>barButtonSystemItem<span class="token punctuation">:</span> <span class="token punctuation">.</span>done<span class="token punctuation">,</span> target<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> #<span class="token function">selector</span><span class="token punctuation">(</span>doneAction<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>navigationItem<span class="token punctuation">.</span><span class="token function">setRightBarButton</span><span class="token punctuation">(</span>itemDone<span class="token punctuation">,</span> animated<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">func</span> <span class="token function">setupView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    imgView<span class="token punctuation">.</span>contentMode <span class="token operator">=</span> <span class="token punctuation">.</span>scaleAspectFit
    view<span class="token punctuation">.</span><span class="token function">addSubview</span><span class="token punctuation">(</span>imgView<span class="token punctuation">)</span>   
    imgView<span class="token punctuation">.</span>translatesAutoresizingMaskIntoConstraints <span class="token operator">=</span> <span class="token boolean">false</span>
    
    imgView<span class="token punctuation">.</span>topAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> view<span class="token punctuation">.</span>safeAreaLayoutGuide<span class="token punctuation">.</span>topAnchor<span class="token punctuation">,</span> constant<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
    imgView<span class="token punctuation">.</span>leftAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> view<span class="token punctuation">.</span>safeAreaLayoutGuide<span class="token punctuation">.</span>leftAnchor<span class="token punctuation">,</span> constant<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
    imgView<span class="token punctuation">.</span>rightAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> view<span class="token punctuation">.</span>safeAreaLayoutGuide<span class="token punctuation">.</span>rightAnchor<span class="token punctuation">,</span> constant<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
    imgView<span class="token punctuation">.</span>bottomAnchor<span class="token punctuation">.</span><span class="token function">constraint</span><span class="token punctuation">(</span>equalTo<span class="token punctuation">:</span> view<span class="token punctuation">.</span>safeAreaLayoutGuide<span class="token punctuation">.</span>bottomAnchor<span class="token punctuation">,</span> constant<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token function">loadImageData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
    
  <span class="token atrule">@objc</span> <span class="token keyword">private</span> <span class="token keyword">func</span> cancelAction <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token function">NSError</span><span class="token punctuation">(</span>domain<span class="token punctuation">:</span> <span class="token string">&quot;some.bundle.identifier&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">NSLocalizedDescriptionKey</span><span class="token punctuation">:</span> <span class="token string">&quot;An error description&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    extensionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">cancelRequest</span><span class="token punctuation">(</span>withError<span class="token punctuation">:</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
    
  <span class="token atrule">@objc</span> <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">doneAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    extensionContext<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">completeRequest</span><span class="token punctuation">(</span>returningItems<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> completionHandler<span class="token punctuation">:</span> <span class="token constant">nil</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// MARK: - Private</span>
<span class="token keyword">private</span> <span class="token keyword">extension</span> <span class="token builtin">CustomViewController</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function">loadImageData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> attachments <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>extensionContext<span class="token operator">?</span><span class="token punctuation">.</span>inputItems<span class="token punctuation">.</span><span class="token builtin">first</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">NSExtensionItem</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>attachments <span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> provider <span class="token operator">=</span> attachments<span class="token punctuation">.</span><span class="token builtin">first</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
    <span class="token keyword">let</span> contentType <span class="token operator">=</span> <span class="token builtin">UTType</span><span class="token punctuation">.</span>image<span class="token punctuation">.</span>identifier
    <span class="token keyword">guard</span> provider<span class="token punctuation">.</span><span class="token function">hasItemConformingToTypeIdentifier</span><span class="token punctuation">(</span>contentType<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>
       
    provider<span class="token punctuation">.</span><span class="token function">loadItem</span><span class="token punctuation">(</span>forTypeIdentifier<span class="token punctuation">:</span> contentType<span class="token punctuation">,</span>
                          options<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">NSItemProviderPreferredImageSizeKey</span><span class="token punctuation">:</span> <span class="token function">CGSize</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
      <span class="token keyword">guard</span> <span class="token keyword">let</span> url <span class="token operator">=</span> data <span class="token keyword">as</span><span class="token operator">?</span> <span class="token constant">URL</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>   
      <span class="token keyword">do</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> imageData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token function">Data</span><span class="token punctuation">(</span>contentsOf<span class="token punctuation">:</span> url<span class="token punctuation">)</span>
        <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token function">UIImage</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> imageData<span class="token punctuation">)</span>
        <span class="token builtin">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>async <span class="token punctuation">{</span>
          <span class="token keyword">self</span><span class="token punctuation">.</span>imgView<span class="token punctuation">.</span>image <span class="token operator">=</span> image
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Read data error =&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>然后修改 MainInterface.storyboard 文件，添加 Navigation Controller，设置其 <code>rootViewController</code> 为 CustomViewController。运行效果如下：</p> <p><img src="/assets/img/share-extension-custom-ui.fe7c2445.jpeg" alt=""></p> <blockquote><p><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Share.html#//apple_ref/doc/uid/TP40014214-CH12-SW5" target="_blank" rel="noopener noreferrer">Design the UI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文档上说可以通过 <code>Auto Layout constraints</code> 或者 <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621476-preferredcontentsize" target="_blank" rel="noopener noreferrer"><code>preferredContentSize</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 调整 view 的高度，但是如果使用 Navigation Controller，UI 的高度不可调。</p></blockquote> <h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <p><a href="https://gitee.com/cp3hnu/share-demo" target="_blank" rel="noopener noreferrer">share-demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Share.html#//apple_ref/doc/uid/TP40014214-CH12-SW1" target="_blank" rel="noopener noreferrer">Share Extension<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AppExtensionKeys.html" target="_blank" rel="noopener noreferrer">App Extension Keys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://escapetech.eu/manuals/qdrop/uti.html" target="_blank" rel="noopener noreferrer">Uniform Type Identifiers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://medium.com/macoclock/ios-share-extension-swift-5-1-1606263746b" target="_blank" rel="noopener noreferrer">iOS Share extension — Swift 5.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/27506413/share-extension-to-open-containing-app#44499222" target="_blank" rel="noopener noreferrer">StackOverflow - Share Extension to open containing app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/ExtensibilityPG/Share.html#//apple_ref/doc/uid/TP40014214-CH12-SW5" target="_blank" rel="noopener noreferrer">Design the UI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://diamantidis.github.io/2020/01/11/share-extension-custom-ui" target="_blank" rel="noopener noreferrer">Custom UI for Share Extensions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/nixzhu/Wormhole" target="_blank" rel="noopener noreferrer">Wormhole<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#创建" title="创建">创建</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#配置" title="配置">配置</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#nsextensionactivationrule" title="NSExtensionActivationRule">NSExtensionActivationRule</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#获取数据" title="获取数据">获取数据</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#文件类型判断" title="文件类型判断">文件类型判断</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#数据共享" title="数据共享">数据共享</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#app-groups" title="App Groups">App Groups</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#userdefaults" title="UserDefaults">UserDefaults</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#filemanager" title="FileManager">FileManager</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#打开-containing-app" title="打开 Containing App">打开 Containing App</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#自定义-ui" title="自定义 UI">自定义 UI</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#demo" title="Demo">Demo</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#references" title="References">References</a></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b07256e7.js" defer></script><script src="/assets/js/34.49b71b2c.js" defer></script><script src="/assets/js/3.276926dd.js" defer></script><script src="/assets/js/18.606b879c.js" defer></script>
  </body>
</html>
