(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{362:function(t,e,a){t.exports=a.p+"assets/img/record-audio-permission.127ebcf4.jpeg"},363:function(t,e,a){t.exports=a.p+"assets/img/record-audio-web-audio-workflow.a2e421fe.png"},535:function(t,e,a){"use strict";a.r(e);var s=a(4),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"手机浏览器录音"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手机浏览器录音"}},[t._v("#")]),t._v(" 手机浏览器录音")]),t._v(" "),s("p",[t._v("今天我们来实现手机浏览器的录音功能，记录用户通过麦克风输入的语音，转存为音频文件，然后进行语言播放、语言聊天或者语言识别等。")]),t._v(" "),s("h2",{attrs:{id:"获取麦克风权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取麦克风权限"}},[t._v("#")]),t._v(" 获取麦克风权限")]),t._v(" "),s("p",[t._v("通过 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("navigator.mediaDevices")]),s("OutboundLink")],1),t._v(" 属性的 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("getUserMedia()")]),s("OutboundLink")],1),t._v(" 方法，请求获取麦克风权限。如果用户同意，将返回一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStream")]),s("OutboundLink")],1),t._v(" 对象 resolve promise，如果用户拒绝将返回 "),s("code",[t._v("NotAllowedError")]),t._v(" 的 reject promise。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserMedia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  audio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[s("img",{attrs:{src:a(362),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"开启-https"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启-https"}},[t._v("#")]),t._v(" 开启 HTTPS")]),t._v(" "),s("p",[t._v("如果你在 HTTP 服务里运行上面的代码，程序将报错，因为在 HTTP 服务里 "),s("code",[t._v("navigator.mediaDevices")]),t._v(" 为 "),s("code",[t._v("undefined")]),t._v("。从 MDN 文档得知，"),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaDevices")]),s("OutboundLink")],1),t._v(" 只能用于 HTTPS 服务")]),t._v(" "),s("blockquote",[s("p",[t._v("[!NOTE]")]),t._v(" "),s("p",[s("strong",[t._v("Secure context:")]),t._v(" This feature is available only in "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener noreferrer"}},[t._v("secure contexts"),s("OutboundLink")],1),t._v(" (HTTPS), in some or all "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#browser_compatibility",target:"_blank",rel:"noopener noreferrer"}},[t._v("supporting browsers"),s("OutboundLink")],1),t._v(".")])]),t._v(" "),s("p",[t._v("所以我们首先需要开启 HTTPS 服务。我这个 demo 是使用 "),s("a",{attrs:{href:"https://github.com/http-party/http-server",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("http-server")]),s("OutboundLink")],1),t._v(" 开启一个 HTTP 服务，"),s("a",{attrs:{href:"https://github.com/http-party/http-server",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("http-server")]),s("OutboundLink")],1),t._v(" 也可以开启一个 "),s("a",{attrs:{href:"https://github.com/http-party/http-server?tab=readme-ov-file#tlsssl",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTPS 服务"),s("OutboundLink")],1),t._v("，只需要一个 SSL 证书即可。申请 SSL 证书有很多种方法")]),t._v(" "),s("ul",[s("li",[t._v("去证书颁发机构申请证书，"),s("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Let’s Encrypt"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://zerossl.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("ZeroSSL"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://www.cloudflare.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloudflare"),s("OutboundLink")],1),t._v(" 是免费的证书颁发机构，适用于开发环境和生产环境，但是需要域名")]),t._v(" "),s("li",[t._v("使用工具生成本地证书，这样的工具有 "),s("a",{attrs:{href:"https://github.com/FiloSottile/mkcert",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("mkcert")]),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://github.com/openssl/openssl",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("openssl")]),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://github.com/caddyserver/caddy",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("caddy")]),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("因为我是本地开启 HTTPS 服务，没有域名，同时需要手机端也正常访问，所以我使用 "),s("code",[t._v("mkcert")]),t._v(" 生成 SSL 证书")]),t._v(" "),s("h3",{attrs:{id:"mkcert"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mkcert"}},[t._v("#")]),t._v(" "),s("code",[t._v("mkcert")])]),t._v(" "),s("h4",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ brew "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mkcert\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"在系统中安装本地证书颁发机构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在系统中安装本地证书颁发机构"}},[t._v("#")]),t._v(" 在系统中安装本地证书颁发机构")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ mkcert -install\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h4",{attrs:{id:"生成证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成证书"}},[t._v("#")]),t._v(" 生成证书")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ mkcert -cert-file cert.pem -key-file key.pem "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.102\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Created a new certificate valid for the following names 📜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#  - "192.168.0.102"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# The certificate is at "cert.pem" and the key at "key.pem" ✅')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h4",{attrs:{id:"手机安装根证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手机安装根证书"}},[t._v("#")]),t._v(" 手机安装根证书")]),t._v(" "),s("h5",{attrs:{id:"获取-mkcert-的根证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取-mkcert-的根证书"}},[t._v("#")]),t._v(" 获取 mkcert 的根证书")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ mkcert -CAROOT\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ~/Library/Application Support/mkcert")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("该命令会输出一个路径，例如 "),s("code",[t._v("~/Library/Application Support/mkcert")])]),t._v(" "),s("p",[t._v("在这个路径下，你可以找到根证书文件，通常是 "),s("code",[t._v("rootCA.pem")]),t._v("。")]),t._v(" "),s("h5",{attrs:{id:"将根证书导入到-iphone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将根证书导入到-iphone"}},[t._v("#")]),t._v(" 将根证书导入到 iPhone")]),t._v(" "),s("p",[t._v("将根证书 "),s("code",[t._v("rootCA.pem")]),t._v(" 导入到 iPhone")]),t._v(" "),s("h5",{attrs:{id:"安装证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装证书"}},[t._v("#")]),t._v(" 安装证书")]),t._v(" "),s("p",[t._v("在 iPhone 上点击 "),s("code",[t._v("rootCA.pem")]),t._v("  文件，并完成安装步骤。")]),t._v(" "),s("h5",{attrs:{id:"信任根证书"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#信任根证书"}},[t._v("#")]),t._v(" 信任根证书")]),t._v(" "),s("p",[t._v("安装证书后，还需要将其标记为信任：")]),t._v(" "),s("ol",[s("li",[t._v("打开 iPhone 的 "),s("strong",[t._v("设置")])]),t._v(" "),s("li",[t._v("进入 "),s("strong",[t._v("通用 > 关于本机 > 证书信任设置")])]),t._v(" "),s("li",[t._v("找到刚安装的证书，启用对该证书的完全信任")])]),t._v(" "),s("h3",{attrs:{id:"http-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-server"}},[t._v("#")]),t._v(" "),s("code",[t._v("http-server")])]),t._v(" "),s("p",[t._v("生成并安装证书之后就可以开启 HTTPS 服务了")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("$ http-server -S -C cert.pem\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https://192.168.0.102:8080")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("在手机端输入 https://192.168.0.102:8080，就可以访问 HTTPS 服务了")]),t._v(" "),s("p",[t._v("其它开启 http 服务的工具，也是一样的，添加 SSL 证书就可以开启 HTTPS 服务。有些工具甚至带有自动生成证书的能力，比如 "),s("a",{attrs:{href:"https://webpack.js.org/configuration/dev-server/#devserverserver",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("webpack-dev-server")]),s("OutboundLink")],1),t._v("、 "),s("a",{attrs:{href:"https://umijs.org/docs/api/config#https",target:"_blank",rel:"noopener noreferrer"}},[t._v("UmiJS"),s("OutboundLink")],1),t._v("，详细配置请参他们的官方文档。")]),t._v(" "),s("h2",{attrs:{id:"录音"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#录音"}},[t._v("#")]),t._v(" 录音")]),t._v(" "),s("p",[t._v("使用 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaRecorder")]),s("OutboundLink")],1),t._v(" 实现录音功能，"),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaRecorder")]),s("OutboundLink")],1),t._v(" 的构造函数需要一个  "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStream")]),s("OutboundLink")],1),t._v(" 对象，这个对象可以是上面通过 "),s("code",[t._v("navigator.mediaDevices.getUserMedia()")]),t._v(" 方法获取的，也可以通过 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/captureStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("HTMLCanvasElement.captureStream()")]),s("OutboundLink")],1),t._v(" 方法和 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/captureStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("HTMLMediaElement.captureStream()")]),s("OutboundLink")],1),t._v(" 方法获取。"),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaRecorder")]),s("OutboundLink")],1),t._v(" 的构造函数还有一个可选的 "),s("code",[t._v("options")]),t._v(" 对象，提供一些配置选项，比如媒体格式的 MIME 类型（"),s("code",[t._v("mimeType")]),t._v("）或者比特率（"),s("code",[t._v("bitsPerSecond")]),t._v("）。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaRecorder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("调用 "),s("code",[t._v("MediaRecorder")]),t._v(" 的 "),s("code",[t._v("start()")]),t._v(" 方法开始录音，当 MediaRecorder 将媒体数据传递给应用程序时，MediaRecorder 的 "),s("code",[t._v("dataavailable")]),t._v(" 事件就被触发。这是一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/BlobEvent",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("BlobEvent")]),s("OutboundLink")],1),t._v(" 类型的事件，它的 data 属性一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Blob",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Blob")]),s("OutboundLink")],1),t._v(" 对象，表示录制的媒体资源数据")]),t._v(" "),s("p",[t._v("调用 "),s("code",[t._v("MediaRecorder")]),t._v(" 的 "),s("code",[t._v("stop()")]),t._v(" 方法停止录音。调用 "),s("code",[t._v("pause()")]),t._v(" 方法和 "),s("code",[t._v("resume()")]),t._v(" 方法暂停和恢复录音。")]),t._v(" "),s("p",[t._v("静态方法 "),s("code",[t._v("isTypeSupported()")]),t._v(" 判断浏览器是否支持某种 MIME 格式。")]),t._v(" "),s("p",[t._v("下面是录制音频的一个列子")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" audioChunks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" mediaRecorder\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始录音")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startRecording")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断浏览器是否支持录音")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'浏览器不支持录音！'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求麦克风权限")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserMedia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      audio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 动态检测支持的音频格式")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" audioType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTypeSupported")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/webm'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      audioType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/webm'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTypeSupported")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mp4'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      audioType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mp4'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'浏览器不支持录音！'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 清空 chunk")]),t._v("\n    audioChunks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化 MediaRecorder")]),t._v("\n    mediaRecorder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaRecorder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mimeType"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" audioType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 收集录音数据")]),t._v("\n    mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dataavailable"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      audioChunks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 录音结束时，生成 Blob")]),t._v("\n    mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stop"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将音频数据块转换为 Blob")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" audioBlob "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Blob")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("audioChunks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" audioType "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生成音频 URL")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" audioUrl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createObjectURL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("audioBlob"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置音频 URL 为 <audio> 的播放源")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// audioElement.src = audioUrl;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"无法访问麦克风:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 停止录音")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopRecording")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaRecorder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"recording"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br")])]),s("h2",{attrs:{id:"设置采样率和单通道"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置采样率和单通道"}},[t._v("#")]),t._v(" 设置采样率和单通道")]),t._v(" "),s("p",[t._v("录音之后进行语音识别，讯飞的语言识别功能要求采样率 16000 Hz 和单通道")]),t._v(" "),s("h3",{attrs:{id:"比特率-vs-采样率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#比特率-vs-采样率"}},[t._v("#")]),t._v(" 比特率  VS 采样率")]),t._v(" "),s("p",[t._v("创建 "),s("code",[t._v("MediaRecorder")]),t._v(" 时，有一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder/MediaRecorder#audiobitspersecond",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("audiobitspersecond")]),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder/MediaRecorder#bitspersecond",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("bitspersecond")]),s("OutboundLink")],1),t._v(" 选项，表示媒体组件的比特率（bitrate）。那比特率和采样率的区别是什么呢？它们是同一个东西吗？答案是否定的，它们不是同一个东西")]),t._v(" "),s("ul",[s("li",[t._v("比特率，表示每秒钟传输的比特数（bit），是衡量数据传输速度的指标，通常以每秒比特数（bps）、千比特每秒（kbps）来衡量。"),s("strong",[t._v("音频文件的比特率决定了其音质和文件大小")]),t._v("，例如，一个 128 kbps 的 MP3 文件每秒包含 128,000 比特的音频数据。")]),t._v(" "),s("li",[t._v("采样率，这是每秒从模拟信号中捕获的样本数量，通常以千赫兹（kHz）为单位。音频采样率是指录音设备在一秒钟内对声音信号的采样次数，采样频率越高声音的还原就越真实越自然。换句话说："),s("strong",[t._v("采样率越高，次数就越多，存的数据就越精细。")])])]),t._v(" "),s("p",[t._v("那要怎么修改采样率呢？"),s("code",[t._v("MediaRecorder")]),t._v(" 并没有提供设置采样率的 API，这里就需要使用 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Audio API"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioContext")]),s("OutboundLink")],1),t._v(" 处理 "),s("code",[t._v("MediaStream")])]),t._v(" "),s("h3",{attrs:{id:"web-audio-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web-audio-api"}},[t._v("#")]),t._v(" Web Audio API")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Audio API"),s("OutboundLink")],1),t._v(" 的一般工作流程如下：")]),t._v(" "),s("ol",[s("li",[t._v("创建一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioContext")]),s("OutboundLink")],1),t._v(" 音频上下文")]),t._v(" "),s("li",[t._v("在音频上下文里，创建音频源（Sources），比如 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamSource",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createMediaStreamSource()")]),s("OutboundLink")],1),t._v(" 方法")]),t._v(" "),s("li",[t._v("创建音效节点（Effects），如混响，过滤器、音道合并等，比如 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createChannelMerger",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createChannelMerger()")]),s("OutboundLink")],1),t._v(" 方法")]),t._v(" "),s("li",[t._v("选择音频输出的目的地（Destination），比如设备扬声器")]),t._v(" "),s("li",[t._v("将音频源连接到音效节点，再将音效节点连接到目的地。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(363),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"audiocontext"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#audiocontext"}},[t._v("#")]),t._v(" "),s("code",[t._v("AudioContext")])]),t._v(" "),s("p",[s("code",[t._v("AudioContext")]),t._v(" 代表了一个由音频模块链接而成的音频处理图，其中每个音频模块由 "),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/AudioNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioNode")]),s("OutboundLink")],1),t._v(" 表示")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AudioContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("code",[t._v("AudioContext")]),t._v(" 的构造函数有一个可选的 "),s("code",[t._v("options")]),t._v(" 对象，其中 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/AudioContext#samplerate",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("samplerate")]),s("OutboundLink")],1),t._v(" 可以设置采样率")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamSource",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createMediaStreamSource()")]),s("OutboundLink")],1),t._v(" 方法从 "),s("code",[t._v("MediaStream")]),t._v(" 创建一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioSourceNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStreamAudioSourceNode")]),s("OutboundLink")],1),t._v(" 对象，是一个从 stream 中获得其媒体的音频节点。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaStreamDestination",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createMediaStreamDestination()")]),s("OutboundLink")],1),t._v(" 方法从创建一个 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioDestinationNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStreamAudioDestinationNode")]),s("OutboundLink")],1),t._v(" 对象，代表音频目的地，它的 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamAudioDestinationNode/stream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("stream")]),s("OutboundLink")],1),t._v(" 属性是一个包含单个音频"),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStreamTrack",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStreamTrack")]),s("OutboundLink")],1),t._v(" 的 "),s("code",[t._v("MediaStream")]),t._v("，您可以使用此属性从音频图形中获取流。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("BaseAudioContext")]),s("OutboundLink")],1),t._v("（"),s("code",[t._v("AudioContext")]),t._v(" 继承 "),s("code",[t._v("BaseAudioContext")]),t._v("）的 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createChannelMerger",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("createChannelMerger()")]),s("OutboundLink")],1),t._v(" 方法创建了一个"),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/ChannelMergerNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("ChannelMergerNode")]),s("OutboundLink")],1),t._v("，它将多个音频流中的通道合并为单个音频流。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioNode")]),s("OutboundLink")],1),t._v(" 接口的 "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/connect",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("connect()")]),s("OutboundLink")],1),t._v(" 方法将节点的输出连接到另一个目标上。")]),t._v(" "),s("p",[t._v("实现采样率 16000 Hz 和单通道")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("startRecording")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取麦克风输入流")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" stream "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" navigator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mediaDevices"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserMedia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" audio"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 AudioContext")]),t._v("\n    audioContext "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AudioContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sampleRate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置目标采样率")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" audioContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMediaStreamSource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建单声道处理器")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" channelMerger "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" audioContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createChannelMerger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接音频流到单声道处理器")]),t._v("\n    source"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("channelMerger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建目标音频流")]),t._v("\n    mediaStreamDestination "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" audioContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createMediaStreamDestination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    channelMerger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaStreamDestination"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化 MediaRecorder")]),t._v("\n    mediaRecorder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaRecorder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaStreamDestination"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    mediaRecorder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"无法访问麦克风:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br")])]),s("h2",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[t._v("#")]),t._v(" References")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("MediaStream Recording API"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Audio API"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API/Using_the_MediaStream_Recording_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Using the MediaStream Recording API"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API/Recording_a_media_element",target:"_blank",rel:"noopener noreferrer"}},[t._v("Recording a media element"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Media_Capture_and_Streams_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Media Capture and Streams API"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaDevices")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaRecorder")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MediaStream",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MediaStream")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("BaseAudioContext")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioContext")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/AudioNode",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AudioNode")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/http-party/http-server",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("http-party/http-server")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/FiloSottile/mkcert",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("FiloSottile/mkcert")]),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/mdn/dom-examples/blob/main/media/web-dictaphone/scripts/app.js",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("mdn/dom-examples")]),s("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);