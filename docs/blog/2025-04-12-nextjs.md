---
pageClass: blog-page
title: Learn Next.js
tags:
  - web
  - react
  - next.js
date: 2025-04-12
author: cp3hnu
location: ChangSha
summary: æˆ‘ä¹‹å‰ä½¿ç”¨ Express åˆ›å»ºäº†ä¸€ä¸ª ToDo çš„ Web åº”ç”¨ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ Next.jsï¼Œä¸€ä¸ªå‡ºè‰²çš„å…¨æ ˆæ¡†æ¶
---

# Learn Next.js 

æˆ‘ä¹‹å‰ [ä½¿ç”¨ Express åˆ›å»ºäº†ä¸€ä¸ª ToDo çš„ Web åº”ç”¨](/2025/01/17/express-web)ã€‚[Express](https://expressjs.com/) å°±åƒä¸€å¼ ç©ºç™½çš„ç”»å¸ƒï¼Œä»»ä½ æŒ¥æ´’åˆ›æ„ã€‚ä½ å¯ä»¥ç”¨æ°´å½©å‹¾å‹’ä¸€å¹…ç«¥è¶£ç›ç„¶çš„æ’ç”»ï¼Œä¹Ÿå¯ä»¥ç”¨æ¯›ç¬”æç»˜ä¸€å·æ„å¢ƒæ·±è¿œçš„å±±æ°´é•¿å·ã€‚å¦‚æœæŠ€è‰ºç²¾æ¹›ï¼Œç”šè‡³èƒ½åˆ›ä½œå‡ºå ªæ¯”ã€Šæ¸…æ˜ä¸Šæ²³å›¾ã€‹çš„ä¼ ä¸–ä¹‹ä½œã€‚è¿™æ­£æ˜¯ Express æ‰€è°“çš„ **"unopinionated"**â€”â€”å®ƒä¸è®¾é™ï¼Œä½ çš„ä½œå“ç”±ä½ å®šä¹‰ã€‚

ç„¶è€Œï¼Œ [Express](https://expressjs.com/)  ä»…ä»…æ˜¯ä¸€å¼ ç©ºç™½çš„ç”»å¸ƒï¼Œæ‰€æœ‰çš„å·¥å…·å’Œææ–™éƒ½éœ€è¦æˆ‘ä»¬è‡ªè¡Œå‡†å¤‡ã€‚æˆ‘ä»¬è¦å¤„ç†æ¨¡æ¿ï¼ˆHTMLï¼‰ã€æ ·å¼ï¼ˆCSSï¼‰ã€è„šæœ¬ï¼ˆJavaScriptï¼‰ã€ç”¨æˆ·éªŒè¯ã€æ•°æ®åº“ã€ç»„ä»¶ç­‰æ–¹æ–¹é¢é¢ã€‚è€Œä»¥æˆ‘ä»¬çš„èƒ½åŠ›ï¼Œå°šæ— æ³•ä¼åŠå¼ æ‹©ç«¯çš„é€ è¯£ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¡†æ¶æ¥ä¸ºæˆ‘ä»¬æ‰“å¥½åŸºç¡€ï¼Œå°±åƒä¸€ä½ç»˜ç”»è€å¸ˆï¼Œæå‰é€‰å¥½é“…ç¬”ã€è°ƒå¥½è‰²æ¿ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºæŒ¥æ´’åˆ›æ„ï¼Œå°†è„‘æµ·ä¸­çš„æ„æƒ³å˜ä¸ºç°å®ã€‚

[Next.js](https://nextjs.org/) æ­£æ˜¯è¿™æ ·ä¸€ä¸ªå‡ºè‰²çš„æ¡†æ¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ [Next.js](https://nextjs.org/)ã€‚

## å®‰è£…

```sh
$ npx create-next-app@latest
```

> å½“å‰ç‰ˆæœ¬ 15.3.0
>
> è¦æ±‚ Node.js 18.18+

å®‰è£…çš„è¿‡ç¨‹ä¸­ï¼ŒNext.js ä¼šæä¾›ä»¥ä¸‹é€‰é¡¹ä¾›æ‚¨é€‰æ‹©

```
What is your project named? my-app
Would you like to use TypeScript? No / Yes
Would you like to use ESLint? No / Yes
Would you like to use Tailwind CSS? No / Yes
Would you like your code inside a `src/` directory? No / Yes
Would you like to use App Router? (recommended) No / Yes
Would you like to use Turbopack for `next dev`?  No / Yes
Would you like to customize the import alias (`@/*` by default)? No / Yes
What import alias would you like configured? @/*
```

ä»¥ä¸Šé€‰é¡¹ï¼Œæˆ‘éƒ½é€‰æ‹© "Yes"ï¼Œå› æ­¤ Next.js è‡ªåŠ¨ä¸ºæˆ‘é…ç½®äº† Typescriptã€ESLintã€Tailwind CSSã€Turbopackã€Alias å’Œè·¯ç”±æœºåˆ¶ï¼Œå¹¶ä¸”ä»£ç æ”¾å…¥ `src` ç›®å½•ã€‚

## è°ƒè¯•

è°ƒè¯•çº¯å‰ç«¯é¡¹ç›®ï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨æµè§ˆå™¨ï¼ˆæˆ‘ä½¿ç”¨ Chromeï¼‰å°±å¯ä»¥äº†ã€‚ä½†æ˜¯ Next.js æ˜¯å‰åç«¯ä¸€ä½“çš„é¡¹ç›®ï¼Œæ‰€ä»¥é™¤äº†æµè§ˆå™¨æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ VS Codeï¼ˆæˆ‘ä½¿ç”¨VS Codeï¼‰

> å…³äºæ€ä¹ˆä½¿ç”¨ VS Code è°ƒè¯• Node.jsï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ [VS Code è°ƒè¯• Node.js ](/2024/09/26/vscode-debug/) è¿™ç¯‡æ–‡ç« 

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»º `.vscode/launch.json` æ–‡ä»¶

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run dev"
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    },
    {
      "name": "Next.js: debug full stack",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/next/dist/bin/next",
      "runtimeArgs": ["--inspect"],
      "skipFiles": ["<node_internals>/**"],
      "serverReadyAction": {
        "action": "debugWithChrome",
        "killOnServerStop": true,
        "pattern": "- Local:.+(https?://.+)",
        "uriFormat": "%s",
        "webRoot": "${workspaceFolder}"
      }
    }
  ]
}
```

å¦‚æœè¦ä»æ ¹ç›®å½•ä»¥å¤–çš„ç›®å½•è¿è¡Œ Next.jsï¼Œåˆ™éœ€è¦æ·»åŠ  `cwd` é€‰é¡¹ï¼ˆè¡¨ç¤ºå¯åŠ¨ç¨‹åºæ‰€åœ¨çš„ç›®å½•ï¼‰ï¼Œä¾‹å¦‚ï¼š`"cwd"ï¼š "${workspaceFolder}/apps/web"`ã€‚

## è·¯ç”±

Next.js æä¾›äº†ä¸¤ç§è·¯ç”±æœºåˆ¶ï¼š

- App Routerï¼šåŸºäº `app/` ç›®å½•ä¸­çš„æ–‡ä»¶ç»“æ„ï¼Œå¼•å…¥äº† å¸ƒå±€ï¼ˆLayoutï¼‰å’ŒåµŒå¥—è·¯ç”±çš„æ¦‚å¿µã€‚
- Pages Routerï¼šåŸºäº `pages/` ç›®å½•ä¸­çš„æ–‡ä»¶ç»“æ„ï¼Œæ¯ä¸ª `.js/.tsx` æ–‡ä»¶è‡ªåŠ¨æˆä¸ºä¸€ä¸ªè·¯ç”±ã€‚

App Router è‡ª Next.js 13 å¼•å…¥çš„ï¼Œæ˜¯ç›®å‰ Next.js æ¨èçš„è·¯ç”±æœºåˆ¶ã€‚æ‰€ä»¥å¯¹äºæ–°åº”ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ App Router å³å¯ã€‚

App Router ä»¥  `app/` ä¸‹çš„æ–‡ä»¶ç»“æ„å½¢æˆè·¯ç”±ï¼Œå¹¶æ”¯æŒè·¯ç”±åµŒå¥—ã€‚å½“ç„¶ä¸æ˜¯ `app/` ä¸‹çš„æ‰€æœ‰çš„æ–‡ä»¶éƒ½å¯ä»¥ç”¨ä½œè·¯ç”±ï¼Œåªæœ‰ `page.{js,jsx,ts,tsx}` æ–‡ä»¶æ‰å¯ä»¥å½“åšè·¯ç”±ï¼Œæ¯”å¦‚ï¼š

```
â””â”€â”€ app
   â”œâ”€â”€ content
   |  â”œâ”€â”€ layout.tsx
   |  â””â”€â”€ task
   |     â””â”€â”€ page.tsx         ğŸŒ /content/task/
   â”œâ”€â”€ components
   |     â””â”€â”€ button.tsx       ä¸æ˜¯è·¯ç”±
   â”œâ”€â”€ layout.tss
   â”œâ”€â”€ lib
         â””â”€â”€ actions.ts       ä¸æ˜¯è·¯ç”±
   â”œâ”€â”€ page.tsx               ğŸŒ /
   â””â”€â”€ user
         â”œâ”€â”€ layout.tsx
         â”œâ”€â”€ page.tsx         ğŸŒ /user/
      â”œâ”€â”€ login
      |  â””â”€â”€ page.tsx         ğŸŒ /user/login/
      â””â”€â”€ register
         â””â”€â”€ page.tsx         ğŸŒ /user/register/
```

å¹¶ä¸”ä»¥ `page.{js,jsx,ts,tsx}` æ–‡ä»¶è¿”å›çš„ç»„ä»¶ä½œä¸ºè·¯ç”±æ¸²æŸ“çš„é¡µé¢ã€‚æ¯”å¦‚

```tsx
// app/user/page.tsx
export default function User() {
  return (
    <div>
      I'm cp3hnu
    </div>
  );
}
```

è®¿é—® http://localhost:3000/user æ—¶ï¼Œé¡µé¢æ˜¾ç¤º `I'm cp3hnu`ã€‚

æ­¤å¤– App Router æ”¯æŒå¸ƒå±€å…±äº«å’ŒåµŒå¥—ã€‚ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰è·¯ç”±å…±äº«å½“å‰ç›®å½•çš„å¸ƒå±€ï¼Œè¿™ä¸ªå¸ƒå±€ç”± `layout.{js,jsx,ts,tsx}` æ–‡ä»¶å®šä¹‰ã€‚æ¯”å¦‚ä¸Šé¢çš„ `/user/login/` å’Œ `/user/register/` å…±äº« user çš„å¸ƒå±€ï¼Œå³ `user/layout.tsx` å®šä¹‰çš„å¸ƒå±€ã€‚

> å¸ƒå±€å…±äº«å¯ä»¥ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œæ¯”å¦‚ä» `/user/login/`  è·³è½¬åˆ° `/user/register/`ï¼Œ `user/layout.tsx` ä¸éœ€è¦é‡æ–°æ¸²æŸ“ã€‚

æ¯ä¸€ä¸ª Next.js é¡¹ç›®éƒ½åº”è¯¥æœ‰ä¸€ä¸ªæ ¹å¸ƒå±€ï¼Œç”± `app/layout.tsx` å®šä¹‰ï¼Œé‡Œé¢åº”è¯¥åŒ…å« `html` å’Œ `body` æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š

```tsx
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="zh-CN">
      <body
      >
        {children}
      </body>
    </html>
  );
}
```

åŒæ—¶å¸ƒå±€æ”¯æŒåµŒå¥—ï¼Œå› æ­¤å¯¹åº”è·¯ç”±åœ°å€ `/user/login/` ï¼Œæ¸²æŸ“çš„é¡µé¢åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```jsx
<RootLayout>
  <UserLayout>
    <LoginPage />
  </UserLayout>
</RootLayout>
```

### ç›®å½•çº¦å®š

ä¸€èˆ¬æƒ…å†µä¸‹  `app/` ä¸‹çš„ç›®å½•ç”¨äºæ„å»ºè·¯ç”±æ®µ (route segment)ï¼Œä½†ä¹Ÿå­˜åœ¨ä»¥ä¸‹å‡ ç§ç‰¹æ®Šæƒ…å½¢

#### `[folder]`

è¿™ç§æ˜¯åŠ¨æ€ route segmentï¼Œæ¯”å¦‚ï¼š

```
â””â”€â”€ app
   â””â”€â”€ user   
      â””â”€â”€ [id]
         â””â”€â”€ page.tsx    ğŸŒ /user/1/ã€/user/2/ ç­‰
```

è¿™ç§ç±»ä¼¼äº [React-Router çš„åŠ¨æ€è·¯ç”±](https://reactrouter.com/start/framework/routing#dynamic-segments)ï¼Œ`route("user/:id", "./user.tsx"),`

è¿™ä¸ªåŠ¨æ€å‚æ•°é€šè¿‡ `params` props ä¼ é€’ç»™ pageã€‚

```js
// app/user/[id]/page.tsx

export default async function UserDetail({
  params
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  return <div>{id}</div>;
}
```

> ğŸ“¢ `params` æ˜¯ä¸€ä¸ª Promise

å¦‚æœæ˜¯ **Client Component**ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ [`useParams`](https://nextjs.org/docs/app/api-reference/functions/use-params) è·å–ã€‚

å½“å¯¼èˆªåˆ° `/user/5/` æ—¶ï¼Œ`params.id` ä¸º `5`

#### `[...folder]`

é™¤äº†åŒ¹é…å•ä¸ª route segmentï¼ŒNext.js è¿˜èƒ½åŒ¹é…å¤šä¸ª  route segmentï¼Œå³ä½¿ç”¨ `[...folder]`ï¼Œæ¯”å¦‚

```
â””â”€â”€ app
   â””â”€â”€ user    
      â””â”€â”€ [...slug]
         â””â”€â”€ page.tsx    ğŸŒ /user/1/ã€/user/1/infoã€/user/1/info/avatar ç­‰
```

æ­¤æ—¶ `params.slug` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹åº”è·¯ç”±åœ°å€ `/user/1/info/edit`ï¼Œå€¼ä¸º `["1", "info", "avatar"]`

#### `[[...folder]]`

è¿™ä¸ªç›¸å¯¹äºä¸Šé¢çš„ `[...folder]`ï¼Œ route segment å¯ä»¥ä¸ºç©ºï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå®ƒèƒ½åŒ¹é… `/user/`

#### `(folder)`

æ ¹æ®ä¸šåŠ¡é€»è¾‘è¿›è¡Œåˆ†ç»„ï¼Œä½†æ˜¯ä¸ä¼šç”Ÿæˆ route segmentï¼Œæ¯”å¦‚

```
â””â”€â”€ app
   â”œâ”€â”€ (main)
   	  â”œâ”€â”€ layout.tsx
     	â””â”€â”€ task
        	â””â”€â”€ page.tsx    ğŸŒ /task/
```

ä¸€èˆ¬æ˜¯ç”¨äºæ ¹æ®ä¸šåŠ¡é€»è¾‘è¿›è¡Œåˆ†ç»„ï¼Œæ¯”å¦‚ `ï¼ˆadminï¼‰`ã€`ï¼ˆmarketing`ï¼‰ç­‰ã€‚

è™½ç„¶ `(folder)` ä¸ä¼šäº§ç”Ÿ route segmentï¼Œä½†æ˜¯ç›®å½•ä¸‹çš„è·¯ç”±å¯ä»¥å…±äº« Layoutã€‚

æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œä¸è¦äº§ç”Ÿè·¯ç”±å†²çªï¼Œæ¯”å¦‚ï¼š``(marketing)/about/page.js` å’Œ `(shop)/about/page.js` éƒ½ä¼šç”Ÿæˆ `/about` è·¯ç”±ã€‚

#### `_folder`

ç§æœ‰æ–‡ä»¶å¤¹ã€‚ç§æœ‰æ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶å¤¹éƒ½ä¸ä¼šç”Ÿæˆå¸ƒå±€å’Œè·¯ç”±ï¼Œå³ä½¿ç›®å½•ä¸‹å­˜åœ¨ `page` æ–‡ä»¶

#### `@folder`

æ’æ§½ï¼Œç”¨äºå¹¶è¡Œè·¯ç”±ï¼Œå¯ä»¥åŒæ—¶æ¸²æŸ“å¤šä¸ªé¡µé¢ï¼Œæ¯”å¦‚ä¸‹é¢çš„ç»“æ„

```
â””â”€â”€ app
   â”œâ”€â”€ layout.tsx	 
   â”œâ”€â”€ page.tsx
   â”œâ”€â”€ @team
   		â””â”€â”€ page.tsx
   â”œâ”€â”€ @intro
   		â””â”€â”€ page.tsx
```

å¯ä»¥è¿™ä¹ˆå®šä¹‰  `app/layout.tsx`

```tsx
export default function Layout({
  children,
  team,
  analytics,
}: {
  children: React.ReactNode
  intro: React.ReactNode
  team: React.ReactNode
}) {
  return (
    <>
      {children}
      {team}
      {intro}
    </>
  )
}
```

è¿™æ ·å°±å¯ä»¥åŒæ—¶æ¸²æŸ“ `@team/page.tsx`ã€`@intro/page.tsx`ã€`app/page.tsx` ä¸‰ä¸ªé¡µé¢çš„å†…å®¹

> `children` å…¶å®å°±æ˜¯ä¸€ä¸ªé»˜è®¤çš„æ’æ§½

### æ–‡ä»¶çº¦å®š

é™¤äº† `page` æ–‡ä»¶ç”¨äºè·¯ç”±ï¼Œ`layout` æ–‡ä»¶ç”¨äºå¸ƒå±€ä¹‹å¤–ï¼ŒNext.js è¿˜å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šç”¨é€”çš„æ–‡ä»¶

> ä¸‹é¢æ–‡ä»¶çš„åç¼€è·Ÿ `page` æ–‡ä»¶ä¸€æ ·ï¼Œæ”¯æŒ `.js`ã€`.jsx`ã€`.ts`ã€`.tsx`

#### `page`

å®šä¹‰è·¯ç”±ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•° `params` å’Œ `searchParams`

```tsx
export default function Page({
  params,
  searchParams,
}: {
  params: Promise<{ slug: string }>
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>
}) {
  return <h1>My Page</h1>
}
```

#### `layout`

å®šä¹‰å¸ƒå±€ï¼Œå®ƒæœ‰ä¸¤ä¸ªå‚æ•° `children` å’Œ `params` ã€‚æ ¹ `layout` æ–‡ä»¶åœ¨ app ç›®å½•ä¸‹ï¼Œå¿…é¡»åŒ…å« `html` å’Œ `body`

```ts
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

#### `loading`

æ˜¾ç¤ºé¡µé¢çš„åŠ è½½çŠ¶æ€ã€‚å…¶å®å°±æ˜¯ä½œä¸º [Suspense](https://react.dev/reference/react/Suspense) ç»„ä»¶çš„ `fallback`

```tsx
<Layout>
  <Suspense fallback={<Loading />}>
  	<Page />
	</Suspense>
</Layout>
```

ä¸»è¦æ˜¯ç”¨äºå¼‚æ­¥ç»„ä»¶ï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [Loading UI and Streaming](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)

#### `error`

æ˜¾ç¤ºé¡µé¢çš„é”™è¯¯çŠ¶æ€ã€‚å…¶å®å°±æ˜¯ä½œä¸º [ErrorBoundary](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary) ç»„ä»¶çš„ `fallback`ã€‚å¿…é¡»æ˜¯ Client Component

```tsx
<Layout>
  <ErrorBoundary fallback={<Error />}>
  	<Page />
	</ErrorBoundary>
</Layout>
```

å®ƒæ¥æ”¶ä¸¤ä¸ª `props` 

- `error`: é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…å« `message` å’Œ `digest`

-  `reset`: åˆ·æ–°å‡½æ•°

```tsx
'use client' // å¿…é¡»æ˜¯ Client Component
 
export default function Error({
  error,
  reset,
}: {
  error: Error & { message?: string; digest?: string }
  reset: () => void
}) {
  return (
    <div>
      <h2>Something went wrong!</h2>
      <button onClick={() => reset()}>Try again</button>
    </div>
  )
}
```

#### `global-error`

å¤„ç†æ ¹å¸ƒå±€é”™è¯¯ï¼Œå¿…é¡»åœ¨ `/app` ç›®å½•ä¸‹ï¼Œå¿…é¡»åŒ…å« `html` å’Œ `body` æ ‡ç­¾ï¼Œå› ä¸ºå®ƒä¼šå–ä»£æ ¹ Layout çš„å†…å®¹ï¼Œå³

```tsx
<ErrorBoundary fallback={<GlobalError />}>
  <RootLayout>
		<RootPage />
  </RootLayout>
</ErrorBoundary>
```

å…¶å®ƒçš„å’Œ `error` ä¸€æ ·

```tsx 
'use client' // å¿…é¡»æ˜¯ Client Component
 
export default function GlobalError({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  return (
    // global-error must include html and body tags
    <html>
      <body>
        <h2>Something went wrong!</h2>
        <button onClick={() => reset()}>Try again</button>
      </body>
    </html>
  )
}
```

#### `not-found`

æ˜¾ç¤º 404 é”™è¯¯ã€‚ä½†æ˜¯éœ€è¦æ­é… [`notFound`](https://nextjs.org/docs/app/api-reference/functions/not-found) å‡½æ•°ä½¿ç”¨ï¼Œæ¯”å¦‚å¯¹äºè·¯ç”± `/user/:id`ï¼Œå¦‚æœé€šè¿‡ `id` æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚

è¿”å›çš„çŠ¶æ€ç ä¸º `404 Not Found`.

```tsx
// app/user/[id]/page.tsx
import { notFound } from "next/navigation";

export default async function UserD({
  params
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  const user = await getUserById(id);
  if (!user) {
    notFound();
  }
  return <div>{id}</div>;
}
```

```tsx
// app/user/[id]/not-found.tsx

export default function UserNotFound() {
  return <div>è¯¥ç”¨æˆ·ä¸å­˜åœ¨</div>;
}
```

`not-found` æ–‡ä»¶è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šç”¨é€”ï¼Œæ ¹ç›®å½•ä¸‹çš„ `not-found` æ–‡ä»¶ï¼ˆ`app/not-found`ï¼‰ å¤„ç†åº”ç”¨ç¨‹åºä¸åŒ¹é…çš„ URLã€‚å³è®¿é—®åº”ç”¨ç¨‹åºä¸­ä¸å­˜åœ¨çš„è·¯ç”±æ—¶ï¼Œæ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œä»¥æç¤ºç”¨æˆ·ã€‚

#### `route`

ç±»ä¼¼äº Express çš„è·¯ç”±å¤„ç†ç¨‹åºã€‚åœ¨ Next.js ä¸­ä¸€èˆ¬ç”¨äºåå°æ¥å£ã€‚åŒä¸€ç›®å½•ä¸‹ä¸è¦åŒæ—¶å­˜åœ¨ `route` æ–‡ä»¶å’Œ `page` æ–‡ä»¶

```ts
// app/api/user
export async function GET(request: Request) {
  return Response.json({ 
    id: 1,
    name: 'John Doe',
    age: 30,
    email: '5Ml0D@example.com'
  })
}
```

GET [http://localhost:3000/api/user](http://localhost:3000/api/user) è¿”å›

```json
{ 
    id: 1,
    name: 'John Doe',
    age: 30,
    email: '5Ml0D@example.com'
  }
```

é™¤äº†`GET` æ–¹æ³•ï¼ŒNext.js è¿˜æ”¯æŒ `POST`ã€`PUT`ã€`PATCH`ã€`DELETE`ã€`HEAD` å’Œ `OPTIONS`ã€‚å¯¹äºä¸æ”¯æŒçš„æ–¹æ³•ï¼Œè¿”å› `405 Method Not Allowed`ã€‚

Next.js æ¥æ”¶ [`NextRequest`](https://nextjs.org/docs/app/api-reference/functions/next-request) å‚æ•°ï¼Œè¿”å› [`NextResponse`](https://nextjs.org/docs/app/api-reference/functions/next-response)ï¼Œå®ƒä»¬åˆ†åˆ«æ‰©å±•äº†åŸç”Ÿçš„ [Request](https://developer.mozilla.org/docs/Web/API/Request) å’Œ [Response](https://developer.mozilla.org/docs/Web/API/Response) ï¼Œä»¥æä¾›æ›´å¤šåŠŸèƒ½ã€‚

#### `default`

ç”¨äºå¹¶è¡Œè·¯ç”±ã€‚ä¾‹å¦‚

```
â””â”€â”€ app
  â”œâ”€â”€ @intro
  |  â”œâ”€â”€ default.tsx
  |  â””â”€â”€ page.tsx
  â”œâ”€â”€ @user
  |  â”œâ”€â”€ info
  |  |  â””â”€â”€ page.tsx
  |  â””â”€â”€ page.tsx
  â”œâ”€â”€ default.tsx
  â”œâ”€â”€ layout.tsx
  â””â”€â”€ page.tsx
```

å½“è®¿é—® `/` è·¯ç”±æ—¶ï¼ŒåŒæ—¶å±•ç¤º `app/page.tsx`ã€`@intro/page.tsx`ã€`@user/page.tsx` çš„å†…å®¹ï¼Œä½†æ˜¯é€šè¿‡[è½¯å¯¼èˆªï¼ˆSoft Navigationï¼‰](https://nextjs.org/docs/app/building-your-application/routing/parallel-routes#active-state-and-navigation)åˆ° `/user/info` æ—¶ï¼Œå±•ç¤º `@user/info/page.tsx` çš„å†…å®¹ï¼ŒåŒæ—¶ä¿æŒ `app/page.tsx`ã€`@intro/page.tsx` çš„å†…å®¹ä¸å˜ï¼Œè¿™ä¸ªåœ¨ Next.js é‡Œç§°ä¸º [Partial Render](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating#4-partial-rendering)ã€‚

ä½†æ˜¯å¦‚æœè¿›è¡Œ[ç¡¬å¯¼èˆªï¼ˆHard Navigationï¼‰](https://nextjs.org/docs/app/building-your-application/routing/parallel-routes#active-state-and-navigation) ï¼Œæ¯”å¦‚æµè§ˆå™¨åˆ·æ–°ï¼Œ`@intro` ç›®å½•æ— æ³•åŒ¹é…è·¯ç”± `/user/info`ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šæ˜¾ç¤º `@intro/default.tsx` çš„å†…å®¹ï¼Œå› ä¸º `children` æ˜¯éšå¼æ’æ§½ `@children`ï¼Œå› æ­¤ä¹Ÿæ˜¾ç¤º `app/default.tsx`ã€‚å¦‚æœæ²¡æœ‰ `default` æ–‡ä»¶ï¼Œåˆ™æ•´ä¸ªé¡µé¢å°†æ˜¾ç¤º 404 é”™è¯¯ï¼Œå³ `app/not-found` çš„å†…å®¹ã€‚

#### `middleware`

ä¸­é—´ä»¶æ–‡ä»¶ã€‚ä¸­é—´ä»¶åœ¨è·¯ç”±å‘ˆç°ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥å®ç°å¦‚èº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•æˆ–é‡å®šå‘ç­‰åŠŸèƒ½ã€‚ä¸€ä¸ªé¡¹ç›®åªèƒ½æœ‰ä¸€ä¸ªä¸­é—´ä»¶æ–‡ä»¶ï¼Œä¸”å’Œ `app` æ–‡ä»¶å¤¹åœ¨åŒä¸€ä¸ªå±‚çº§ä¸­ã€‚æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒä¸‹æ–‡çš„[ä¸­é—´ä»¶](#ä¸­é—´ä»¶)

#### `template`

æ¨¡æ¿æ–‡ä»¶ã€‚ç±»ä¼¼äº`layout`ï¼Œä½†æ˜¯ä¸è·¨è·¯ç”±æŒä¹…åŒ–å’ŒçŠ¶æ€ä¿æŒçš„ `layout` ä¸åŒï¼Œæ¨¡æ¿æ–‡ä»¶è¢«èµ‹äºˆäº†ä¸€ä¸ªå”¯ä¸€çš„ keyï¼Œè¿™æ„å‘³ç€å­å®¢æˆ·ç«¯ç»„ä»¶åœ¨å¯¼èˆªæ—¶å°†é‡ç½®å®ƒä»¬çš„çŠ¶æ€ã€‚

> è¿™ä¸ªæ–‡ä»¶ä¸ç»å¸¸ä½¿ç”¨ã€‚

## æ¸²æŸ“

Next.js å°†ç»„ä»¶åˆ†ä¸ºæœåŠ¡å™¨ç»„ä»¶ï¼ˆServer Componentsï¼‰å’Œå®¢æˆ·ç«¯ç»„ä»¶ï¼ˆClient Componentsï¼‰

ä¸ºäº†åŠ é€Ÿåˆå§‹é¡µé¢çš„åŠ è½½ï¼ŒNext.js åœ¨æœåŠ¡å™¨ä¸Šä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»„ä»¶ç”Ÿæˆé™æ€ HTMLï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æ—¶ï¼Œå°†ç«‹å³çœ‹åˆ°é¡µé¢çš„å†…å®¹ï¼Œè€Œä¸å¿…ç­‰å¾…å®¢æˆ·ç«¯ä¸‹è½½ã€è§£æå’Œæ‰§è¡Œ JavaScript åŒ…ã€‚

Next.js çš„æ¸²æŸ“æ­¥éª¤å¦‚ä¸‹ï¼š

åœ¨æœåŠ¡å™¨ç«¯ï¼š

1. React å°†æœåŠ¡å™¨ç»„ä»¶æ¸²æŸ“ä¸ºä¸€ç§ç§°ä¸º [**React Server Component Payload (RSC Payload)**](https://nextjs.org/docs/app/building-your-application/rendering/server-components#what-is-the-react-server-component-payload-rsc) çš„ç‰¹æ®Šæ•°æ®æ ¼å¼ï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹å®¢æˆ·ç«¯ç»„ä»¶çš„å¼•ç”¨ã€‚
2. Next.js ä½¿ç”¨ RSC Payload å’Œå®¢æˆ·ç«¯ç»„ä»¶ JavaScript æŒ‡ä»¤åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ HTMLã€‚

ç„¶åï¼Œåœ¨å®¢æˆ·ç«¯ï¼š

3. ç”Ÿæˆçš„ HTML å¿«é€Ÿåœ°ç”Ÿæˆéäº¤äº’å¼åˆå§‹é¢„è§ˆã€‚
4. ç„¶å RSC Payload åè°ƒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»„ä»¶æ ‘ï¼Œå¹¶æ›´æ–° DOMã€‚
5. JavaScript æŒ‡ä»¤ **Hydrate** å®¢æˆ·ç«¯ç»„ä»¶å¹¶ä½¿å…¶å…·æœ‰äº¤äº’æ€§ã€‚

> RSC Payload æ˜¯æ¸²æŸ“çš„æœåŠ¡å™¨ç»„ä»¶æ ‘çš„ç´§å‡‘äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œå®ƒåŒ…å«ï¼š
>
> - æœåŠ¡å™¨ç»„ä»¶çš„æ¸²æŸ“ç»“æœï¼›
> - å®¢æˆ·ç«¯ç»„ä»¶åº”è¯¥æ¸²æŸ“çš„ä½ç½®ä»¥åŠå¯¹å…¶ JavaScript æ–‡ä»¶çš„å¼•ç”¨;
> - ä»»ä½•ä»æœåŠ¡å™¨ç»„ä»¶ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶çš„ Props;

> Hydration æ˜¯ç»™ DOM æ·»åŠ äº‹ä»¶ä¾¦å¬å™¨çš„è¿‡ç¨‹ï¼Œä½¿å¾—é™æ€ HTML å…·æœ‰äº¤äº’æ€§ã€‚åœ¨å¹•åï¼ŒHydration æ˜¯é€šè¿‡ [`hydrateRoot`](https://react.dev/reference/react-dom/client/hydrateRoot) React API å®Œæˆçš„ã€‚

### æœåŠ¡å™¨ç»„ä»¶

Next.js é»˜è®¤ç»„ä»¶éƒ½æ˜¯æœåŠ¡å™¨ç»„ä»¶ï¼ŒæœåŠ¡å™¨ç»„ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜åŠ¿ï¼š

- **è·å–æ•°æ®æ›´å¿«**ï¼šæœåŠ¡å™¨ç»„ä»¶å’Œæ•°æ®æºéƒ½åœ¨æœåŠ¡å™¨ä¸Šï¼Œå› æ­¤è·å–æ•°æ®æ›´å¿«ã€‚
- **æ›´å®‰å…¨**ï¼šæœåŠ¡å™¨ç»„ä»¶å°†æ•æ„Ÿæ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œå› æ­¤æ›´å®‰å…¨ã€‚
- **ç¼“å­˜**ï¼šæœåŠ¡å™¨ç»„ä»¶æ¸²æŸ“çš„å†…å®¹èƒ½è¢«ç¼“å­˜ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚
- **å‡å°‘å®¢æˆ·ç«¯ JavaScript åŒ…å¤§å°**ï¼šæœåŠ¡å™¨ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå› æ­¤å®¢æˆ·ç«¯éœ€è¦ä¸‹è½½ã€è§£æå’Œæ‰§è¡Œçš„ JavaScript å‡å°‘ã€‚
- **åˆå§‹é¡µé¢åŠ è½½å’Œç¬¬ä¸€æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰é€Ÿåº¦æ›´å¿«**ï¼šæœåŠ¡å™¨ç»„ä»¶åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ HTML ä»¥å…è®¸ç”¨æˆ·ç«‹å³æŸ¥çœ‹é¡µé¢ï¼Œè€Œæ— éœ€ç­‰å¾…å®¢æˆ·ç«¯ä¸‹è½½ã€è§£æå’Œæ‰§è¡Œæ¸²æŸ“é¡µé¢æ‰€éœ€çš„ JavaScriptï¼Œå› æ­¤åˆå§‹é¡µé¢åŠ è½½å’Œç¬¬ä¸€æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰é€Ÿåº¦æ›´å¿«ã€‚
- **æœç´¢å¼•æ“ä¼˜åŒ–å’Œç¤¾äº¤ç½‘ç»œå¯å…±äº«æ€§**ï¼šæœåŠ¡å™¨ç»„ä»¶ç”Ÿæˆçš„ HTML å¯ä»¥è¢«æœç´¢å¼•æ“æœºå™¨äººè®¿é—®ã€è¢«ç¤¾äº¤ç½‘ç»œæœºå™¨äººç”¨äºç”Ÿæˆç¤¾äº¤å¡ã€‚
- **æµå¼**ï¼šæœåŠ¡å™¨ç»„ä»¶å¯ä»¥å°†æ¸²æŸ“åˆ†å‰²æˆå—ï¼Œç„¶åå°†å®ƒä»¬æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯ï¼Œè¿™å¯ä»¥ä½¿ç”¨æˆ·æ›´æ—©åœ°çœ‹åˆ°é¡µé¢çš„éƒ¨åˆ†å†…å®¹ã€‚

æœåŠ¡å™¨ç»„ä»¶æœ‰ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼š

- é™æ€
- åŠ¨æ€
- æµå¼

#### é™æ€æ¸²æŸ“

é™æ€æ¸²æŸ“ï¼Œé™æ€æ¸²æŸ“çš„å†…å®¹åœ¨ç¼–è¯‘çš„æ—¶å€™ç”Ÿæˆã€‚é™æ€æ¸²æŸ“çš„å†…å®¹å¯ä»¥è¢«ç¼“å­˜ï¼Œå› æ­¤æœ‰å¥½çš„æ€§èƒ½ä¼˜åŠ¿ã€‚é€‚ç”¨äºéä¸ªæ€§åŒ–çš„åœºæ™¯ï¼Œæ¯”å¦‚é™æ€åšå®¢æ–‡ç« æˆ–äº§å“é¡µé¢ç­‰ã€‚

```tsx
export default function Component() {
  return (
    <div>
      <h1>æœåŠ¡å™¨ç»„ä»¶æœ‰ä¸‰ç§æ¸²æŸ“æ–¹å¼ï¼š</h1>
      <ul>
        <li>é™æ€</li>
        <li>åŠ¨æ€</li>
        <li>æµå¼</li>
      </ul>
    </div>
  );
}
```

#### åŠ¨æ€æ¸²æŸ“

ä¸é™æ€ç›¸åï¼ŒåŠ¨æ€æ¸²æŸ“çš„å†…å®¹åœ¨è¯·æ±‚çš„æ—¶å€™ç”Ÿæˆã€‚é€‚ç”¨äºä¸ªæ€§åŒ–çš„åœºæ™¯ï¼Œæ¯”å¦‚æ˜¾ç¤ºç”¨æˆ·çš„è´­ç‰©æ¸…å•ã€‚

æœåŠ¡å™¨ç»„ä»¶é»˜è®¤æ˜¯é™æ€æ¸²æŸ“ï¼Œä½†æ˜¯åœ¨æ¸²æŸ“çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ Next.js å‘ç°æœåŠ¡å™¨ç»„ä»¶ä½¿ç”¨äº† [åŠ¨æ€ API](https://nextjs.org/docs/app/building-your-application/rendering/server-components#dynamic-apis)  æˆ–å¸¦æœ‰é€‰é¡¹ `{cache: 'no-store'}` çš„[`fetch` å‡½æ•°](https://nextjs.org/docs/app/api-reference/functions/fetch)æ—¶ï¼ŒNext.js å°†ä½¿ç”¨åŠ¨æ€æ¸²æŸ“ã€‚

>  `{cache: 'no-store'}` è¡¨ç¤ºä¸ç¼“å­˜ï¼Œè®²ç¼“å­˜çš„æ—¶å€™ä¼šä»‹ç»

åŠ¨æ€ API åŒ…æ‹¬ï¼š

- [`cookies`](https://nextjs.org/docs/app/api-reference/functions/cookies)
- [`headers`](https://nextjs.org/docs/app/api-reference/functions/headers)
- [`connection`](https://nextjs.org/docs/app/api-reference/functions/connection)
- [`draftMode`](https://nextjs.org/docs/app/api-reference/functions/draft-mode)
- [`searchParams` prop](https://nextjs.org/docs/app/api-reference/file-conventions/page#searchparams-optional)
- [`unstable_noStore`](https://nextjs.org/docs/app/api-reference/functions/unstable_noStore)

#### æµå¼æ¸²æŸ“

æµå¼æ¸²æŸ“æ˜¯æŒ‡å°† UI åˆ†å‰²æˆå—ï¼Œç„¶åæµå¼ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä½¿å¾—ç”¨æˆ·èƒ½ç«‹å³çœ‹åˆ°é¡µé¢çš„éƒ¨åˆ†å†…å®¹ã€‚

æµå¼æ¸²æŸ“æœ‰ä¸¤ç§æ–¹å¼ï¼š

- ä½¿ç”¨ `loading.js`
- ä½¿ç”¨ `suspense` 

##### ä½¿ç”¨ `loading.js`

æ•´ä¸ªé¡µé¢ä½œä¸ºä¸€ä¸ªæµå¼å—ï¼Œå®ƒçš„å¥½å¤„æ˜¯ä¸ä¼šé˜»æ­¢ Layout çš„å±•ç¤ºï¼ŒåŒæ—¶ç”¨æˆ·å¯ä»¥çœ‹åˆ°é¡µé¢çš„åŠ è½½çŠ¶æ€

![](./assets/nextjs-loading-ui.jpeg) 

##### ä½¿ç”¨ `Suspense` 

[`Suspense`](https://react.dev/reference/react/Suspense) å¯ä»¥æ›´ç»†ç²’åº¦åœ°æ§åˆ¶é¡µé¢çš„å“ªäº›éƒ¨åˆ†è¿›è¡Œæµå¼ä¼ è¾“ã€‚

![](./assets/nextjs-streaming-with-suspense.jpeg)

æ›´å¤šå…³äº Stream æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒ [Loading UI and Streaming](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)ã€[How to fetch data and stream](https://nextjs.org/docs/app/getting-started/fetching-data#streaming)ã€[Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components#streaming)

### å®¢æˆ·ç«¯ç»„ä»¶

ä½†æ˜¯æœåŠ¡å™¨ç»„ä»¶ä¹Ÿæœ‰é™åˆ¶ã€‚æœåŠ¡å™¨ç»„ä»¶ä¸èƒ½æœ‰äº‹ä»¶å¤„ç†å‡½æ•°ã€ä¸èƒ½ä½¿ç”¨ `useState`ã€`useEffect` ç­‰ React Hookã€ä¸èƒ½ä½¿ç”¨ Web ä¸“æœ‰çš„ APIï¼Œæ¯”å¦‚ [geolocation](https://developer.mozilla.org/docs/Web/API/Geolocation_API)ã€[localStorage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) ç­‰ã€‚æ¯”å¦‚ä¸‹é¢ç»„ä»¶ä½¿ç”¨äº†äº‹ä»¶å¤„ç†å‡½æ•°

```tsx
export default function Component() {
  return (
    <div>
      <button onClick={() => console.log("clicked")}>Click Me</button>
    </div>
  );
}
```

è¿è¡Œæ—¶æŠ¥é”™

![](./assets/nextjs-server-component-error-event.png)

è¿™äº›éƒ½å¿…é¡»ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ã€‚å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨ [`"use client"`](https://react.dev/reference/react/use-client) æ¥æ ‡è¯†ã€‚

```tsx
'use client'
import { useState } from 'react'
 
export default function Counter() {
  const [count, setCount] = useState(0)
  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

### æœåŠ¡å™¨ç»„ä»¶ VS å®¢æˆ·ç«¯ç»„ä»¶

æˆ‘åº”è¯¥ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æœåŠ¡å™¨ç»„ä»¶ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶å‘¢ï¼Ÿä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­ã€‚

![](./assets/nextjs-server-vs-client-component.png)

## è·å–æ•°æ®

Next.js ä¸­è·å–æ•°æ®åˆ†ä¸ºæœåŠ¡å™¨ç»„ä»¶è·å–æ•°æ®å’Œå®¢æˆ·ç«¯ç»„ä»¶è·å–æ•°æ®

### æœåŠ¡å™¨ç»„ä»¶è·å–æ•°æ®

#### æ•°æ®åº“

æœåŠ¡å™¨ç»„ä»¶ä¸€èˆ¬éƒ½ä¼šè·å–æ•°æ®åº“çš„æ•°æ®ã€‚ç”¨æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦å°†æœåŠ¡å™¨ç»„ä»¶æ”¹ä¸ºå¼‚æ­¥å³å¯ã€‚

```tsx
import { db, posts } from '@/lib/db'
 
export default async function Page() {
  const allPosts = await db.select().from(posts)
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

#### ç¬¬ä¸‰æ–¹æœåŠ¡

æœåŠ¡å™¨ç»„ä»¶æœ‰å¯èƒ½éœ€è¦è·å–ç¬¬ä¸‰æ–¹æœåŠ¡çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ Next.js çš„ [`fetch` æ–¹æ³•](https://nextjs.org/docs/app/api-reference/functions/fetch)ã€‚Next.js çš„ `fetch` æ–¹æ³•æ‰©å±•äº† Web çš„ [`fetch()` æ–¹æ³•](https://developer.mozilla.org/docs/Web/API/Fetch_API)ï¼Œå¹¶æ·»åŠ äº†æœåŠ¡å™¨ç¼“å­˜ã€‚

```tsx
export default async function Page() {
  const data = await fetch('https://api.vercel.app/blog')
  const posts = await data.json()
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

### å®¢æˆ·ç«¯ç»„ä»¶è·å–æ•°æ®

#### `use` æ–¹æ³•

å®¢æˆ·ç«¯ç»„ä»¶è·å–æ•°æ®æ¨èä½¿ç”¨ React 19+ çš„ [`use` æ–¹æ³•](https://react.dev/reference/react/use)ã€‚

é¦–å…ˆå‚è€ƒä¸Šä¸€èŠ‚çš„å†…å®¹ï¼Œåœ¨æœåŠ¡å™¨ç»„ä»¶é‡Œè·å–æ•°æ®ï¼Œç„¶åä¼ é€’æ•°æ® Promise ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚è¿™ç§æ–¹å¼èƒ½é˜»æ­¢ Promise é˜»å¡æœåŠ¡å™¨ç»„ä»¶çš„æ¸²æŸ“ã€‚

```tsx
import Posts from '@/app/ui/posts
import { Suspense } from 'react'
 
export default function Page() {
  // Don't await the data fetching function
  const posts = getPosts()
 
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Posts posts={posts} />
    </Suspense>
  )
}
```

ç„¶åå®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨  [`use` æ–¹æ³•](https://react.dev/reference/react/use) æ¥æ”¶æ•°æ® Promise

```tsx
'use client'
import { use } from 'react'
 
export default function Posts({
  posts,
}: {
  posts: Promise<{ id: string; title: string }[]>
}) {
  const allPosts = use(posts)
 
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

æ³¨æ„ï¼Œå®¢æˆ·ç«¯ç»„ä»¶éœ€è¦ä½¿ç”¨ [`Suspense`](https://react.dev/reference/react/Suspense) è¿›è¡ŒåŒ…è£¹ï¼Œå› ä¸ºè·å–æ•°æ®æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚Promise æœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œå› æ­¤è¿˜åº”è¯¥æ·»åŠ  ErrorBoundaryï¼Œæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [`use` - Dealing with rejected Promises](https://react.dev/reference/react/use#dealing-with-rejected-promises)ã€‚

#### ç¬¬ä¸‰æ–¹åº“

æ¨èä½¿ç”¨ [SWR](https://swr.vercel.app/) å’Œ [React Query](https://tanstack.com/query/latest)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ [`axios`](https://github.com/axios/axios)ã€‚

```tsx
'use client'
import useSWR from 'swr'
 
const fetcher = (url) => fetch(url).then((r) => r.json())
 
export default function BlogPage() {
  const { data, error, isLoading } = useSWR(
    'https://api.vercel.app/blog',
    fetcher
  )
 
  if (isLoading) return <div>Loading...</div>
  if (error) return <div>Error: {error.message}</div>
 
  return (
    <ul>
      {data.map((post: { id: string; title: string }) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

## å¯¼èˆª

Next.js æ”¯æŒ 4 ç§å¯¼èˆªæ–¹å¼ï¼š

- [`Link`](https://nextjs.org/docs/app/api-reference/components/link) ç»„ä»¶
- å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨ [`useRouter` hook](https://nextjs.org/docs/app/api-reference/functions/use-router)
- æœåŠ¡å™¨ç»„ä»¶ä½¿ç”¨ [`redirect` å‡½æ•°](https://nextjs.org/docs/app/api-reference/functions/redirect)
- åŸç”Ÿ [History API](https://developer.mozilla.org/en-US/docs/Web/API/History_API)

### `Link` ç»„ä»¶

`<Link>` æ˜¯ä¸€ä¸ª Next.js å†…ç½®ç»„ä»¶ï¼Œå®ƒæ‰©å±•äº†HTML `<a>` æ ‡ç­¾ï¼Œæä¾›è·¯ç”±é¢„å–åŠŸèƒ½ã€‚è¿™æ˜¯ Next.js æ¨èçš„å¯¼èˆªæ–¹å¼ã€‚

```ts
import Link from 'next/link'
 
export default function Page() {
  return <Link href="/dashboard">Dashboard</Link>
}
```

### `useRouter` hook

`useRouter` hookï¼Œç”¨äºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œä»¥ç¼–ç¨‹çš„æ–¹å¼è¿›è¡Œå¯¼èˆªã€‚

```ts
'use client'
 
import { useRouter } from 'next/navigation'
 
export default function Page() {
  const router = useRouter()
 
  return (
    <button type="button" onClick={() => router.push('/dashboard')}>
      Dashboard
    </button>
  )
}
```

### `redirect` å‡½æ•°

`redirect` å‡½æ•°ï¼Œç”¨äºæœåŠ¡å™¨ç»„ä»¶æˆ–è€… Server Actionï¼Œä»¥ç¼–ç¨‹çš„æ–¹å¼è¿›è¡Œå¯¼èˆªã€‚

```ts
import { redirect } from 'next/navigation'
 
export default async function Profile({
  params,
}: {
  params: Promise<{ id: string }>
}) {
  const { id } = await params
  if (!id) {
    redirect('/login')
  }
 
  // ...
}
```

### åŸç”Ÿ History API

Next.js ä¹Ÿå…è®¸ä½¿ç”¨åŸç”Ÿ [`window.history.pushState`](https://developer.mozilla.org/en-US/docs/Web/API/History/pushState) å’Œ [`window.history.replaceState`](https://developer.mozilla.org/en-US/docs/Web/API/History/replaceState) æ–¹æ³•è¿›è¡Œå¯¼èˆªï¼Œè¿™ä¸ªå¯¼èˆªæ–¹å¼å› ä¸ºä½¿ç”¨äº†Web APIï¼Œå› æ­¤åªèƒ½ç”¨äºå®¢æˆ·ç«¯ç»„ä»¶ã€‚

```ts
'use client'
 
import { useSearchParams } from 'next/navigation'
 
export default function SortProducts() {
  const searchParams = useSearchParams()
 
  function updateSorting(sortOrder: string) {
    const params = new URLSearchParams(searchParams.toString())
    params.set('sort', sortOrder)
    window.history.pushState(null, '', `?${params.toString()}`)
  }
 
  return (
    <>
      <button onClick={() => updateSorting('asc')}>Sort Ascending</button>
      <button onClick={() => updateSorting('desc')}>Sort Descending</button>
    </>
  )
}
```

æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [Linking and Navigating](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating)

## é”™è¯¯å¤„ç†

Next.js å°†é”™è¯¯å¤„ç†åˆ†ä¸ºï¼š

- å¯ä»¥é¢„è§çš„é”™è¯¯
- ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸

### å¯ä»¥é¢„è§çš„é”™è¯¯

1. å¯¹äºæœåŠ¡å™¨å‡½æ•°å¯ä»¥ä½¿ç”¨ [`useActionState`](https://react.dev/reference/react/useActionState) hookï¼Œè¿”å›é”™è¯¯ä¿¡æ¯

```ts
'use server'
 
export async function createPost(prevState: any, formData: FormData) {
  const title = formData.get('title')
  const content = formData.get('content')
 
  const res = await fetch('https://api.vercel.app/posts', {
    method: 'POST',
    body: { title, content },
  })
  const json = await res.json()
 
  if (!res.ok) {
    return { message: 'Failed to create post' }
  }
}
```

```tsx
'use client'
 
import { useActionState } from 'react'
import { createPost } from '@/app/actions'
 
const initialState = {
  message: '',
}
 
export function Form() {
  const [state, formAction, pending] = useActionState(createPost, initialState)
 
  return (
    <form action={formAction}>
      <label htmlFor="title">Title</label>
      <input type="text" id="title" name="title" required />
      <label htmlFor="content">Content</label>
      <textarea id="content" name="content" required />
      {state?.message && <p aria-live="polite">{state.message}</p>}
      <button disabled={pending}>Create Post</button>
    </form>
  )
}
```

2. å¯¹äºæœåŠ¡å™¨ç»„ä»¶ï¼Œå¯ä»¥è¿”å›å¸¦æœ‰é”™è¯¯ä¿¡æ¯çš„ response

```tsx
export default async function Page() {
  const res = await fetch(`https://...`)
  const data = await res.json()
 
  if (!res.ok) {
    return 'There was an error.'
  }
 
  return '...'
}
```

æˆ–è€…ä½¿ç”¨  [`redirect`](https://nextjs.org/docs/app/api-reference/functions/redirect) è¿›è¡Œé‡å®šå‘ï¼Œæ¯”å¦‚ç”¨æˆ·æ²¡æœ‰ç™»å½•æ—¶ï¼Œé‡å®šå‘åˆ°ç”¨æˆ·ç™»å½•ç•Œé¢

```tsx
export default async function Page() {
  if (!isLogin) {
    redirect("/login")
  }
  
  return '...'
}
```

å¯¹äº 404 é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨ [`notFound`](https://nextjs.org/docs/app/api-reference/functions/not-found) å‡½æ•°å’Œ [`not-found.js`](https://nextjs.org/docs/app/api-reference/file-conventions/not-found)

```tsx
export default async function Page({ params }: { params: { slug: string } }) {
  const { slug } = await params
  const post = getPostBySlug(slug)
 
  if (!post) {
    notFound()
  }
 
  return <div>{post.title}</div>
}
```

```tsx
export default function NotFound() {
  return <div>404 - Page Not Found</div>
}
```

### ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸

å¯¹äºä¸å¯é¢„çŸ¥çš„å¼‚å¸¸ï¼Œä½¿ç”¨ [`error.js`](https://nextjs.org/docs/app/api-reference/file-conventions/error) æ–‡ä»¶å’Œ [`global-error.js`](https://nextjs.org/docs/app/api-reference/file-conventions/error#global-error) æ–‡ä»¶

```tsx
'use client' // Error boundaries must be Client Components
 
import { useEffect } from 'react'
 
export default function Error({
  error,
  reset,
}: {
  error: Error & { digest?: string }
  reset: () => void
}) {
  useEffect(() => {
    // Log the error to an error reporting service
    console.error(error)
  }, [error])
 
  return (
    <div>
      <h2>Something went wrong!</h2>
      <button
        onClick={
          // Attempt to recover by trying to re-render the segment
          () => reset()
        }
      >
        Try again
      </button>
    </div>
  )
}
```

## ä¸­é—´ä»¶

Next.js å…è®¸åœ¨è¯·æ±‚å®Œæˆä¹‹å‰è¿è¡Œä¸­é—´ä»¶ã€‚å®ƒæ ¹æ®ä¼ å…¥çš„è¯·æ±‚ï¼Œé€šè¿‡é‡å†™ã€é‡å®šå‘ã€ä¿®æ”¹è¯·æ±‚æˆ–å“åº”å¤´ã€ç”šè‡³ç›´æ¥è¿”å›å“åº”æ¥ä¿®æ”¹åŸè¯·æ±‚çš„å“åº”ã€‚

æ­£å¦‚å‰é¢ä»‹ç»çš„ï¼Œé€šè¿‡é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `middleware.ts` æ–‡ä»¶å®šä¹‰ä¸­é—´ä»¶ï¼Œä¸€èˆ¬æ ¼å¼å¦‚ä¸‹

```ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'
 
// This function can be marked `async` if using `await` inside
export function middleware(request: NextRequest) {
  return NextResponse.redirect(new URL('/home', request.url))
}
 
// åŒ¹é…è¯·æ±‚è·¯ç”±
export const config = {
  matcher: '/about/:path*',
}
```

é»˜è®¤ Next.js ä¸­é—´ä»¶å¤„ç†æ¯ä¸€ä¸ªè¯·æ±‚è·¯ç”±ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ `config.matcher` è¿›è¡Œé…ç½®ï¼Œåªæœ‰åŒ¹é…çš„è·¯ç”±æ‰ä½¿ç”¨ä¸­é—´ä»¶ï¼Œæ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™è¡¨è¾¾å¼ã€å¯¹è±¡ä»¥åŠä»¥ä¸Šä¸‰ç§ç±»å‹ç»„æˆçš„æ•°ç»„ã€‚

 `config.matcher` æ”¯æŒçš„å¯¹è±¡æ ¼å¼å¦‚ä¸‹ï¼š

- sourceï¼šåŒ¹é…è¯·æ±‚è·¯ç”±çš„è·¯å¾„æˆ–æ¨¡å¼ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²å’Œæ­£åˆ™è¡¨è¾¾å¼
- regexpï¼ˆå¯é€‰ï¼‰ï¼šæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œæ ¹æ® `source` å¯¹åŒ¹é…è¿›è¡Œå¾®è°ƒ
- localeï¼ˆå¯é€‰ï¼‰ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå½“è®¾ç½®ä¸º `false` æ—¶ï¼Œå¿½ç•¥è·¯å¾„åŒ¹é…ä¸­åŸºäºåœ°åŒºçš„è·¯ç”±
- hasï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šè·¯ç”±è¯·æ±‚ä¸­å¿…é¡»å­˜åœ¨ç‰¹å®šè¯·æ±‚å…ƒç´ ï¼ˆå¦‚ headersã€æŸ¥è¯¢å‚æ•°æˆ– cookieï¼‰
- missingï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šè·¯ç”±è¯·æ±‚ä¸­**ä¸**å­˜åœ¨ç‰¹å®šè¯·æ±‚å…ƒç´ ï¼ˆå¦‚ headersã€æŸ¥è¯¢å‚æ•°æˆ– cookieï¼‰

ä¸€ä¸ªå¤æ‚çš„ä¾‹å­å¦‚ä¸‹ï¼š

```ts
export const config = {
  matcher: [
    /*
     * Match all request paths except for the ones starting with:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico, sitemap.xml, robots.txt (metadata files)
     */
    {
      source:
        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',
      missing: [
        { type: 'header', key: 'next-router-prefetch' },
        { type: 'header', key: 'purpose', value: 'prefetch' },
      ],
    },
 
    {
      source:
        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',
      has: [
        { type: 'header', key: 'next-router-prefetch' },
        { type: 'header', key: 'purpose', value: 'prefetch' },
      ],
    },
 
    {
      source:
        '/((?!api|_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt).*)',
      has: [{ type: 'header', key: 'x-present' }],
      missing: [{ type: 'header', key: 'x-missing', value: 'prefetch' }],
    },
  ],
}
```

ä¸­é—´ä»¶çš„åº”ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚è®¾ç½®å“åº”å¤´ã€ç™»å½•éªŒè¯ä¸æˆæƒã€CORS ç­‰ï¼Œä¸‹é¢ä»¥ CORS  ä¸¾ä¾‹è¯´æ˜

```ts
import { NextRequest, NextResponse } from 'next/server'
 
// å…è®¸çš„ origin
const allowedOrigins = ['https://acme.com', 'https://my-app.org']
 
// Cors Headers
const corsOptions = {
  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
}
 
export function middleware(request: NextRequest) {
  // Check the origin from the request
  const origin = request.headers.get('origin') ?? ''
  const isAllowedOrigin = allowedOrigins.includes(origin)
 
  // Handle preflighted requests
  const isPreflight = request.method === 'OPTIONS'
 
  if (isPreflight) {
    const preflightHeaders = {
      ...(isAllowedOrigin && { 'Access-Control-Allow-Origin': origin }),
      ...corsOptions,
    }
    return NextResponse.json({}, { headers: preflightHeaders })
  }
 
  // Handle simple requests
  // `next()` è¡¨ç¤ºç»§ç»­è·¯ç”±
  const response = NextResponse.next()
 
  if (isAllowedOrigin) {
    response.headers.set('Access-Control-Allow-Origin', origin)
  }
 
  Object.entries(corsOptions).forEach(([key, value]) => {
    response.headers.set(key, value)
  })
 
  return response
}
 
export const config = {
  matcher: '/api/:path*',
}
```

## ç¼“å­˜

Next.js æ”¯æŒå››ç§ç¼“å­˜æœºåˆ¶

![](./assets/nextjs-caching-category.png)

å®ƒä»¬çš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹

![](./assets/nextjs-caching-overview.jpeg)

### Request Memoization

ä¸Šé¢è®²æœåŠ¡å™¨ç»„ä»¶è·å–æ•°æ®æ—¶ï¼Œä»‹ç»äº† Next.js çš„ `fetch` æ–¹æ³•ã€‚å®ƒæ‰©å±•äº† Web çš„ [`fetch()` æ–¹æ³•](https://developer.mozilla.org/docs/Web/API/Fetch_API)ï¼Œå¹¶ä¸”å¯¹ç›¸åŒçš„è¯·æ±‚ï¼ˆURL å’Œè¯·æ±‚å‚æ•°ç›¸åŒï¼‰ï¼Œç¼“å­˜å…¶ç»“æœã€‚ä½†æ˜¯å®ƒåªåº”ç”¨äº React ç»„ä»¶æ ‘ï¼ˆLayoutã€Pageã€æœåŠ¡å™¨ç»„ä»¶ã€`generateMetadata`, `generateStaticParams`ï¼‰ï¼Œåœ¨ç»„ä»¶æ ‘çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªè¯·æ±‚ï¼Œåç»­çš„è¯·æ±‚ä½¿ç”¨ç¼“å­˜ã€‚è¿™ç§ç¼“å­˜æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œåªé€‚ç”¨äº `GET` è¯·æ±‚ï¼Œåœ¨ React ç»„ä»¶æ ‘æ¸²æŸ“å®Œæˆä¹‹åï¼Œç¼“å­˜å¤±æ•ˆã€‚

![](./assets/nextjs-request-memoization.jpeg)

### Data Cache

Data Cache ä¹Ÿæ˜¯é€šè¿‡ `fetch` æ–¹æ³•è¿›è¡Œç¼“å­˜çš„ï¼Œä¸ Request Memoization ä¸åŒçš„æ˜¯ï¼ŒRequest Memoization æ˜¯è‡ªåŠ¨å¼€å¯çš„ï¼Œè€Œ Data Cache éœ€è¦è¿›è¡Œé…ç½®ï¼ŒRequest Memoization çš„ç¼“å­˜åªèƒ½åœ¨åŒä¸€ React ç»„ä»¶æ ‘é‡Œæœ‰æ•ˆï¼Œè€Œ Data Cache å¯ä»¥è·¨æœåŠ¡å™¨è¯·æ±‚å’Œéƒ¨ç½²ã€‚

å½“ Next.js å‘å‡ºå¸¦æœ‰ `{cache: 'force-cache'}` é€‰é¡¹çš„ `fetch` è¯·æ±‚æ—¶ï¼Œå…¶ç»“æœç¼“å­˜åˆ° Data Cacheã€‚å¦‚æœ `fetch` è¯·æ±‚æ²¡æœ‰ `cache`  é€‰é¡¹ï¼Œæˆ–è€…å¸¦æœ‰ `{cache: 'no-cache'}` é€‰é¡¹ï¼Œåˆ™è¯·æ±‚ç»“æœä¸ç¼“å­˜ã€‚

![](./assets/nextjs-data-cache.jpeg)

é»˜è®¤ Data Cache çš„ç¼“å­˜ä¸€ç›´æœ‰æ•ˆï¼Œä½†æ˜¯æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ä½¿å…¶å¤±æ•ˆï¼š

- è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ**Time-based Revalidation**ï¼‰ï¼šä½¿ç”¨  `next.revalidate` é€‰é¡¹è®¾ç½®è¿‡æœŸæ—¶é—´

```js
// Revalidate at most every hour
fetch('https://...', { next: { revalidate: 3600 } })
```

- æ‰‹åŠ¨è®¾ç½®å¤±æ•ˆï¼ˆ**On-demand Revalidation**ï¼‰

ä½¿ç”¨  [`revalidatePath`](https://nextjs.org/docs/app/building-your-application/caching#revalidatepath) æˆ– [`revalidateTag`](https://nextjs.org/docs/app/building-your-application/caching#fetch-optionsnexttags-and-revalidatetag) è®¾ç½®ç¼“å­˜å¤±æ•ˆ

```js
// Path
import { revalidatePath } from 'next/cache'
 
export default async function submit() {
  await addPost()
  revalidatePath('posts')
}

// Tag
// fetch(`https://...`, { next: { tags: ['a', 'b', 'c'] } })
import { revalidateTag } from 'next/cache'
 
export default async function submit() {
  await addPost()
  revalidateTag('a')
}
```

### Full Route Cache

ä¸Šé¢ä»‹ç»æœåŠ¡å™¨ç»„ä»¶æ—¶ï¼Œæ›¾è¯´åˆ°æœåŠ¡å™¨ç»„ä»¶é™æ€æ¸²æŸ“çš„å†…å®¹å¯ä»¥è¢«ç¼“å­˜ï¼Œå› æ­¤æœ‰å¥½çš„æ€§èƒ½ä¼˜åŠ¿ã€‚è¿™é‡Œçš„ç¼“å­˜å°±æ˜¯æŒ‡ Full Route Cacheã€‚å®ƒç¼“å­˜ RSC Payload å’Œ ç”Ÿæˆçš„ HTMLã€‚

![](./assets/nextjs-full-route-cache.jpeg)

é»˜è®¤ Full Route Cache çš„ç¼“å­˜ä¸€ç›´æœ‰æ•ˆï¼Œä½†æ˜¯æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ä½¿å…¶æ— æ•ˆï¼š

- ä½¿ Data Cache å¤±æ•ˆï¼Œç„¶åä¼šåœ¨æœåŠ¡å™¨ä¸Šé‡æ–°æ¸²æŸ“ç»„ä»¶å¹¶ç¼“å­˜æ–°çš„æ¸²æŸ“ç»“æœï¼Œä»è€Œä½¿ Full Route Cache  ç¼“å­˜å¤±æ•ˆ
- é‡æ–°éƒ¨ç½²

Full Route Cache åªèƒ½åº”ç”¨äºæœåŠ¡å™¨ç»„ä»¶é™æ€æ¸²æŸ“ã€‚ä»¥ä¸‹å››ç§æ“ä½œå°†ä¸èƒ½åˆ©ç”¨ Full Route Cacheï¼š

- ä½¿ç”¨ [åŠ¨æ€ API](https://nextjs.org/docs/app/deep-dive/caching#dynamic-apis)ï¼ŒNext.js å°†ä½¿ç”¨åŠ¨æ€æ¸²æŸ“
- ä½¿ç”¨ `dynamic = 'force-dynamic'` é€‰é¡¹é…ç½®è·¯ç”±æ®µï¼Œå¼ºåˆ¶åŠ¨æ€æ¸²æŸ“
- ä½¿ç”¨ `revalidate = 0` é€‰é¡¹é…ç½®è·¯ç”±ç«¯
- å¸¦æœ‰ `{cache: 'no-cache'}` é€‰é¡¹ï¼ˆ `fetch` è¯·æ±‚çš„é»˜è®¤å€¼ï¼‰çš„ `fetch` è¯·æ±‚

### Client-side Router Cache

Next.js js æœ‰ä¸€ä¸ªå†…å­˜çš„ Client-side Router Cacheï¼Œå®ƒç¼“å­˜è·¯ç”±æ®µçš„ RSC Payloadã€‚å½“ç”¨æˆ·åœ¨è·¯ç”±ä¹‹é—´å¯¼èˆªæ—¶ï¼ŒNext.js ä¼šç¼“å­˜è®¿é—®è¿‡çš„è·¯ç”±æ®µï¼Œå¹¶é¢„å–ç”¨æˆ·å¯èƒ½å¯¼èˆªåˆ°çš„è·¯ç”±ã€‚è¿™å¯¼è‡´äº†å³æ—¶çš„åé€€/å‰è¿›å¯¼èˆªï¼Œåœ¨å¯¼èˆªä¹‹é—´ä¸éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ï¼Œå¹¶ä¸”ä¿ç•™äº† React çŠ¶æ€å’Œæµè§ˆå™¨çŠ¶æ€ã€‚

Client-side Router Cache å°†

- ç¼“å­˜ Layout å’Œ Loadingï¼Œåœ¨å¯¼èˆªä¸Šçš„æ—¶å€™å¯ä»¥å¤ç”¨ã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒPage ä¸ç¼“å­˜ï¼Œä½†å¯ä»¥åœ¨æµè§ˆå™¨å‘åå’Œå‘å‰å¯¼èˆªæ—¶å¤ç”¨ã€‚

## References

- [Next.js](https://nextjs.org/)
- [Route Segment Config](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config)
- [Middle](https://nextjs.org/docs/app/building-your-application/routing/middleware)
- [Caching](https://nextjs.org/docs/app/deep-dive/caching)
- [Linking and Navigating](https://nextjs.org/docs/app/building-your-application/routing/linking-and-navigating)
- [React](https://react.dev)
- [React-Router](https://reactrouter.com/)
- [SWR](https://swr.vercel.app/)
- [React Query](https://tanstack.com/query/latest)
- [`axios/axios`](https://github.com/axios/axios)
