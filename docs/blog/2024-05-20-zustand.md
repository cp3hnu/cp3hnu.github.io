---
pageClass: blog-page
title: Zustand
tags:
  - web
  - react
date: 2024-05-20
author: cp3hnu
location: ChangSha
summary: Zustand æ˜¯ä¸€ä¸ª React çŠ¶æ€ç®¡ç†çš„åº“ï¼Œå®ƒæ¯” Redux æ›´ç®€å•ã€æ›´è½»ä¾¿ã€æ›´çµæ´»ï¼Œä½¿ç”¨èµ·æ¥å°±åƒåœ¨ç”¨ React hook ä¸€æ ·ï¼Œæ²¡æœ‰ Redux é‚£ä¹ˆå¤šçš„æ ·æ¿ä»£ç ã€‚
---

# Zustand

[Zustand](https://github.com/pmndrs/zustand) æ˜¯ä¸€ä¸ª React çŠ¶æ€ç®¡ç†çš„åº“ï¼Œå®ƒæ¯” Redux æ›´ç®€å•ã€æ›´è½»ä¾¿ã€æ›´çµæ´»ï¼Œä½¿ç”¨èµ·æ¥å°±åƒåœ¨ç”¨ React hook ä¸€æ ·ï¼Œæ²¡æœ‰ Redux é‚£ä¹ˆå¤šçš„æ ·æ¿ä»£ç ã€‚

## å®‰è£…

```sh
$ pnpm i zustand
```

## åŸºæœ¬ç”¨æ³•

```ts
// useBearStore.ts
import { create } from 'zustand';

type BearStore = {
  bears: number;
  increase: () => void;
  reset: () => void;
};

const useBearStore = create<BearStore>()((set) => ({
  bears: 0,
  increase: () => set((state) => ({ bears: state.bears + 1 })),
  reset: () => set({ bears: 0 }),
}));

export default useBearStore;
```

> ğŸ“¢  åœ¨ Typescript ä¸­ï¼Œ`create` æ–¹æ³•éœ€è¦å®šä¹‰ store çš„ç±»å‹å’Œä½¿ç”¨ curry å‡½æ•°ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [TypeScript Guide](https://docs.pmnd.rs/zustand/guides/typescript)ã€‚

åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨

```react
import useBearStore from '@/store/useBearStore';

function BasicPage() {
  // æ¨èä½¿ç”¨ selectorï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“
  const bears = useBearStore((state) => state.bears);
  const increase = useBearStore((state) => state.increase);
  const reset = useBearStore((state) => state.reset);
  // å¦‚æœç¡®å®šä¸ä¼šå¼•èµ·ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿™ä¹ˆä½¿ç”¨
  // const { bears, increase, reset } = useBearStore();
  return (
    <div>
      <div>{bears}</div>
      <div>
        <Button onClick={increase}>å¢åŠ </Button>
        <Button onClick={reset}>é‡ç½®</Button>
      </div>
    </div>
  );
}

export default BasicPage;
```

å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå°±åƒåœ¨ä½¿ç”¨ React Hook ä¸€æ ·ã€‚

## Selector

å¦‚ä¸Šé¢çš„ä¾‹å­æ‰€ç¤ºï¼Œä½¿ç”¨ store çš„æ—¶å€™ï¼Œzustand æ¨èä½¿ç”¨ selectorï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚

```ts
const bears = useBearStore((state) => state.bears);
const increase = useBearStore((state) => state.increase);
```

å¦‚æœæœ‰å¾ˆå¤šçš„çŠ¶æ€å€¼ï¼Œä¸æƒ³é‡å¤è¿™äº›æ ·æ¿ä»£ç ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆ selector çš„å‡½æ•°: `createSelectors`

```ts
import { StoreApi, UseBoundStore } from 'zustand'

type WithSelectors<S> = S extends { getState: () => infer T }
  ? S & { use: { [K in keyof T]: () => T[K] } }
  : never

const createSelectors = <S extends UseBoundStore<StoreApi<object>>>(
  _store: S,
) => {
  let store = _store as WithSelectors<typeof _store>
  store.use = {}
  for (let k of Object.keys(store.getState())) {
    (store.use as any)[k] = () => store((s) => s[k as keyof typeof s])
  }

  return store
}
```

ç„¶åå°±ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥ç®€åŒ–ä»£ç ï¼Œ æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒ [Auto Generating Selectors](https://docs.pmnd.rs/zustand/guides/auto-generating-selectors).

```ts
const useBearStoreSelector = createSelectors(useBearStore);

const bears = useBearStore.use.bears()
const increment = useBearStore.use.increment()
```

> å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆ zustand æŠŠè¿™ç§è§£å†³æ–¹æ¡ˆå†™åœ¨æ–‡æ¡£äº†ï¼Œè€Œä¸ç›´æ¥å†™æˆ API å‘¢ï¼Ÿ

#### useShallow

Zustand ä½¿ç”¨ [Object.is](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is?retiredLocale=it) åˆ¤æ–­ selector è¿”å›çš„çŠ¶æ€å€¼æ˜¯å¦å‘ç°äº†å˜åŒ–ï¼Œå¯¹äº primitive ç±»å‹çš„å€¼æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœ selector è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨  [`useShallow`](https://github.com/pmndrs/zustand/blob/main/docs/guides/prevent-rerenders-with-use-shallow.md) æ¥æ¯”è¾ƒå€¼æ˜¯å¦çœŸçš„å‘ç”Ÿäº†å˜åŒ–ã€‚

```ts
// useMeals.ts
import { create } from 'zustand';

type MealsStore = {
  papaBear: string;
  mamaBear: string;
  littleBear: string;
};

const useMeals = create<MealsStore>()(() => ({
  papaBear: 'large porridge-pot',
  mamaBear: 'middle-size porridge pot',
  littleBear: 'A little, small, wee pot',
}));

export default useMeals;
```
ç»„ä»¶ä½¿ç”¨
```react
import useMeals from '@/store/useMeals';
import { useShallow } from 'zustand/react/shallow';

const SelectorPage = () => {
  const names = useMeals(useShallow((state) => Object.keys(state)));

  const changePapaBear = () => {
    useMeals.setState({
      papaBear: 'a large pizza',
    });
  };

  return (
    <div className={styles.container}>
      <div style={{ marginBottom: 30, fontSize: 30 }}>{names.join(', ')}</div>
      <Button onClick={changePapaBear}></Button>
    </div>
  );
};

export default SelectorPage;
```

ä¿®æ”¹ `papaBear` çš„å€¼å¹¶ä¸å½±å“ `Object.keys(state)` çš„å€¼ï¼Œä½†æ˜¯å¦‚æœä¸ä½¿ç”¨ `useShallow` ä¼šå¯¼è‡´ `Object.keys(state)` æ¯æ¬¡è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œ[Object.is](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is?retiredLocale=it) åˆ¤æ–­ `false`ï¼Œä»è€Œå¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ[`useShallow`](https://github.com/pmndrs/zustand/blob/main/docs/guides/prevent-rerenders-with-use-shallow.md) å’Œ React PureComponent ä¸€æ ·æ˜¯æµ…å±‚æ¬¡çš„æ¯”è¾ƒï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ·±å±‚æ¬¡çš„æ¯”è¾ƒå¯ä»¥è‡ªå®šä¹‰ç›¸ç­‰å‡½æ•°ï¼Œæ¯”å¦‚ä½¿ç”¨ lodash çš„ [`isEqual`](https://lodash.com/docs/4.17.15#isEqual) å‡½æ•°ã€‚

```ts
const treats = useBearStore(
  (state) => state.treats,
  (oldTreats, newTreats) => _.isEqual(oldTreats, newTreats)
)
```

## å¼‚æ­¥

Zustand ä½¿ç”¨å¼‚æ­¥ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥å®šä¹‰å¼‚æ­¥å‡½æ•°å³å¯ï¼Œæ— éœ€é¢å¤–çš„é…ç½®ã€‚ç»„ä»¶ä½¿ç”¨ä¹Ÿæ²¡æœ‰åŒºåˆ«ã€‚

```ts
// useUserStore.ts
import { getCurrentUserReq } from '@/services/user';
import { create } from 'zustand';

type UserStore = {
  user?: API.UserInfo;
  getUser: () => void;
};

const useUserStore = create<UserStore>()((set) => ({
  user: undefined,
  getUser: async () => {
    const { data, success } = await getCurrentUserReq();
    if (success) {
      set({ user: data });
    }
  },
}));

export default useUserStore;
```

## éå“åº”å¼

`useBearStore()` ä½œä¸º React Hook åªèƒ½ç”¨äº React ç»„ä»¶ï¼Œæ€ä¹ˆåœ¨ React ç»„ä»¶å¤–é¢ä½¿ç”¨ zustand å‘¢ï¼ŸZustand æä¾›äº†ä¸‹é¢çš„ API æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š

- `getInitialState` - è·å–çŠ¶æ€å€¼
- `getState` - è·å–çŠ¶æ€å€¼
- `setState` - è®¾ç½®çŠ¶æ€å€¼
- `subscribe` - è®¢é˜…çŠ¶æ€çš„å˜åŒ–

```tsx
const increase = () => {
  const preBears = useBearStore.getState().bears;
  useBearStore.setState({ bears: preBears + 1 });
};

const reset = () => {
  useBearStore.setState({ bears: 0 });
};

const unsub = useBearStore.subscribe((cur, pre) => {
  console.log(cur, pre);
});

// å–æ¶ˆè®¢é˜…
unsub();
```

> ğŸ“¢ ä¸Šé¢çš„ä¾‹å­ä¸­æ˜¯ `useBearStore` è€Œä¸æ˜¯ `useBearStore()`

æ­¤å¤– Zustand æä¾›äº† `createStore` API ä¸“ç”¨äºéå“åº”å¼çš„æƒ…å½¢

```js
import { createStore } from 'zustand/vanilla'

const store = createStore((set) => ...)
const { getState, setState, subscribe, getInitialState } = store

export default store
```

è¿™ç§æƒ…å†µå¦‚æœæƒ³è½¬æ¢ä¸ºå“åº”å¼ï¼Œä½¿ç”¨ `useStore` hook

```js
import { useStore } from 'zustand'
import { vanillaStore } from './vanillaStore'

const useBoundStore = (selector) => useStore(vanillaStore, selector)
```

## Slices æ¨¡å¼

éšç€åŠŸèƒ½è¶Šæ¥å¤šï¼Œstore ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œè¶Šæ¥è¶Šéš¾ç»´æŠ¤ã€‚è¿™ä¸ªæ—¶å€™ä½ å¯ä»¥æŠŠ store åˆ†æˆæ›´å°çš„ slicesï¼Œç„¶åå°† slices ç»„åˆèµ·æ¥

```ts
import { create, StateCreator } from 'zustand';

interface BearSlice {
  bears: number;
  addBear: () => void;
  eatFish: () => void;
}

interface FishSlice {
  fishes: number;
  addFish: () => void;
}

interface SharedSlice {
  addBoth: () => void;
  getBoth: () => void;
}

const createBearSlice: StateCreator<
  BearSlice & FishSlice,
  [],
  [],
  BearSlice
> = (set) => ({
  bears: 0,
  addBear: () => set((state) => ({ bears: state.bears + 1 })),
  eatFish: () => set((state) => ({ fishes: state.fishes - 1 })),
});

const createFishSlice: StateCreator<
  BearSlice & FishSlice,
  [],
  [],
  FishSlice
> = (set) => ({
  fishes: 0,
  addFish: () => set((state) => ({ fishes: state.fishes + 1 })),
});

const createSharedSlice: StateCreator<
  BearSlice & FishSlice,
  [],
  [],
  SharedSlice
> = (set, get) => ({
  addBoth: () => {
    // you can reuse previous methods
    get().addBear();
    get().addFish();
    // or do them from scratch
    // set((state) => ({ bears: state.bears + 1, fishes: state.fishes + 1 })
  },
  getBoth: () => get().bears + get().fishes,
});

const useBoundStore = create<BearSlice & FishSlice & SharedSlice>()((...a) => ({
  ...createBearSlice(...a),
  ...createFishSlice(...a),
  ...createSharedSlice(...a),
}));

export default useBoundStore;
```

## Store æ··ç”¨

Slices æ¨¡å¼åªæ˜¯å°†ä¸€ä¸ªå¤æ‚çš„ store å…ˆæ‹†åˆ†å†åˆå¹¶ï¼Œæˆ‘æ›´å–œæ¬¢ [Pinia](https://pinia.vuejs.org/) çš„æ¨¡å¼ï¼šç›´æ¥åœ¨ store é‡Œä½¿ç”¨å¦å¤–çš„ storesã€‚

ä¸Šé¢çš„ Slices æ¨¡å¼å¯ä»¥è¿™æ ·ä½¿ç”¨ `useFishStore` å’Œ `useMixStore` æ˜¯ç‹¬ç«‹çš„ store.

```ts
// useFishStore.ts
import { create } from 'zustand';

type FishStore = {
  fishes: number;
  addAFish: () => void;
  substractAFish: () => void;
};

const useFishStore = create<FishStore>()(
  (set, get) => ({
      fishes: 0,
      addFish: () => set({ fishes: get().fishes + 1 }),
      substractFish: () => set({ fishes: get().fishes - 1 }),
    })
);

export default useFishStore;
```
åœ¨å…¶å®ƒçš„ store é‡Œä½¿ç”¨ `useFishStore`
```ts
// useMixStore.ts
import { create } from 'zustand';
import useFishStore from './useFishStore';

type BearStore = {
  bears: number;
  addBear: () => void;
  eatFish: () => void;
};
const useMixStore = create<BearStore>()((set) => ({
  bears: 0,
  addBear: () => set((state) => ({ bears: state.bears + 1 })),
  eatFish: () => {
    const fishes = useFishStore.getState().fishes;
    useFishStore.setState({ fishes: fishes - 1 });
    // æˆ–è€…
    // useFishStore.getState().substractFish();
  },
}));

export default useMixStore;
```

## ä¸­é—´ä»¶

Zustand æä¾›äº†å¤šä¸ªä¸­é—´ä»¶ï¼Œæ¥å¢å¼ºåŠŸèƒ½ã€ç®€åŒ–ä»£ç 

### Combine

å‰é¢æåˆ°åœ¨ Typescript ä¸­ï¼Œzustand çš„ `create` æ–¹æ³•éœ€è¦å®šä¹‰ store çš„ç±»å‹å’Œä½¿ç”¨ curry å‡½æ•°ï¼Œä½†æ˜¯é€šè¿‡ `combine` ä¸­é—´ä»¶å°±å…å»äº†è¿™äº›æ“ä½œ

```ts
import { create } from 'zustand'
import { combine } from 'zustand/middleware'

const useBearStore = create(
  combine({ bears: 0 }, (set) => ({
    increase: (by: number) => set((state) => ({ bears: state.bears + by })),
  })),
)
```

`useBearStore` èƒ½è¢«æ­£ç¡®æ¨å¯¼å‡ºç±»å‹ã€‚

### Immer

Zustand å’Œ Redux ä¸€æ ·éƒ½æ˜¯åˆå¹¶ stateï¼Œè¦æ±‚ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œè¿™å¯¹åº”ä¿®æ”¹åµŒå¥—å¯¹è±¡ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥ Zustand å’Œ Redux ä¸€æ ·ä½¿ç”¨ [`Immer`](https://github.com/mweststrate/immer)ï¼Œæ¥ç®€åŒ–ä¿®æ”¹åµŒå¥—å¯¹è±¡çš„å€¼

**ä½¿ç”¨ `Immer` åº“**

```ts
import { produce } from 'immer';
import { create } from 'zustand';

type BeeStore = {
  lush: { forest: { bees: number } };
  addBees: (by: number) => void;
};

const useBeeStore = create<BeeStore>()((set) => ({
  lush: { forest: { bees: 0 } },
  addBees: (by) =>
    set(
      produce((state) => {
        state.lush.forest.bees += by;
      }),
    ),
}));

export default useBeeStore;
```

**ä½¿ç”¨ `Immer` ä¸­é—´ä»¶**

```ts
import { create } from 'zustand'
import { immer } from 'zustand/middleware/immer'

type BeeStore = {
  lush: { forest: { bees: number } };
  addBees: (by: number) => void;
};

const useBeeStore = create<BeeStore>()(
  immer((set) => ({
    lush: { forest: { bees: 0 } },
    addBees: (by) =>
      set((state) => {
        state.lush.forest.bees += by;
      }),
  })),
);
```

### SubscribeWithSelector

Zustand çš„ `subscribe` æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œstore çš„ä»»ä½•æ”¹å˜éƒ½ä¼šè§¦å‘ `subscribe` å›è°ƒï¼Œå¦‚æœä½ åªæƒ³æŸä¸ªå€¼å˜åŒ–æ—¶æ‰è§¦å‘ `subscribe` å›è°ƒï¼Œå¯ä»¥ä½¿ç”¨ `subscribeWithSelector` ä¸­é—´ä»¶

```ts
type BearStore = {
  bears: number;
  bees: number;
};

const useBearStoreWithSelector = create<BearStore>()(
  subscribeWithSelector(() => ({
    bears: 0,
    bees: 0,
  })),
);

const unsub = useBearStoreWithSelector.subscribe(
  (state) => state.bears,
  (curBears, preBears) => {
    console.log(curBears, preBears);
  },
);

// å–æ¶ˆè®¢é˜…
unsub()
```

ä½¿ç”¨ `subscribeWithSelector` ä¸­é—´ä»¶ä¹Ÿæ”¯æŒè®¢é˜…æ•´ä¸ª state

```ts
const unsub = useBearStoreWithSelector.subscribe(
  (curState, preState) => {
    console.log(curState, preState);
  },
);
```

### Persist

ä½¿ç”¨ `persist` ä¸­é—´ä»¶æŒä¹…åŒ– store æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»æ„çš„å‚¨å­˜åº“ï¼Œæ¯”å¦‚ [`localStorage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) (é»˜è®¤)ã€[`sessionStorage`](https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage)ã€[`async-storage`](https://github.com/react-native-async-storage/async-storage)ã€‚

æŒä¹…åŒ–æ•°æ®çš„å¥½å¤„å°±æ˜¯åˆ·æ–°æµè§ˆå™¨æ—¶ï¼Œstore èƒ½ä¿æŒä¹‹å‰çš„çŠ¶æ€ã€‚

```ts
import { create } from 'zustand';
import { createJSONStorage, persist } from 'zustand/middleware';

type FishStore = {
  fishes: number;
  addAFish: () => void;
};

const useFishStore = create<FishStore>()(
  persist(
    (set, get) => ({
      fishes: 0,
      addAFish: () => set({ fishes: get().fishes + 1 }),
    }),
    {
      name: 'food-storage', // name of the item in the storage (must be unique)
      storage: createJSONStorage(() => sessionStorage), // (optional) by default, 'localStorage' is used
    },
  ),
);

export default useFishStore;
```

ä½¿ç”¨æ—¶æˆ–è€…çŠ¶æ€å˜åŒ–æ—¶ä¼šåŒæ­¥æ•°æ®åˆ° `sessionStorage`

åˆå§‹å€¼

![zustand-persist-1](./assets/zustand-persist-1.png)

å˜åŒ–å

![zustand-persist-2](./assets/zustand-persist-2.png)

Persist ä¸­é—´ä»¶è¿˜æœ‰å¾ˆå¤šé…ç½®é€‰é¡¹ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [Persist middleware](https://github.com/pmndrs/zustand/blob/main/docs/integrations/persisting-store-data.md)

### Redux

å¦‚æœä½ æƒ³è¦ Redux é£æ ¼ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ store

```ts
// useGrumpyStore.ts
import { create } from 'zustand';

export enum GrumpyType {
  Increase = 'Increase',
  Decrease = 'Decrease',
}

type Action = {
  type: GrumpyType;
  by: number;
};

type GrumpyStore = {
  grumpiness: number;
  dispatch: (args: Action) => void;
};

const reducer = (
  state: GrumpyStore,
  { type, by = 1 }: Action,
) => {
  switch (type) {
    case GrumpyType.Increase:
      return { grumpiness: state.grumpiness + by };
    case GrumpyType.Decrease:
      return { grumpiness: state.grumpiness - by };
  }
};

const useGrumpyStore = create<GrumpyStore>()((set) => ({
  grumpiness: 0,
  dispatch: (args) => set((state) => reducer(state, args)),
}));

export default useGrumpyStore;
```

Zustand æä¾›äº† `redux` ä¸­é—´ä»¶æ¥ç®€åŒ–ä»£ç 

```ts
// useGrumpyStore.ts
import { create } from 'zustand';
import { redux } from 'zustand/middleware';

export enum GrumpyType {
  Increase = 'Increase',
  Decrease = 'Decrease',
}
type Action = {
  type: GrumpyType;
  by: number;
};

type GrumpyState = {
  grumpiness: number;
};

const reducer = (state: GrumpyState, { type, by = 1 }: Action): GrumpyState => {
  switch (type) {
    case GrumpyType.Increase:
      return { grumpiness: state.grumpiness + by };
    case GrumpyType.Decrease:
      return { grumpiness: state.grumpiness - by };
  }
};

const initialState: GrumpyState = {
  grumpiness: 0,
};

// ä¸éœ€è¦æ ‡æ³¨ create å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦ä½¿ç”¨ curry ç‰ˆæœ¬
const useGrumpyStore = create(redux(reducer, initialState));

export default useGrumpyStore;
```

> å½“ä½¿ç”¨ `redux` ä¸­é—´ä»¶æ—¶ä¸éœ€è¦æ ‡æ³¨ç±»å‹ï¼Œä¹Ÿä¸éœ€è¦ä½¿ç”¨ `create` curry ç‰ˆæœ¬ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [TypeScript Guide](https://docs.pmnd.rs/zustand/guides/typescript#basic-usage).

ç»„ä»¶ä½¿ç”¨

```tsx
const dispath = useGrumpyStore((state) => state.dispatch);
dispath({ type: GrumpyType.Increase, by: 1 }
```

### Redux Devtools

Zustand æä¾›äº† `devtools` ä¸­é—´ä»¶ï¼Œé€šè¿‡å®ƒå¯ä»¥ä½¿ç”¨ [`redux-devtools`](https://github.com/reduxjs/redux-devtools) å·¥å…·è¿›è¡ŒçŠ¶æ€ç›‘æ§ã€è°ƒè¯•

```ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

type BearStore = {
  bears: number;
  increase: () => void;
  reset: () => void;
};

const useBearStore = create<BearStore>()(
  devtools(
    (set) => ({
      bears: 0,
      increase: () =>
        set((state) => ({ bears: state.bears + 1 }), false, 'increase'),
      reset: () => set({ bears: 0 }, false, 'reset'),
    }),
    { name: 'zustand-demo', store: 'BearStore' },
  ),
);

export default useBearStore;
```

æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š

- éœ€è¦è®¾ç½® name å’Œ storeï¼Œ`name: 'zustand-demo'` è¡¨ç¤ºåœ¨ devtools ä¸­åˆ›å»ºä¸€ä¸ªåä¸º "zustand-demo" çš„å•ç‹¬å®ä¾‹ã€‚store ä½œä¸º action å‰ç¼€ã€‚

- å¦‚æœæ²¡æœ‰ä½¿ç”¨ `redux` ä¸­é—´ä»¶ï¼Œaction éœ€è¦æä¾› action nameï¼Œæ¯”å¦‚ä¸Šé¢ `increase` æ“ä½œçš„ action name ä¸º "increase"ï¼Œå¦‚æœæ²¡æœ‰æä¾›ï¼Œé»˜è®¤æ˜¯ "anonymous"

![zustand-devtools](./assets/zustand-devtools.png)

å»ºè®®æ¯ä¸€ä¸ª zustand store éƒ½ä½¿ç”¨  `devtools` ä¸­é—´ä»¶ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚

## Demo

[zustand-demo](https://gitee.com/cp3hnu/web-demo/tree/master/zustand-demo)

## References

- [`Zustand`](https://github.com/pmndrs/zustand)
- [Zustand Doc](https://docs.pmnd.rs/zustand/getting-started/introduction)
- [Zustand vs Others State Libraries](https://docs.pmnd.rs/zustand/getting-started/comparison)
- [Auto Generating Selectors](https://docs.pmnd.rs/zustand/guides/auto-generating-selectors)
- [Slices Pattern](https://docs.pmnd.rs/zustand/guides/slices-pattern#slicing-the-store-into-smaller-stores)
- [Persist middleware](https://github.com/pmndrs/zustand/blob/main/docs/integrations/persisting-store-data.md)
- [Zustand Third-party Libraries](https://docs.pmnd.rs/zustand/integrations/third-party-libraries)
- [`Immer`](https://github.com/mweststrate/immer)
- [`Redux-devtools`](https://github.com/reduxjs/redux-devtools)