<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>UmiJS + Storybook 搭建组件库文档 | Study &amp; Product</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="我从 Storybook 6 开始关注 Storybook，它是一个很好的撰写组件库文档和测试组件的工具。Storybook 号称是零配置，适用于任何现代前端框架。但是外面的世界还是太复杂了，有各种不同技术的组合，比如我最近一直在使用的 UmiJS 4，它对各项技术进行了自己的封装。这篇文章我们实现在 UmiJS 工程里使用 Storybook 搭建组件库文档。">
    <meta name="algolia-site-verification" content="23333450F18E92C1">
    
    <link rel="preload" href="/assets/css/0.styles.cd1f7b12.css" as="style"><link rel="preload" href="/assets/js/app.b07256e7.js" as="script"><link rel="preload" href="/assets/js/34.49b71b2c.js" as="script"><link rel="preload" href="/assets/js/3.276926dd.js" as="script"><link rel="preload" href="/assets/js/11.e6a0311f.js" as="script"><link rel="prefetch" href="/assets/js/10.7c5bc6fc.js"><link rel="prefetch" href="/assets/js/100.f675d046.js"><link rel="prefetch" href="/assets/js/101.92ede1ec.js"><link rel="prefetch" href="/assets/js/102.678a907d.js"><link rel="prefetch" href="/assets/js/103.959ad108.js"><link rel="prefetch" href="/assets/js/104.b15677eb.js"><link rel="prefetch" href="/assets/js/105.377da8a5.js"><link rel="prefetch" href="/assets/js/106.29a8c44d.js"><link rel="prefetch" href="/assets/js/107.64b19904.js"><link rel="prefetch" href="/assets/js/108.a3e75a67.js"><link rel="prefetch" href="/assets/js/109.283d92d8.js"><link rel="prefetch" href="/assets/js/110.cbb6ea81.js"><link rel="prefetch" href="/assets/js/111.252f143f.js"><link rel="prefetch" href="/assets/js/112.df62c9fe.js"><link rel="prefetch" href="/assets/js/113.66189350.js"><link rel="prefetch" href="/assets/js/114.890cd7de.js"><link rel="prefetch" href="/assets/js/115.53823707.js"><link rel="prefetch" href="/assets/js/116.caaa6eaa.js"><link rel="prefetch" href="/assets/js/117.b7b0f88f.js"><link rel="prefetch" href="/assets/js/118.03168974.js"><link rel="prefetch" href="/assets/js/119.90f4d7b7.js"><link rel="prefetch" href="/assets/js/12.8da07182.js"><link rel="prefetch" href="/assets/js/120.b654e5ee.js"><link rel="prefetch" href="/assets/js/121.92d87086.js"><link rel="prefetch" href="/assets/js/13.a9f90626.js"><link rel="prefetch" href="/assets/js/14.b18d5210.js"><link rel="prefetch" href="/assets/js/15.835c7671.js"><link rel="prefetch" href="/assets/js/16.eb29ed80.js"><link rel="prefetch" href="/assets/js/17.c4871518.js"><link rel="prefetch" href="/assets/js/18.606b879c.js"><link rel="prefetch" href="/assets/js/19.777086a8.js"><link rel="prefetch" href="/assets/js/20.c8e69fcc.js"><link rel="prefetch" href="/assets/js/21.6cda2658.js"><link rel="prefetch" href="/assets/js/22.19e356e1.js"><link rel="prefetch" href="/assets/js/23.ca8661ea.js"><link rel="prefetch" href="/assets/js/24.9f090eaf.js"><link rel="prefetch" href="/assets/js/25.be2c8a0c.js"><link rel="prefetch" href="/assets/js/26.5ce52eaa.js"><link rel="prefetch" href="/assets/js/27.d75e1151.js"><link rel="prefetch" href="/assets/js/28.6863d7e4.js"><link rel="prefetch" href="/assets/js/29.d8a1c4f2.js"><link rel="prefetch" href="/assets/js/30.178b8dc0.js"><link rel="prefetch" href="/assets/js/31.4c488d0e.js"><link rel="prefetch" href="/assets/js/32.ce3ae3c7.js"><link rel="prefetch" href="/assets/js/33.828dd0d1.js"><link rel="prefetch" href="/assets/js/35.9496ed4c.js"><link rel="prefetch" href="/assets/js/36.33ada8e1.js"><link rel="prefetch" href="/assets/js/37.e9705ffe.js"><link rel="prefetch" href="/assets/js/38.f9c57096.js"><link rel="prefetch" href="/assets/js/39.75b77f83.js"><link rel="prefetch" href="/assets/js/4.c651aa9d.js"><link rel="prefetch" href="/assets/js/40.4496a5db.js"><link rel="prefetch" href="/assets/js/41.260393e3.js"><link rel="prefetch" href="/assets/js/42.083f9350.js"><link rel="prefetch" href="/assets/js/43.8d311a8e.js"><link rel="prefetch" href="/assets/js/44.df55763b.js"><link rel="prefetch" href="/assets/js/45.e19037c7.js"><link rel="prefetch" href="/assets/js/46.9529f37b.js"><link rel="prefetch" href="/assets/js/47.8d631e39.js"><link rel="prefetch" href="/assets/js/48.3acad59c.js"><link rel="prefetch" href="/assets/js/49.9a12a900.js"><link rel="prefetch" href="/assets/js/5.373c53f3.js"><link rel="prefetch" href="/assets/js/50.f30877b8.js"><link rel="prefetch" href="/assets/js/51.e8b2adf9.js"><link rel="prefetch" href="/assets/js/52.e6a458bb.js"><link rel="prefetch" href="/assets/js/53.e4027d0c.js"><link rel="prefetch" href="/assets/js/54.5a4be38d.js"><link rel="prefetch" href="/assets/js/55.924ee4f8.js"><link rel="prefetch" href="/assets/js/56.11ff1ccf.js"><link rel="prefetch" href="/assets/js/57.14327960.js"><link rel="prefetch" href="/assets/js/58.cea182b0.js"><link rel="prefetch" href="/assets/js/59.2db874c7.js"><link rel="prefetch" href="/assets/js/6.6878fac4.js"><link rel="prefetch" href="/assets/js/60.e3e4017b.js"><link rel="prefetch" href="/assets/js/61.d5cd385e.js"><link rel="prefetch" href="/assets/js/62.6929f93f.js"><link rel="prefetch" href="/assets/js/63.3f8bf719.js"><link rel="prefetch" href="/assets/js/64.e89e1572.js"><link rel="prefetch" href="/assets/js/65.a4335c65.js"><link rel="prefetch" href="/assets/js/66.cc9fb484.js"><link rel="prefetch" href="/assets/js/67.d5da8f2f.js"><link rel="prefetch" href="/assets/js/68.91a38f6d.js"><link rel="prefetch" href="/assets/js/69.800ca600.js"><link rel="prefetch" href="/assets/js/7.6f2558ea.js"><link rel="prefetch" href="/assets/js/70.f7b16ee7.js"><link rel="prefetch" href="/assets/js/71.e34929dc.js"><link rel="prefetch" href="/assets/js/72.175a64bf.js"><link rel="prefetch" href="/assets/js/73.c3dcfd4b.js"><link rel="prefetch" href="/assets/js/74.65978082.js"><link rel="prefetch" href="/assets/js/75.718d5152.js"><link rel="prefetch" href="/assets/js/76.2ed620b3.js"><link rel="prefetch" href="/assets/js/77.f8726387.js"><link rel="prefetch" href="/assets/js/78.1dea2e59.js"><link rel="prefetch" href="/assets/js/79.f62213a1.js"><link rel="prefetch" href="/assets/js/8.81ebcef8.js"><link rel="prefetch" href="/assets/js/80.7600ac29.js"><link rel="prefetch" href="/assets/js/81.ab94746f.js"><link rel="prefetch" href="/assets/js/82.26baf7f8.js"><link rel="prefetch" href="/assets/js/83.89a3942a.js"><link rel="prefetch" href="/assets/js/84.1a5577ac.js"><link rel="prefetch" href="/assets/js/85.eb62de22.js"><link rel="prefetch" href="/assets/js/86.7635121c.js"><link rel="prefetch" href="/assets/js/87.5bee4d72.js"><link rel="prefetch" href="/assets/js/88.04d56860.js"><link rel="prefetch" href="/assets/js/89.09a7d920.js"><link rel="prefetch" href="/assets/js/9.7f69b9b1.js"><link rel="prefetch" href="/assets/js/90.dac6a66e.js"><link rel="prefetch" href="/assets/js/91.14f101dd.js"><link rel="prefetch" href="/assets/js/92.d398eb09.js"><link rel="prefetch" href="/assets/js/93.7a5477fa.js"><link rel="prefetch" href="/assets/js/94.c4bf7674.js"><link rel="prefetch" href="/assets/js/95.a0c3c94c.js"><link rel="prefetch" href="/assets/js/96.c3a44db5.js"><link rel="prefetch" href="/assets/js/97.6956ed39.js"><link rel="prefetch" href="/assets/js/98.ad65fe08.js"><link rel="prefetch" href="/assets/js/99.4fe76e2f.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.cb5d1302.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd1f7b12.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Study &amp; Product </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Study &amp; Product </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/notebook/" class="nav-link">Notebook</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper blog-page"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><div itemprop="articleBody" class="content__default"><h1 id="umijs-storybook-搭建组件库文档"><a href="#umijs-storybook-搭建组件库文档" class="header-anchor">#</a> UmiJS + Storybook 搭建组件库文档</h1> <p>我从 Storybook 6 开始关注 <a href="https://storybook.js.org/" target="_blank" rel="noopener noreferrer">Storybook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它是一个很好的撰写组件库文档和测试组件的工具。Storybook 号称是零配置，适用于任何现代前端框架。但是外面的世界还是太复杂了，有各种不同技术的组合，比如我最近一直在使用的 <a href="https://umijs.org/" target="_blank" rel="noopener noreferrer">UmiJS 4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它对各项技术进行了自己的封装。这篇文章我们实现在 UmiJS 工程里使用 Storybook 搭建组件库文档。</p> <blockquote><p>这是我写的关于 Storybook 的第三篇文章，前两篇分别是</p> <ul><li><a href="/2023/01/04/storybook/">Storybook</a>，介绍 Storybook</li> <li><a href="/2023/09/02/storybook-in-action/">Storybook 搭建组件库文档</a>，搭建自己的组件库文档，当时使用是 Webpack 4 + Storybook 6.5</li></ul> <p>在我学习 Storybook 的过程中，Storybook 从 6.5 升级到 7.4，再升级到目前最新的 8.5，Storybook 的功能越来越强大，越来越好用。</p></blockquote> <h2 id="实现效果"><a href="#实现效果" class="header-anchor">#</a> 实现效果</h2> <p><img src="/assets/img/umijs-storybook-screenshots.2ade8f2d.png" alt=""></p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npx storybook@latest init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>当前版本  8.5.3</p></blockquote> <p>Storybook 将根据您的项目依赖，为您提供最佳配置，主要完成：</p> <ul><li>安装依赖包，比如 <code>@storybook/addon-essentials</code></li> <li>添加 script 命令，比如 <code>&quot;storybook&quot;: &quot;storybook dev 6006&quot;</code></li> <li>创建配置文件，在 <code>.storybook</code> 目录下，有两个文件 <code>main.(js|ts)</code> 和 <code>preview.(js|ts)</code></li> <li>创建示例，在 <code>src/stories</code> 目录下</li></ul> <p>Storybook 默认生成的 <code>main.ts</code> 如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  stories<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'../src/**/*.mdx'</span><span class="token punctuation">,</span> <span class="token string">'../src/**/*.stories.@(js|jsx|mjs|ts|tsx)'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  addons<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'@storybook/addon-webpack5-compiler-swc'</span><span class="token punctuation">,</span>
    <span class="token string">'@storybook/addon-onboarding'</span><span class="token punctuation">,</span>
    <span class="token string">'@storybook/addon-essentials'</span><span class="token punctuation">,</span>
    <span class="token string">'@chromatic-com/storybook'</span><span class="token punctuation">,</span>
    <span class="token string">'@storybook/addon-interactions'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  framework<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><code>stories</code>，定义哪些文件是 story</li> <li><code>addons</code>，使用哪些插件，Storybook 是基于插件工作的。这里注意一下 <code>@storybook/addon-webpack5-compiler-swc</code> addon，后面有讲到。</li> <li><code>framework</code>，Storybook 使用的构建工具，因为我们使用的是 React + Webpack 5，所以这里使用的是 <code>@storybook/react-webpack5</code></li></ul> <p>后面我们可以添加更多的 <code>addons</code> 以及添加 Webpack 等配置。</p> <p>Storybook 默认生成的 <code>preview.ts</code> 如下：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    controls<span class="token operator">:</span> <span class="token punctuation">{</span>
      matchers<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(background|color)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        date<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Date$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这里定义了一个全局的参数配置，参数名带有 <code>background</code> 或 <code>color</code> 的使用颜色选择器控件，参数名带有 <code>date</code> 的使用日期选择器控件，后面我们还可以参加更多的参数配置，以及全局 Args、Decorators、Loaders 等</p> <h2 id="javascript-编译器"><a href="#javascript-编译器" class="header-anchor">#</a> JavaScript 编译器</h2> <p>UmiJS 的技术栈是 React + Webpack 5 + TS + Less，但是不确定 JavaScript 编译器用的 Babel 还是 SWC？</p> <p>这篇文章 <a href="https://mp.weixin.qq.com/s?__biz=MjM5NDgyODI4MQ==&amp;mid=2247484533&amp;idx=1&amp;sn=9b15a67b88ebc95476fce1798eb49146&amp;chksm=a6809ee391f717f5e2c2242ed313ecccc49897b101602e3358085c6a6b2393d54424fc52eb46&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">SEE Conf: Umi 4 设计思路文字稿<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 说 JavaScript 编译器用的是 SWC</p> <p><img src="/assets/img/umijs-storybook-js-swc.1a0abe81.jpeg" alt=""></p> <p>但是 <a href="https://umijs.org/docs/api/config#srctranspiler" target="_blank" rel="noopener noreferrer">UmiJS 的文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 上写的是 Babel。</p> <p><img src="/assets/img/umijs-storybook-js-babel.e2631da5.png" alt=""></p> <p>JavaScript 编译器关系到 <a href="https://storybook.js.org/docs/builders/webpack#compiler-support" target="_blank" rel="noopener noreferrer">Storybook 使用哪个编译器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。如果您的项目使用的是 SWC，则使用 <a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-swc" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-swc</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件，如果使用的是 Babel，则使用 <a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-babel" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-babel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件</p> <p>从上面 Storybook 默认生成的 <code>main.ts</code> 中我们可以看到，Storybook 以为 UmiJS 使用的是 SWC。其实根据我的研究，UmiJS 应该使用的是 Babel。</p> <blockquote><p>我也不能确定，因此我在 Umi 的 GitHub 的代码库里提了一个问题：<a href="https://github.com/umijs/umi/discussions/12918" target="_blank" rel="noopener noreferrer">请问 UMI 默认使用的 JavaScript 编译器是 Babel 还是 SWC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，期待他们的回复。</p></blockquote> <p>因此需要安装 <a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-babel" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-babel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件，卸载 <a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-swc" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-swc</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npx storybook@latest <span class="token function">add</span> @storybook/addon-webpack5-compiler-babel
$ npx storybook@latest remove @storybook/addon-webpack5-compiler-swc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改配置</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code>// .storybook/main.ts
const config: StorybookConfig = {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> addons: [
</span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">    '@storybook/addon-webpack5-compiler-swc',
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    '@storybook/addon-webpack5-compiler-babel',
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ],
</span></span>};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="typescript"><a href="#typescript" class="header-anchor">#</a> Typescript</h2> <p>不知道是不是 UmiJS 隐藏了对 Typescript 文件的处理，Storybook 无法编译 Typescript 文件，所以我们只能修改 Webpack 配置，添加 TS 文件的处理 rule。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> i typescript ts-loader -D 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">'webpack'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">webpackFinal</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token keyword">module</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>rules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(tsx?|jsx?)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          loader<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          include<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">// 限制范围，避免处理 node_modules</span>
            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="样式"><a href="#样式" class="header-anchor">#</a> 样式</h2> <p>前端处理样式的工具有很多，比如 Sass、Less、Tailwind、Styled Components 等。对于大部分工具 Storybook 都提供了相应插件来处理，详情请查看 <a href="https://storybook.js.org/docs/get-started/setup#render-component-styles" target="_blank" rel="noopener noreferrer">Render Component styles<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>UmiJS 使用的 <a href="https://lesscss.org/" target="_blank" rel="noopener noreferrer"><code>Less</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> + <a href="https://github.com/css-modules/css-modules" target="_blank" rel="noopener noreferrer"><code>CSS Modules</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。Storybook 提供了<a href="https://storybook.js.org/addons/@storybook/addon-styling-webpack" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-styling-webpack</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 插件。</p> <h3 id="storybook-addon-styling-webpack"><a href="#storybook-addon-styling-webpack" class="header-anchor">#</a> <code>@storybook/addon-styling-webpack</code></h3> <p><strong>安装</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npx storybook@latest <span class="token function">add</span> @storybook/addon-styling-webpack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它将在 <code>main.ts</code> 的 <code>addons</code> 中添加 <code>@storybook/addon-styling-webpack</code>，并且自动运行 <code>npx @storybook/auto-config styling</code>，这是一个 codemod 包，它将尝试检测项目中的样式工具并进行相应地配置。</p> <p>安装完成之后，运行 Storybook 还是失败（我就是这种情况），可以手动运行</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npx @storybook/auto-config styling
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>它会引导我们选择哪个工具、安装相应的依赖</p> <p><img src="/assets/img/umijs-storybook-less.ad6a84fb.png" alt=""></p> <p><strong>安装依赖（如果项目中没有）</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> i <span class="token function">less</span> less-loader style-loader css-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>配置</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span> 
  addons<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 其它 addons</span>
    <span class="token string">'@storybook/addon-styling-webpack'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'@storybook/addon-styling-webpack'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  modules<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// CSS Modules</span>
                    localIdentName<span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                  lessOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                    javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果需要支持 Ant Design 的 Less 变量，开启此项</span>
                    modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span>
                      hack<span class="token operator">:</span> <span class="token string">'true; @import &quot;@/styles/theme.less&quot;;'</span><span class="token punctuation">,</span>  <span class="token comment">// 添加主题变量文件</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 限制范围，避免处理 node_modules</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="修改-webpack-配置"><a href="#修改-webpack-配置" class="header-anchor">#</a> 修改 Webpack 配置</h3> <p>除了使用 <code>@storybook/addon-styling-webpack</code> 之外，也可以直接修改 <a href="https://storybook.js.org/docs/builders/webpack#override-the-default-configuration" target="_blank" rel="noopener noreferrer">Webpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>安装依赖（如果项目中没有）</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> i <span class="token function">less</span> less-loader style-loader css-loader -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>配置</strong></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">webpackFinal</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token keyword">module</span> <span class="token operator">&amp;&amp;</span> config<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>rules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              modules<span class="token operator">:</span> <span class="token punctuation">{</span>
                localIdentName<span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              lessOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果需要支持 Ant Design 的 Less 变量，开启此项</span>
                modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span>
                  hack<span class="token operator">:</span> <span class="token string">'true; @import &quot;@/styles/theme.less&quot;;'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 限制范围，避免处理 node_modules</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack</span><span class="token punctuation">.</span><span class="token function">ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          React<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span> <span class="token comment">// 全局注入 React</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h3 id="css-modules"><a href="#css-modules" class="header-anchor">#</a> CSS Modules</h3> <p>在配置 CSS Modules 时，我踩了一下坑，不管问 ChatGPT 还是网上的很多答案都是</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token punctuation">{</span>
        modules<span class="token operator">:</span> <span class="token punctuation">{</span>
          auto<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 启用 CSS Modules</span>
          localIdentName<span class="token operator">:</span> <span class="token string">'[local]--[hash:base64:5]'</span><span class="token punctuation">,</span> <span class="token comment">// 自定义类名生成规则</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>但是没有实现 CSS Modules，问题出在 <strong><code>auto: true</code></strong>。在 <a href="https://github.com/webpack-contrib/css-loader?tab=readme-ov-file#auto" target="_blank" rel="noopener noreferrer"><code>css-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（目前最新版本是 v7.1.2）中，<code>auto: true</code> 表示只有 <code>xxx.module.less</code> 或者 <code>xxx..icss.less</code> 才开启 CSS Modules。导致 <code>import styles from &quot;./index.less&quot;</code> 时 <code>styles</code> 为 <code>undefined</code>。而在我们的项目中，没有使用 <code>xxx.module.less</code> 这种命名规则，因此正确做法应该是设置 <code>auto: undefined</code>，或者使用 <code>RegExp</code> / <code>function</code>。</p> <blockquote><ul><li><code>undefined</code> - enable CSS modules for all files.</li> <li><code>true</code> - enable CSS modules for all files matching <code>/\.module\.\w+$/i.test(filename)</code> and <code>/\.icss\.\w+$/i.test(filename)</code> regexp.</li> <li><code>false</code> - disables CSS Modules.</li> <li><code>RegExp</code> - enable CSS modules for all files matching <code>/RegExp/i.test(filename)</code> regexp.</li> <li><code>function</code> - enable CSS Modules for files based on the filename satisfying your filter function check.</li></ul></blockquote> <p>但是设置 <code>auto: undefined</code> 也有问题，从上面的参数说明就知道，它会把所有的 less 文件都转换成 CSS Modules。但是我们项目中的一些公共样式、组件样式是不需要装换成 CSS Modules。比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;@/styles/global.less&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>只有这种情况下才需要转换成 CSS Modules</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&quot;./index.less&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>因此在不改动原项目配置的情况下，最好的做法是使用 <code>RegExp</code> / <code>function</code>，比如</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    modules<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">auto</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">resourcePath<span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resourcePath<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/src/pages/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>但是我们在使用 UmiJS 的开发过程中，是不需要关系这个的，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">&quot;./index.less&quot;</span> <span class="token comment">// 转换成 CSS Modules</span>
<span class="token keyword">import</span> <span class="token string">&quot;./index.less&quot;</span>             <span class="token comment">// 不转换成 CSS Modules</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>它是怎么做到的呢？</p> <p>其实 UmiJS 帮我们完成了一些功能：</p> <ul><li>首先，通过 <a href="https://github.com/umijs/umi/blob/master/packages/mfsu/src/esbuildHandlers/autoCssModules.ts" target="_blank" rel="noopener noreferrer"><code>autoCssModulesHandler</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 函数将 <code>import styles from &quot;./index.less&quot;</code> 转换成 <code>import styles from &quot;./index.less?modules&quot;</code>。</li> <li>然后，通过 Webpack 的 <a href="https://webpack.js.org/configuration/module/#ruleresourcequery" target="_blank" rel="noopener noreferrer"><code>resourceQuery</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 功能，添加一个 <a href="https://github.com/umijs/umi/blob/master/packages/bundler-webpack/src/config/cssRules.ts" target="_blank" rel="noopener noreferrer"><code>css-modules</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 rule。类似于下面的配置：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        resourceQuery<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 只有 `?modules` 时才启用 CSS Modules</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              modules<span class="token operator">:</span> <span class="token punctuation">{</span>
                localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 默认不使用 CSS Modules</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>我们也可以仿照这个，在 Storybook 里实现相同的功能，首先定义一个 Babel 插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// babel-plugin-auto-css-modules</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">babel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> types<span class="token operator">:</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> babel<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    visitor<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">ImportDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> source <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.less'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>specifiers<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token string">&quot;?modules&quot;</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>再配置 Babel</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// .babelrc</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./babel-plugin-auto-css-modules.js&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>需要注意的是 <code>.babelrc</code> 必须放在项目根目录下，放在 <code>.storybook</code> 目录下处理只处理 <code>.storybook</code> 目录下文件。如果不想影响原项目，可以在 <code>main.ts</code> 添加 <code>babel</code> 选项。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>	
	<span class="token function-variable function">babel</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./babel-plugin-auto-css-modules.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>最后修改 Storybook 的 webpack 配置</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code>config<span class="token punctuation">.</span><span class="token keyword">module</span><span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        resourceQuery<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              importLoaders<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token keyword">import</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              esModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              modules<span class="token operator">:</span> <span class="token punctuation">{</span>
                localIdentName<span class="token operator">:</span> <span class="token string">'[local]___[hash:base64:5]'</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              lessOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果需要支持 Ant Design 的 Less 变量，开启此项</span>
                modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span>
                  hack<span class="token operator">:</span> <span class="token string">'true; @import &quot;@/styles/theme.less&quot;;'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 限制范围，避免处理 node_modules</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'less-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              lessOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
                javascriptEnabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 如果需要支持 Ant Design 的 Less 变量，开启此项</span>
                modifyVars<span class="token operator">:</span> <span class="token punctuation">{</span>
                  hack<span class="token operator">:</span> <span class="token string">'true; @import &quot;@/styles/theme.less&quot;;'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 限制范围，避免处理 node_modules</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="mock-modules"><a href="#mock-modules" class="header-anchor">#</a> Mock Modules</h2> <p>当我的组件使用 <code>umi</code> 或者 <code>@umijs/max</code> 时，比如 <code>import { Link } from &quot;@umijs/max&quot;</code>，Storybook 编译报错，推测原因是 <strong>UmiJS 的某些模块依赖了 Node.js 环境</strong>，而 Storybook 运行在浏览器中，无法解析这些模块。咨询了 ChatGPT 和 deepseek，未能解决。这个问题困扰了我很久，突然我想到一个方法，Mock 这些模块不就好了吗？</p> <blockquote><p>要想解决 Storybook 引入 <code>@umijs/max</code> 编译报错的问题，需要研究一下 <code>@umijs/max</code> 的内部实现，以后有时间再研究</p></blockquote> <p><a href="https://storybook.js.org/docs/writing-stories/mocking-data-and-modules/mocking-modules#mock-files-for-external-modules" target="_blank" rel="noopener noreferrer">Mock 外部模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，Storybook 推荐的方法是创建一个本地文件，引入外部模块，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/lib/umijs.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@umijs/max'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> umiLink <span class="token operator">=</span> Link
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>再创建一个 mock 文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/lib/umijs.mock.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/test'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actual <span class="token keyword">from</span> <span class="token string">'./uuid'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> umiLink <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>actual<span class="token punctuation">.</span>umiLink<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockName</span><span class="token punctuation">(</span><span class="token string">'umiLink'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后添加 <a href="https://storybook.js.org/docs/writing-stories/mocking-data-and-modules/mocking-modules#builder-aliases" target="_blank" rel="noopener noreferrer">aliase<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/main.ts</span>
<span class="token function-variable function">webpackFinal</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">,</span>
      <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">'@lib/umijs'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/lib./umijs.mock.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>最后在 story 文件里，实现 mock 模块功能</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// Replace your-renderer with the name of your renderer (e.g. react, vue3)</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Meta<span class="token punctuation">,</span> StoryObj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/your-renderer'</span><span class="token punctuation">;</span>
 
<span class="token comment">// 👇 Must include the `.mock` portion of filename to have mocks typed correctly</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@lib/umijs.mock'</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> BasicInfo <span class="token keyword">from</span> <span class="token string">'./BasicInfo'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> meta<span class="token operator">:</span> Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Page<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> BasicInfo<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
 
<span class="token keyword">type</span> <span class="token class-name">Story</span> <span class="token operator">=</span> StoryObj<span class="token operator">&lt;</span><span class="token keyword">typeof</span> BasicInfo<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">const</span> Default<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Link<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> to<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> to <span class="token operator">:</span> <span class="token string">'#'</span><span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>但是这个方法需要修改原项目代码，修改原项目的 webpack 配置。</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> import { Link } from '@umijs/max'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import { Link } from '@lib/umijs'
</span></span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们使用 Storybook 的原则是尽量不动原项目的代码和配置，因此可以这么做：</p> <ol><li>首先在 <code>.storybook</code> 的目录下创建一个 <code>mock</code> 目录，里面再创建各种 <code>mock</code> 文件，比如 <code>umijs.tsx</code></li></ol> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/mock/umijs.tsx</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Link</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> to<span class="token punctuation">,</span> children<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">typeof</span> to <span class="token operator">===</span> <span class="token string">'string'</span> <span class="token operator">?</span> to <span class="token operator">:</span> <span class="token string">'#'</span><span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>添加一个 webpack 别名，将 <code>@umijs/max</code> 指向创建的 mock 文件</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/main.ts</span>
<span class="token function-variable function">webpackFinal</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>config<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>alias<span class="token punctuation">,</span>
        <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'@umijs/max'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./mock/umijs.tsx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样 <code>import { Link } from '@umijs/max'</code> 访问的 <code>Link</code> 组件，就是 <code>.storybook/mock/umijs.tsx</code> 创建的 Link 组件。无需改动原项目代码和配置。同理还有 <code>import { request } from '@umijs/max'</code> 等。</p> <h2 id="mock-request"><a href="#mock-request" class="header-anchor">#</a> Mock Request</h2> <p>为了模拟各种网络场景，最好的方式 mock request，可以生成不同的数据。Storybook 使用 MSW （我非常喜欢的一个 Mock 工具）来</p> <p><a href="https://storybook.js.org/docs/writing-stories/mocking-data-and-modules/mocking-network-requests" target="_blank" rel="noopener noreferrer">Mocking network requests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>配置也非常简单：</p> <ol><li>安装 <code>MSW</code> 和 <code>MSW addon</code></li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">npm</span> <span class="token function">install</span> msw msw-storybook-addon -D
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>生成 service worker file</li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ npx msw init public/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>配置 <a href="https://storybook.js.org/docs/api/main-config/main-config-static-dirs" target="_blank" rel="noopener noreferrer"><code>staticDirs</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 属性，添加 <code>public/</code> 目录</li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  staticDirs<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'../public'</span><span class="token punctuation">,</span> <span class="token string">'../static'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>初始化 <code>msw-storybook-addon</code>，添加 <code>mswLoader</code></li></ol> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preivew.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/your-renderer'</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> initialize<span class="token punctuation">,</span> mswLoader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw-storybook-addon'</span><span class="token punctuation">;</span>
 
<span class="token comment">/*
 * Initializes MSW
 * See https://github.com/mswjs/msw-storybook-addon#configuring-msw
 * to learn how to customize it
 */</span>
<span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... rest of preview configuration</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>mswLoader<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 👈 Add the MSW loader to all stories</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="5"><li>Mock request</li></ol> <p>可以在 global、component 或者 story 层 mock request</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Meta<span class="token punctuation">,</span> StoryObj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> http<span class="token punctuation">,</span> HttpResponse<span class="token punctuation">,</span> delay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'msw'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> MyComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./MyComponent'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> TestData <span class="token operator">=</span> <span class="token punctuation">{</span>
  code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">'操作成功'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">const</span> meta<span class="token operator">:</span> Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> MyComponent<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> MyComponent<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
                 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Story</span> <span class="token operator">=</span> StoryObj<span class="token operator">&lt;</span><span class="token keyword">typeof</span> MyComponent<span class="token operator">&gt;</span><span class="token punctuation">;</span>                

<span class="token keyword">export</span> <span class="token keyword">const</span> MockedSuccess<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    msw<span class="token operator">:</span> <span class="token punctuation">{</span>
      handlers<span class="token operator">:</span> <span class="token punctuation">[</span>
        http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'https://your-restful-endpoint/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> HttpResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>TestData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> MockedError<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    msw<span class="token operator">:</span> <span class="token punctuation">{</span>
      handlers<span class="token operator">:</span> <span class="token punctuation">[</span>
        http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'https://your-restful-endpoint'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpResponse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            status<span class="token operator">:</span> <span class="token number">403</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h2 id="文档"><a href="#文档" class="header-anchor">#</a> 文档</h2> <p>自此，我完成了组件 stories 的编写，接下来我们添加一些文档</p> <h3 id="默认文档"><a href="#默认文档" class="header-anchor">#</a> 默认文档</h3> <p>Storybook 会<a href="https://storybook.js.org/docs/writing-docs/autodocs" target="_blank" rel="noopener noreferrer">自动生成组件文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，Storybook 8.5 通过 <a href="https://storybook.js.org/docs/writing-stories/tags" target="_blank" rel="noopener noreferrer"><code>tags: ['autodocs']</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 开启这项功能。</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/your-renderer'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...rest of preview</span>
  <span class="token comment">//👇 Enables auto-generated documentation for all stories</span>
  tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'autodocs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果全局开启了这项功能，但是要取消的单个组件自动生成默认文档，可以配置组件的 <code>tags: ['!autodocs']</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token operator">:</span> <span class="token string">'Components/Example'</span><span class="token punctuation">,</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'!autodocs'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Storybook 通过 <code>docs.defaultName</code> 设置文档在侧边栏导航菜单的名称，默认是 <code>Docs</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/main.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> StorybookConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> config<span class="token operator">:</span> StorybookConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  docs<span class="token operator">:</span> <span class="token punctuation">{</span>
    defaultName<span class="token operator">:</span> <span class="token string">'Documentation'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> config<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Storybook 使用一套默认模版生成组件文档，可以通过 <code>parameters.docs.page</code> 修改，<strong>只能在 <code>.storybook/preview.ts</code> 里设置</strong></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Title<span class="token punctuation">,</span> Subtitle<span class="token punctuation">,</span> Description<span class="token punctuation">,</span> Primary<span class="token punctuation">,</span> Controls<span class="token punctuation">,</span> Stories <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/blocks'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    docs<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">page</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Title</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Subtitle</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Description</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Primary</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Controls</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Stories</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Storybook 的默认模板差不多就是这样的。</p> <p>也可以通过 <code>MDX</code> 设置文档模板，为了表明 <code>MDX</code> 文件是一个文档模板，必须提供带有 <code>isTemplate</code> 属性的 <code>Meta Doc Block</code></p> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code>import { Meta, Title, Subtitle, Description, Primary, Controls, Stories } from '@storybook/blocks';

{/<span class="token italic"><span class="token punctuation">*</span><span class="token content">
  </span><span class="token punctuation">*</span></span> 👇 The isTemplate property is required to tell Storybook that this is a template
  <span class="token list punctuation">*</span> See https://storybook.js.org/docs/api/doc-blocks/doc-block-meta
  <span class="token list punctuation">*</span> to learn how to use
*/}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Meta</span> <span class="token attr-name">isTemplate</span> <span class="token punctuation">/&gt;</span></span>

<span class="token title important"><span class="token punctuation">#</span> Header</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Title</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Subtitle</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Description</span> <span class="token punctuation">/&gt;</span></span>

<span class="token title important"><span class="token punctuation">#</span> Default implementation</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Primary</span> <span class="token punctuation">/&gt;</span></span>

<span class="token title important"><span class="token punctuation">##</span> Inputs</span>

The component accepts the following inputs (props):

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Controls</span> <span class="token punctuation">/&gt;</span></span>

<span class="token title important"><span class="token punctuation">##</span> Additional variations</span>

Listed below are additional variations of the component.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Stories</span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>然后通过 <code>parameters.docs.page</code> 进行配置，<strong>只能在 <code>.storybook/preview.ts</code> 里设置</strong></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> DocumentationTemplate <span class="token keyword">from</span> <span class="token string">'./DocumentationTemplate.mdx'</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    docs<span class="token operator">:</span> <span class="token punctuation">{</span>
      page<span class="token operator">:</span> DocumentationTemplate<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>如果文档内容很多，可以通过 <code>parameters.docs.toc</code> 添加内容导航</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    docs<span class="token operator">:</span> <span class="token punctuation">{</span>
      toc<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 👈 Enables the table of contents</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="补充文档"><a href="#补充文档" class="header-anchor">#</a> 补充文档</h3> <p>可以通过 <a href="https://storybook.js.org/docs/writing-docs/mdx" target="_blank" rel="noopener noreferrer"><code>MDX</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://storybook.js.org/docs/api/doc-blocks/doc-block-meta" target="_blank" rel="noopener noreferrer"><code>Meta Doc Block</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，添加组件补充文档，比如组件的使用说明文档</p> <p>下面是 Modal 组件的使用说明文档</p> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code>{/<span class="token italic"><span class="token punctuation">*</span><span class="token content"> ModalStories.mdx </span><span class="token punctuation">*</span></span>/}
import { Meta, Canvas } from '@storybook/blocks';
import * as ModalStories from &quot;./ModalStories.stories&quot;
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Meta</span> <span class="token attr-name">of</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{ModalStories}</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Usage<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 
<span class="token title important"><span class="token punctuation">#</span> Usage</span>
 
推荐通过 <span class="token code keyword">`openAntdModal`</span> 函数打开 <span class="token code keyword">`Modal`</span>，打开 -&gt; 处理 -&gt; 关闭，整套代码在同一个地方

<span class="token code"><span class="token punctuation">```</span><span class="token code-language">ts</span>
<span class="token code-block language-ts"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> close <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">openAntdModal</span><span class="token punctuation">(</span>Modal<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token operator">:</span> ResourceSelectorType<span class="token punctuation">.</span>Dataset<span class="token punctuation">,</span>
  <span class="token function-variable function">onOk</span><span class="token operator">:</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理逻辑</span>
    <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token punctuation">```</span></span>

 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Canvas</span> <span class="token attr-name">of</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>{ModalStories.OpenByFunction}</span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>注意，如上例所示，必须设置 <code>Meta Doc Block</code> 的 <a href="https://storybook.js.org/docs/api/doc-blocks/doc-block-meta#of" target="_blank" rel="noopener noreferrer"><code>of</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 属性为 CSF 文件的完整导出，才是组件的补充文档。<a href="https://storybook.js.org/docs/api/doc-blocks/doc-block-meta#name" target="_blank" rel="noopener noreferrer"><code>name</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 属性表示文档在侧边栏导航菜单中的名称。</p> <p>组件补充文档才能使用 StoryBook 提供的 <a href="https://storybook.js.org/docs/writing-docs/doc-blocks" target="_blank" rel="noopener noreferrer"><code>Doc blocks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，比如 <a href="https://storybook.js.org/docs/api/doc-blocks/doc-block-stories" target="_blank" rel="noopener noreferrer"><code>Stories</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>我发现一个隐藏规则</strong>，当 MDX 的文件名和 Story 的文件名相同时，如果没有设置 <code>name</code> 属性，这个 MDX 文件会被当作组件的默认文档，如果组件自动生成了默认文档（ <code>tags: ['autodocs']</code> ），则会出现冲突，导致 Storybook 报错。</p> <p>如果 MDX 的文件名和 Story 的文件名不同，而 <code>name</code> 属性没有设置，这相当于 <code>name</code> 被设置为 MDX 的文件名</p> <h3 id="单独文档"><a href="#单独文档" class="header-anchor">#</a> 单独文档</h3> <p>除了组件的补充文档之外，我们可能还会添加一些项目文档，比如项目规范，这种成为单独文档，不能使用 StoryBook 提供的 <a href="https://storybook.js.org/docs/writing-docs/doc-blocks" target="_blank" rel="noopener noreferrer"><code>Doc blocks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>单独文档不要设置 <code>Meta Doc Block</code> 的 <code>of</code> 属性，可以设置 <a href="https://storybook.js.org/docs/api/doc-blocks/doc-block-meta#title" target="_blank" rel="noopener noreferrer"><code>title</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 属性，这个属性和 Story 的 title 属性一样，指示文档在菜单栏中的位置。也可以不使用 <code>Meta Doc Block</code> ，通过文件的目录结构表示文档在菜单栏中的位置</p> <p>举个例子，下面是我写的 CSS 规范，使用 <code>Meta Doc Block</code> 的 <code>title</code> 属性，指示其在菜单栏中的位置</p> <div class="language-markdown line-numbers-mode"><pre class="language-markdown"><code>import { Meta, Controls } from '@storybook/blocks';

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Meta</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Documentation/CSS<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token title important"><span class="token punctuation">#</span> CSS 规范</span>

<span class="token title important"><span class="token punctuation">##</span> BEM</span>

类名遵循 <span class="token url">[<span class="token content">BEM - Block, Element, Modifier</span>](<span class="token url">https://getbem.com/</span>)</span> 规范

<span class="token title important"><span class="token punctuation">###</span> Block</span>

有意义的独立实体，Block 的类名由小写字母、数字和横线组成，比如 <span class="token code keyword">`model`</span>、<span class="token code keyword">`form`</span>、<span class="token code keyword">`paramneter-input`</span>

<span class="token title important"><span class="token punctuation">###</span> Element</span>

块的一部分，Element 的类名由 <span class="token code keyword">`Block 的类名`</span> + <span class="token code keyword">`双下划线（__）`</span> + <span class="token code keyword">`Element 的名称`</span> 组成，比如 <span class="token code keyword">`model__title`</span>、<span class="token code keyword">`form__input`</span>、<span class="token code keyword">`paramneter-input__content`</span>

<span class="token title important"><span class="token punctuation">###</span> Modifier</span>

块或元素的变种，Modifier 的类名由 <span class="token code keyword">`Block 的类名`</span> 或者 <span class="token code keyword">`Element 的类名`</span> + <span class="token code keyword">`双横线（--）`</span> + <span class="token code keyword">`Modifier 的名称`</span> 组成，比如 <span class="token code keyword">`button--active`</span>、<span class="token code keyword">`form--large`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="自定义主题"><a href="#自定义主题" class="header-anchor">#</a> 自定义主题</h2> <p>Storybook 8.5 的<a href="https://storybook.js.org/docs/configure/user-interface/theming" target="_blank" rel="noopener noreferrer">自定义主题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>与<a href="/2023/09/02/storybook-in-action/#主题">之前的</a>有些许改变，使用 <code>@storybook/manager-api</code> 代替 <code>@storybook/addons</code></p> <ol><li>首先安装 <code>@storybook/manager-api</code> 和 <code>@storybook/theming</code></li></ol> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">yarn</span> <span class="token function">add</span> --dev @storybook/addons @storybook/theming
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>然后创建主题，包括标题，logo，点击 logo 的跳转URL</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// .storybook/theme.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> create <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/theming'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Logo <span class="token keyword">from</span> <span class="token string">'./logo.png'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  base<span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">,</span>
  brandTitle<span class="token operator">:</span> <span class="token string">'组件库文档'</span><span class="token punctuation">,</span>
  brandImage<span class="token operator">:</span> Logo<span class="token punctuation">,</span>
  brandUrl<span class="token operator">:</span> <span class="token string">'https://storybook.js.org/docs'</span><span class="token punctuation">,</span>
  brandTarget<span class="token operator">:</span> <span class="token string">'_blank'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="3"><li>最后添加新创建的主题</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// .storybook/manager.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> addons <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/manager-api'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> theme <span class="token keyword">from</span> <span class="token string">'./theme'</span><span class="token punctuation">;</span>

addons<span class="token punctuation">.</span><span class="token function">setConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  theme<span class="token operator">:</span> theme<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="addons-配置详解"><a href="#addons-配置详解" class="header-anchor">#</a> Addons 配置详解</h2> <h3 id="essential-addons"><a href="#essential-addons" class="header-anchor">#</a> Essential Addons</h3> <p><a href="https://storybook.js.org/docs/essentials" target="_blank" rel="noopener noreferrer">Essential addons<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 包括 10 个 Storybook 核心插件</p> <ul><li><a href="https://storybook.js.org/docs/essentials/actions" target="_blank" rel="noopener noreferrer">Actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/backgrounds" target="_blank" rel="noopener noreferrer">Backgrounds<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/controls" target="_blank" rel="noopener noreferrer">Controls<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/writing-docs" target="_blank" rel="noopener noreferrer">Docs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/highlight" target="_blank" rel="noopener noreferrer">Highlight<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/measure-and-outline" target="_blank" rel="noopener noreferrer">Measure &amp; Outline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/toolbars-and-globals" target="_blank" rel="noopener noreferrer">Toolbars &amp; Globals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://storybook.js.org/docs/essentials/viewport" target="_blank" rel="noopener noreferrer">Viewport<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h4 id="actions"><a href="#actions" class="header-anchor">#</a> Actions</h4> <p>Actions 插件用于显示 stories 中事件处理程序（回调函数）接收的数据。</p> <p>通过 <code>@storybook/test</code> 的 <code>fn</code> 函数 mock 组件方法，将日志打印在 <code>Actions</code> 面板上</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Meta <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react-webpack5'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/test'</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./Button'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> meta<span class="token operator">:</span> Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Button<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Button<span class="token punctuation">,</span>
  <span class="token comment">// 👇 Use `fn` to spy on the onClick arg, which will appear in the actions panel once invoked</span>
  args<span class="token operator">:</span> <span class="token punctuation">{</span> onClick<span class="token operator">:</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>但是这个方法只对 <code>args</code> 有用，手动调用需要使用 <a href="https://storybook.js.org/docs/essentials/actions#action" target="_blank" rel="noopener noreferrer"><code>action</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/addon-actions'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> InForm<span class="token operator">:</span> Story <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span> <span class="token attr-name">onFinish</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'onFinish'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">htmlType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          提交
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Form</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Actions 通过 <code>parameters.actions</code> 进行配置</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    actions<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 模式匹配，自动使用 `fn` 函数 mock 匹配的组件方法，这个 Storybook 已经不推荐了</span>
      actions<span class="token operator">:</span> <span class="token punctuation">{</span> argTypesRegex<span class="token operator">:</span> <span class="token string">'^on.*'</span> <span class="token punctuation">}</span> 
      <span class="token comment">// 检测是否发出某些 HTML 事件，格式是 `&lt;eventname&gt; &lt;selector&gt;`</span>
      handles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mouseover'</span><span class="token punctuation">,</span> <span class="token string">'click .btn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    	<span class="token comment">// 禁止 actions 插件 </span>
    	disable<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="backgrounds"><a href="#backgrounds" class="header-anchor">#</a> Backgrounds</h4> <p>Backgrounds 插件通过工具栏，设置背景色和网格。</p> <p>Backgrounds 通过 <code>parameters.backgrounds</code> 进行配置</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    backgrounds<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// backgrounds 工具栏有哪些背景颜色可选</span>
      values<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Dark'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'#000'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Gray'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'#f9fafb'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Light'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">'#FFF'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 默认的背景颜色</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">'Light'</span><span class="token punctuation">,</span>
      <span class="token comment">// 网格</span>
      grid<span class="token operator">:</span> <span class="token punctuation">{</span>
        cellAmount<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        cellSize<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        opacity<span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
        offsetX<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token comment">// Default is 0 if story has 'fullscreen' layout, 16 if layout is 'padded'</span>
        offsetY<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token comment">// Default is 0 if story has 'fullscreen' layout, 16 if layout is 'padded'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 禁止 Backgrounds 插件 </span>
      disable<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="controls"><a href="#controls" class="header-anchor">#</a> Controls</h4> <p>Controls 插件提供了一个图形 UI，无需编码即可动态地与组件的参数交互</p> <p>Controls 通过 <code>parameters.controls</code> 进行配置</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    controls<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 使用模式推断参数应该使用哪种控件，目前只有颜色选择器和日期选择器控件</span>
      matchers<span class="token operator">:</span> <span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(background|color)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        date<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Date$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 在 Story 里的 Control 面板是否和 `Controls doc block` 一样有 `Description`	和 `Default` 信息</span>
      expanded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// 预设颜色选择器的颜色</span>
      presetColors<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#ff4785'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'Coral'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'rgba(0, 159, 183, 1)'</span><span class="token punctuation">,</span> <span class="token string">'#fe4a49'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// `include` 和 `exclude` 显示和排除哪些参数，也支持正则表达式 `include: /^hello*/`</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 参数排序，'requiredFirst': 必填优先，'alpha': 按参数名称排序，默认是 'none'</span>
      sort<span class="token operator">:</span> <span class="token string">'requiredFirst'</span><span class="token punctuation">,</span>
      <span class="token comment">// 禁止新建、修改 story，这是 Storybook 8 的新功能</span>
      disableSaveFromUI<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// 禁止 Controls 插件</span>
      disable<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>除了通过 <code>parameters.controls</code> 配置 Controls 插件整体功能之外，还可以通过 <a href="https://storybook.js.org/docs/api/arg-types" target="_blank" rel="noopener noreferrer">ArgTypes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置单个参数的控件类型和功能。</p> <h4 id="highlight"><a href="#highlight" class="header-anchor">#</a> Highlight</h4> <p>Highlight 插件用于直观地调试你的组件，突出显示 story 中的特定 DOM 节点。这个插件只有一个 <code>disable</code> 配置选项</p> <h4 id="docs"><a href="#docs" class="header-anchor">#</a> Docs</h4> <p>参考 <a href="https://www.joylearn123.com/2023/01/04/storybook/#docs-configuration-summary" target="_blank" rel="noopener noreferrer">Docs configuration summary<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="measure-outline"><a href="#measure-outline" class="header-anchor">#</a> Measure &amp; Outline</h4> <p>Measure 和 Outline 插件用于检查和直观地调试 story 中的 CSS 布局和对齐问题。这两个插件也只有一个 <code>disable</code> 配置选项</p> <h4 id="toolbars-globals"><a href="#toolbars-globals" class="header-anchor">#</a> Toolbars &amp; Globals</h4> <p>Toolbars 插件用于渲染 Storybook 工具栏 UI，通过它可以选择背景颜色和显示网格（Backgrounds 插件）、改变预览画布的大小（ViewPort 插件）以及测量 DOM 元素的大小和显示 DOM 元素的轮廓。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>除了 Storybook 默认的工具栏菜单，Toolbars 插件可以添加新的工具栏菜单。因为它们适用于所有的 story，因此被称为 <a href="https://storybook.js.org/docs/essentials/toolbars-and-globals#globals" target="_blank" rel="noopener noreferrer"><code>Globals</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（全局参数）。</p> <p>下面添加一个国际化语言的菜单</p> <blockquote><p>注意 <code>globalTypes</code> 和 <code>initialGlobals</code> 配置项不在 <code>parameters</code> 选项里</p></blockquote> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
 
<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  globalTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    locale<span class="token operator">:</span> <span class="token punctuation">{</span>
      description<span class="token operator">:</span> <span class="token string">'国际化语言'</span><span class="token punctuation">,</span>
      toolbar<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有哪些图标可以使用？👇</span>
        <span class="token comment">// https://storybook.js.org/docs/faq#what-icons-are-available-for-my-toolbar-or-my-addon</span>
        icon<span class="token operator">:</span> <span class="token string">'globe'</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> <span class="token string">'Locale'</span><span class="token punctuation">,</span>
        dynamicTitle<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        items<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token string">'🇺🇸'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'English'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'fr'</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token string">'🇫🇷'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'Français'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token string">'🇪🇸'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'Español'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
           <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'zh'</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token string">'🇨🇳'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'中文'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token string">'kr'</span><span class="token punctuation">,</span> right<span class="token operator">:</span> <span class="token string">'🇰🇷'</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'한국어'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 默认值</span>
  initialGlobals<span class="token operator">:</span> <span class="token punctuation">{</span>
    locale<span class="token operator">:</span> <span class="token string">'zh'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><img src="/assets/img/umijs-storybook-toolbar-locale.ba7e8e31.png" alt=""></p> <p>通过 <a href="https://storybook.js.org/docs/writing-stories/decorators" target="_blank" rel="noopener noreferrer">Decorators<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以访问全局参数，下面我通过 Decorators 设置 <a href="https://ant-design.antgroup.com/docs/react/i18n-cn" target="_blank" rel="noopener noreferrer">Ant Design 的国际化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> App<span class="token punctuation">,</span> ConfigProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> zh <span class="token keyword">from</span> <span class="token string">'antd/locale/zh_CN'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> en <span class="token keyword">from</span> <span class="token string">'antd/locale/en'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> fr <span class="token keyword">from</span> <span class="token string">'antd/locale/fr_FR'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> es <span class="token keyword">from</span> <span class="token string">'antd/locale/es_ES'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> kr <span class="token keyword">from</span> <span class="token string">'antd/locale/ko_KR'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> locales <span class="token operator">=</span> <span class="token punctuation">{</span>
  zh<span class="token punctuation">,</span>
  es<span class="token punctuation">,</span>
  fr<span class="token punctuation">,</span> 
  es<span class="token punctuation">,</span> 
  kr
<span class="token punctuation">}</span>

<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  decorators<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token parameter">story<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> selectedLocale<span class="token operator">=</span> context<span class="token punctuation">.</span>globals<span class="token punctuation">.</span>locale <span class="token operator">||</span> <span class="token string">'zh'</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigProvider</span></span>
        	<span class="token attr-name">locale</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>locales<span class="token punctuation">[</span>selectedLocale<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
          <span class="token punctuation">&gt;</span></span><span class="token plain-text">
       			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Story</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConfigProvider</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="viewport"><a href="#viewport" class="header-anchor">#</a> Viewport</h4> <p>Viewport 插件可以修改预览画布的大小，适用于响应式或者手机端开发</p> <p>Viewport 通过 <code>parameters.viewport</code> 进行配置</p> <p>默认 Storybook 使用 <a href="https://storybook.js.org/docs/essentials/viewport#minimal_viewports" target="_blank" rel="noopener noreferrer"><code>MINIMAL_VIEWPORTS</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它只有三个尺寸，我们可以设置为 <a href="https://storybook.js.org/docs/essentials/viewport#initial_viewports" target="_blank" rel="noopener noreferrer"><code>INITIAL_VIEWPORTS</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（预设的全部尺寸），甚至还可以添加新的尺寸</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token comment">// .storybook/preview.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Preview <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">INITIAL_VIEWPORTS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@storybook/addon-viewport'</span>

<span class="token keyword">const</span> kindleViewports <span class="token operator">=</span> <span class="token punctuation">{</span>
  kindleFire2<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Kindle Fire 2'</span><span class="token punctuation">,</span>
    styles<span class="token operator">:</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token string">'600px'</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token string">'963px'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  kindleFireHD<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Kindle Fire HD'</span><span class="token punctuation">,</span>
    styles<span class="token operator">:</span> <span class="token punctuation">{</span>
      width<span class="token operator">:</span> <span class="token string">'533px'</span><span class="token punctuation">,</span>
      height<span class="token operator">:</span> <span class="token string">'801px'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> preview<span class="token operator">:</span> Preview <span class="token operator">=</span> <span class="token punctuation">{</span>
  parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
    viewport<span class="token operator">:</span> <span class="token punctuation">{</span>
      viewports<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token constant">MINIMAL_VIEWPORTS</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>kindleViewports<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      defaultViewport<span class="token operator">:</span> <span class="token string">'ipad'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> preview<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="argtypes-详解"><a href="#argtypes-详解" class="header-anchor">#</a> ArgTypes 详解</h2> <p>一般情况下，Storybook 根据组件的参数注释，自动生成 Story 组件参数文档，根据组件参数类型自动推断出 Story 组件参数的控件类型</p> <p><img src="/assets/img/umijs-storybook-argtypes.70c528b7.png" alt=""></p> <p>但是一些特殊情况下，我们可以修改 Storybook 自动生成的参数文档和控件类型</p> <blockquote><p>更多详情请参考 <a href="https://storybook.js.org/docs/api/arg-types" target="_blank" rel="noopener noreferrer">Storybook ArgTypes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token punctuation">{</span>
  <span class="token comment">// 组件参数名称</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改参数的名称，一般没有必要</span>
    name<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">/* 
    	修改 argType 的语义类型，这个选项用于推断其它属性，如 `control` 和 `table.type`
    	SBType 的类型比较复杂，详见 https://storybook.js.org/docs/api/arg-types#type
    */</span>
    <span class="token keyword">type</span><span class="token operator">?</span><span class="token operator">:</span> SBType <span class="token operator">|</span> SBScalarType<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 修改参数描述，上图中的 `Description` 列</span>
    description<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">// 根据另一个参数或 global 的值，有条件地显示当前参数</span>
    <span class="token keyword">if</span><span class="token operator">?</span><span class="token operator">:</span> Conditional<span class="token punctuation">;</span>
    <span class="token comment">// 选项数组，一般用于 `select`、`radio`、`checkbox` 等控件类型.</span>
    <span class="token comment">// 当该属性有值时，`control` 默认是 `select`</span>
    options<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 将 `options` 映射到别的值</span>
    mapping<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>option<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 控件类型，看下面的注释</span>
  	<span class="token comment">// 为 `false` 时，隐藏参数的控件</span>
  	control<span class="token operator">?</span><span class="token operator">:</span> ControlType <span class="token operator">|</span> ControlTypeObject <span class="token operator">|</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 参数的文档表格，用于 `ArgTypes doc block`、`Controls doc block` 和 Controls 面板</span>
    table<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 指定参数的类型，`summary` 通常用于值本身，而 `detail` 用于其他信息，实现效果看下文</span>
      <span class="token keyword">type</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> detail<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  		<span class="token comment">// 指定参数的默认值，`summary` 通常用于值本身，而 `detail` 用于其他信息，实现效果看下文</span>
      defaultValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> detail<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  		<span class="token comment">// 将参数分类，这个是分类名称</span>
      category<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
      <span class="token comment">// 将参数分类，这个是子分类名称</span>
      subcategory<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  		<span class="token comment">// 该参数只读</span>
  		<span class="token keyword">readonly</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
      <span class="token comment">// 不显示该参数</span>
      disable<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">ControlTypeObject</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 控件类型，见下文</span>
  <span class="token keyword">type</span><span class="token operator">:</span> ControlType<span class="token punctuation">,</span>
  <span class="token comment">// 将 `options` 的值映射为 `label`，其实就是修改 `options` 的显示文本</span>
  labels<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>option<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// type 为 `file` 时有用，表示文件的 MIME types</span>
  accept<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">// type 为 `color` 时有用，表示预设颜色</span>
  presetColors<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 下面三个，当 type 为 `number` 或 `range` 时有用，表示最大值、最小值、步进值</span>
  max<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  min<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  step<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Conditional</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 别的参数或者 `global` 参数，默认是 { truthy: true }</span>
  <span class="token punctuation">[</span>predicateType<span class="token operator">:</span> <span class="token string">'arg'</span> <span class="token operator">|</span> <span class="token string">'global'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token comment">// 相等</span>
  eq<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token comment">// 不相等</span>
  neq<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
  <span class="token comment">// 定义了（非 undefined 或 null 值）</span>
  exists<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
 	<span class="token comment">// truthy，</span>
  truthy<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h3 id="control-type"><a href="#control-type" class="header-anchor">#</a> Control Type</h3> <table><thead><tr><th><strong>array</strong></th> <th><code>'object'</code></th> <th>Provides a JSON-based editor to handle the values of the array. Also allows editing in raw mode. <code>{ control: 'object' }</code></th></tr></thead> <tbody><tr><td><strong>boolean</strong></td> <td><code>'boolean'</code></td> <td>Provides a toggle for switching between possible states. <code>{ control: 'boolean' }</code></td></tr> <tr><td><strong>enum</strong></td> <td><code>'check'</code></td> <td>Provides a set of stacked checkboxes for selecting multiple options. <code>{ control: 'check', options: ['email', 'phone', 'mail'] }</code></td></tr> <tr><td></td> <td><code>'inline-check'</code></td> <td>Provides a set of inlined checkboxes for selecting multiple options. <code>{ control: 'inline-check', options: ['email', 'phone', 'mail'] }</code></td></tr> <tr><td></td> <td><code>'radio'</code></td> <td>Provides a set of stacked radio buttons based on the available options. <code>{ control: 'radio', options: ['email', 'phone', 'mail'] }</code></td></tr> <tr><td></td> <td><code>'inline-radio'</code></td> <td>Provides a set of inlined radio buttons based on the available options. <code>{ control: 'inline-radio', options: ['email', 'phone', 'mail'] }</code></td></tr> <tr><td></td> <td><code>'select'</code></td> <td>Provides a select to choose a single value from the options. <code>{ control: 'select', options: [20, 30, 40, 50] }</code></td></tr> <tr><td></td> <td><code>'multi-select'</code></td> <td>Provides a select to choose multiple values from the options. <code>{ control: 'multi-select', options: ['USA', 'Canada', 'Mexico'] }</code></td></tr> <tr><td><strong>number</strong></td> <td><code>'number'</code></td> <td>Provides a numeric input to include the range of all possible values. <code>{ control: { type: 'number', min:1, max:30, step: 2 } }</code></td></tr> <tr><td></td> <td><code>'range'</code></td> <td>Provides a range slider to include all possible values. <code>{ control: { type: 'range', min: 1, max: 30, step: 3 } }</code></td></tr> <tr><td><strong>object</strong></td> <td><code>'file'</code></td> <td>Provides a file input that returns an array of URLs. Can be further customized to accept specific file types. <code>{ control: { type: 'file', accept: '.png' } }</code></td></tr> <tr><td></td> <td><code>'object'</code></td> <td>Provides a JSON-based editor to handle the object's values. Also allows editing in raw mode. <code>{ control: 'object' }</code></td></tr> <tr><td><strong>string</strong></td> <td><code>'color'</code></td> <td>Provides a color picker to choose color values. Can be additionally configured to include a set of color presets. <code>{ control: { type: 'color', presetColors: ['red', 'green']} }</code></td></tr> <tr><td></td> <td><code>'date'</code></td> <td>Provides a datepicker to choose a date. <code>{ control: 'date' }</code>。The <code>date</code> control will convert the date into a UNIX timestamp</td></tr> <tr><td></td> <td><code>'text'</code></td> <td>Provides a freeform text input. <code>{ control: 'text' }</code></td></tr></tbody></table> <h3 id="举例"><a href="#举例" class="header-anchor">#</a> 举例</h3> <p>一般情况下使用 Storybook 的自动推断就可以了，但是有些场景还是需要使用 ArgTypes 进行手动修改，下面将列举几个常见的场景</p> <h4 id="枚举"><a href="#枚举" class="header-anchor">#</a> 枚举</h4> <p>Storybook 能自动推断 <code>small | middle | large</code>  这种字符串常量组成的 <code>Union Types</code> 为 <code>radio</code> 控件，但是无法推断 Typescript 的枚举类型，因此我们就需要手动修改 Typescript 的枚举类型的控件类型，可以是 <code>radio</code> 或者 <code>select</code> 等</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// Storybook 推断这种类型为 text 控件</span>
<span class="token keyword">export</span> <span class="token keyword">enum</span> EmptyType <span class="token punctuation">{</span>
  NoData <span class="token operator">=</span> <span class="token string">'NoData'</span><span class="token punctuation">,</span>
  NotFound <span class="token operator">=</span> <span class="token string">'NotFound'</span><span class="token punctuation">,</span>
  Developing <span class="token operator">=</span> <span class="token string">'Developing'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置控件类型为 `radio`</span>
<span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
  	<span class="token keyword">type</span><span class="token operator">:</span> <span class="token punctuation">{</span> control<span class="token operator">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span> options<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>EmptyType<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="映射"><a href="#映射" class="header-anchor">#</a> 映射</h4> <p>Storybook 只支持能 JSON 序列化的类型，如果是 JSX 或者 DOM 元素，Storybook 无法提供正确的控件，这个时候我们进行映射</p> <div class="language-tsx line-numbers-mode"><pre class="language-tsx"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      options<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Normal'</span><span class="token punctuation">,</span> <span class="token string">'Bold'</span><span class="token punctuation">,</span> <span class="token string">'Italic'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      mapping<span class="token operator">:</span> <span class="token punctuation">{</span>
        Bold<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Bold</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
        Italic<span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Italic</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      control<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> <span class="token string">&quot;select&quot;</span>
        <span class="token comment">// 还可以将 `options` 的值映射为 `label`，我觉得没太大的必要</span>
        labels<span class="token operator">:</span> <span class="token punctuation">{</span>
        	Normal<span class="token operator">:</span> <span class="token string">&quot;正常&quot;</span><span class="token punctuation">,</span>
        	Bold<span class="token operator">:</span> <span class="token string">&quot;粗体&quot;</span><span class="token punctuation">,</span>
        	Italic<span class="token operator">:</span> <span class="token string">&quot;斜体&quot;</span><span class="token punctuation">,</span>
      	<span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="有条件的显示"><a href="#有条件的显示" class="header-anchor">#</a> 有条件的显示</h4> <p>有时候需要根据另一个参数的值来判断是否现在该参数，可以使用 <code>if</code></p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    advanced<span class="token operator">:</span> <span class="token punctuation">{</span> control<span class="token operator">:</span> <span class="token string">'boolean'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// Only enabled if advanced is true</span>
    margin<span class="token operator">:</span> <span class="token punctuation">{</span> control<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token operator">:</span> <span class="token punctuation">{</span> arg<span class="token operator">:</span> <span class="token string">'advanced'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    padding<span class="token operator">:</span> <span class="token punctuation">{</span> control<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token operator">:</span> <span class="token punctuation">{</span> arg<span class="token operator">:</span> <span class="token string">'advanced'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    cornerRadius<span class="token operator">:</span> <span class="token punctuation">{</span> control<span class="token operator">:</span> <span class="token string">'number'</span><span class="token punctuation">,</span> <span class="token keyword">if</span><span class="token operator">:</span> <span class="token punctuation">{</span> arg<span class="token operator">:</span> <span class="token string">'advanced'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="不显示控件"><a href="#不显示控件" class="header-anchor">#</a> 不显示控件</h4> <p>设置 <code>control</code> 为 <code>false</code>，可以去掉参数的控件</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      control<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="隐藏"><a href="#隐藏" class="header-anchor">#</a> 隐藏</h4> <p>设置 <code>table.disable</code> 为 <code>true</code>，可以去掉参数的控件</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    label<span class="token operator">:</span> <span class="token punctuation">{</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
      	disable<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="自定义-table-属性"><a href="#自定义-table-属性" class="header-anchor">#</a> 自定义 Table 属性</h4> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> meta <span class="token operator">=</span> <span class="token punctuation">{</span>
  component<span class="token operator">:</span> Example<span class="token punctuation">,</span>
  argTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
    labelWidth<span class="token operator">:</span> <span class="token punctuation">{</span>
      table<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">type</span><span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'type'</span><span class="token punctuation">,</span> detail<span class="token operator">:</span> <span class="token string">'This is type'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        category<span class="token operator">:</span> <span class="token string">'category'</span><span class="token punctuation">,</span>
        subcategory<span class="token operator">:</span> <span class="token string">'subcategory'</span><span class="token punctuation">,</span>
        defaultValue<span class="token operator">:</span> <span class="token punctuation">{</span> summary<span class="token operator">:</span> <span class="token string">'defaultValue'</span><span class="token punctuation">,</span> detail<span class="token operator">:</span> <span class="token string">'This is defaultValue'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">readonly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Meta<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Example<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> meta<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>效果如下</p> <p><img src="/assets/img/umijs-storybook-argtypes-table.3fc5f7bc.png" alt=""></p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><p><a href="https://storybook.js.org/" target="_blank" rel="noopener noreferrer">Storybook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://umijs.org/" target="_blank" rel="noopener noreferrer">UmiJS 4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-swc" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-swc</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://storybook.js.org/addons/@storybook/addon-webpack5-compiler-babel" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-webpack5-compiler-babel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://storybook.js.org/addons/@storybook/addon-styling-webpack" target="_blank" rel="noopener noreferrer"><code>@storybook/addon-styling-webpack</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://juejin.cn/post/7252889628376694841" target="_blank" rel="noopener noreferrer">umi项目接入storybook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#实现效果" title="实现效果">实现效果</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#安装" title="安装">安装</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#javascript-编译器" title="JavaScript 编译器">JavaScript 编译器</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#typescript" title="Typescript">Typescript</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#样式" title="样式">样式</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#storybook-addon-styling-webpack" title="@storybook/addon-styling-webpack">@storybook/addon-styling-webpack</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#修改-webpack-配置" title="修改 Webpack 配置">修改 Webpack 配置</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#css-modules" title="CSS Modules">CSS Modules</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#mock-modules" title="Mock Modules">Mock Modules</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#mock-request" title="Mock Request">Mock Request</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#文档" title="文档">文档</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#默认文档" title="默认文档">默认文档</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#补充文档" title="补充文档">补充文档</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#单独文档" title="单独文档">单独文档</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#自定义主题" title="自定义主题">自定义主题</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#addons-配置详解" title="Addons 配置详解">Addons 配置详解</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#essential-addons" title="Essential Addons">Essential Addons</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#argtypes-详解" title="ArgTypes 详解">ArgTypes 详解</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#control-type" title="Control Type">Control Type</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#举例" title="举例">举例</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#references" title="References">References</a></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b07256e7.js" defer></script><script src="/assets/js/34.49b71b2c.js" defer></script><script src="/assets/js/3.276926dd.js" defer></script><script src="/assets/js/11.e6a0311f.js" defer></script>
  </body>
</html>
