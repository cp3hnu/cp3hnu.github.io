<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>402-What&#39;s New in Swift | Study &amp; Product</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="
Overview

Shared Swift Runtime for Apps
Binary Frameworks
Library Evolution
[Shared Swift Runtime for ...">
    <meta name="algolia-site-verification" content="23333450F18E92C1">
    
    <link rel="preload" href="/assets/css/0.styles.cd1f7b12.css" as="style"><link rel="preload" href="/assets/js/app.b07256e7.js" as="script"><link rel="preload" href="/assets/js/34.49b71b2c.js" as="script"><link rel="preload" href="/assets/js/5.373c53f3.js" as="script"><link rel="preload" href="/assets/js/16.eb29ed80.js" as="script"><link rel="prefetch" href="/assets/js/10.7c5bc6fc.js"><link rel="prefetch" href="/assets/js/100.f675d046.js"><link rel="prefetch" href="/assets/js/101.92ede1ec.js"><link rel="prefetch" href="/assets/js/102.678a907d.js"><link rel="prefetch" href="/assets/js/103.959ad108.js"><link rel="prefetch" href="/assets/js/104.b15677eb.js"><link rel="prefetch" href="/assets/js/105.377da8a5.js"><link rel="prefetch" href="/assets/js/106.29a8c44d.js"><link rel="prefetch" href="/assets/js/107.64b19904.js"><link rel="prefetch" href="/assets/js/108.a3e75a67.js"><link rel="prefetch" href="/assets/js/109.283d92d8.js"><link rel="prefetch" href="/assets/js/11.e6a0311f.js"><link rel="prefetch" href="/assets/js/110.cbb6ea81.js"><link rel="prefetch" href="/assets/js/111.252f143f.js"><link rel="prefetch" href="/assets/js/112.df62c9fe.js"><link rel="prefetch" href="/assets/js/113.66189350.js"><link rel="prefetch" href="/assets/js/114.890cd7de.js"><link rel="prefetch" href="/assets/js/115.53823707.js"><link rel="prefetch" href="/assets/js/116.caaa6eaa.js"><link rel="prefetch" href="/assets/js/117.b7b0f88f.js"><link rel="prefetch" href="/assets/js/118.03168974.js"><link rel="prefetch" href="/assets/js/119.90f4d7b7.js"><link rel="prefetch" href="/assets/js/12.8da07182.js"><link rel="prefetch" href="/assets/js/120.b654e5ee.js"><link rel="prefetch" href="/assets/js/121.92d87086.js"><link rel="prefetch" href="/assets/js/13.a9f90626.js"><link rel="prefetch" href="/assets/js/14.b18d5210.js"><link rel="prefetch" href="/assets/js/15.835c7671.js"><link rel="prefetch" href="/assets/js/17.c4871518.js"><link rel="prefetch" href="/assets/js/18.606b879c.js"><link rel="prefetch" href="/assets/js/19.777086a8.js"><link rel="prefetch" href="/assets/js/20.c8e69fcc.js"><link rel="prefetch" href="/assets/js/21.6cda2658.js"><link rel="prefetch" href="/assets/js/22.19e356e1.js"><link rel="prefetch" href="/assets/js/23.ca8661ea.js"><link rel="prefetch" href="/assets/js/24.9f090eaf.js"><link rel="prefetch" href="/assets/js/25.be2c8a0c.js"><link rel="prefetch" href="/assets/js/26.5ce52eaa.js"><link rel="prefetch" href="/assets/js/27.d75e1151.js"><link rel="prefetch" href="/assets/js/28.6863d7e4.js"><link rel="prefetch" href="/assets/js/29.d8a1c4f2.js"><link rel="prefetch" href="/assets/js/3.276926dd.js"><link rel="prefetch" href="/assets/js/30.178b8dc0.js"><link rel="prefetch" href="/assets/js/31.4c488d0e.js"><link rel="prefetch" href="/assets/js/32.ce3ae3c7.js"><link rel="prefetch" href="/assets/js/33.828dd0d1.js"><link rel="prefetch" href="/assets/js/35.9496ed4c.js"><link rel="prefetch" href="/assets/js/36.33ada8e1.js"><link rel="prefetch" href="/assets/js/37.e9705ffe.js"><link rel="prefetch" href="/assets/js/38.f9c57096.js"><link rel="prefetch" href="/assets/js/39.75b77f83.js"><link rel="prefetch" href="/assets/js/4.c651aa9d.js"><link rel="prefetch" href="/assets/js/40.4496a5db.js"><link rel="prefetch" href="/assets/js/41.260393e3.js"><link rel="prefetch" href="/assets/js/42.083f9350.js"><link rel="prefetch" href="/assets/js/43.8d311a8e.js"><link rel="prefetch" href="/assets/js/44.df55763b.js"><link rel="prefetch" href="/assets/js/45.e19037c7.js"><link rel="prefetch" href="/assets/js/46.9529f37b.js"><link rel="prefetch" href="/assets/js/47.8d631e39.js"><link rel="prefetch" href="/assets/js/48.3acad59c.js"><link rel="prefetch" href="/assets/js/49.9a12a900.js"><link rel="prefetch" href="/assets/js/50.f30877b8.js"><link rel="prefetch" href="/assets/js/51.e8b2adf9.js"><link rel="prefetch" href="/assets/js/52.e6a458bb.js"><link rel="prefetch" href="/assets/js/53.e4027d0c.js"><link rel="prefetch" href="/assets/js/54.5a4be38d.js"><link rel="prefetch" href="/assets/js/55.924ee4f8.js"><link rel="prefetch" href="/assets/js/56.11ff1ccf.js"><link rel="prefetch" href="/assets/js/57.14327960.js"><link rel="prefetch" href="/assets/js/58.cea182b0.js"><link rel="prefetch" href="/assets/js/59.2db874c7.js"><link rel="prefetch" href="/assets/js/6.6878fac4.js"><link rel="prefetch" href="/assets/js/60.e3e4017b.js"><link rel="prefetch" href="/assets/js/61.d5cd385e.js"><link rel="prefetch" href="/assets/js/62.6929f93f.js"><link rel="prefetch" href="/assets/js/63.3f8bf719.js"><link rel="prefetch" href="/assets/js/64.e89e1572.js"><link rel="prefetch" href="/assets/js/65.a4335c65.js"><link rel="prefetch" href="/assets/js/66.cc9fb484.js"><link rel="prefetch" href="/assets/js/67.d5da8f2f.js"><link rel="prefetch" href="/assets/js/68.91a38f6d.js"><link rel="prefetch" href="/assets/js/69.800ca600.js"><link rel="prefetch" href="/assets/js/7.6f2558ea.js"><link rel="prefetch" href="/assets/js/70.f7b16ee7.js"><link rel="prefetch" href="/assets/js/71.e34929dc.js"><link rel="prefetch" href="/assets/js/72.175a64bf.js"><link rel="prefetch" href="/assets/js/73.c3dcfd4b.js"><link rel="prefetch" href="/assets/js/74.65978082.js"><link rel="prefetch" href="/assets/js/75.718d5152.js"><link rel="prefetch" href="/assets/js/76.2ed620b3.js"><link rel="prefetch" href="/assets/js/77.f8726387.js"><link rel="prefetch" href="/assets/js/78.1dea2e59.js"><link rel="prefetch" href="/assets/js/79.f62213a1.js"><link rel="prefetch" href="/assets/js/8.81ebcef8.js"><link rel="prefetch" href="/assets/js/80.7600ac29.js"><link rel="prefetch" href="/assets/js/81.ab94746f.js"><link rel="prefetch" href="/assets/js/82.26baf7f8.js"><link rel="prefetch" href="/assets/js/83.89a3942a.js"><link rel="prefetch" href="/assets/js/84.1a5577ac.js"><link rel="prefetch" href="/assets/js/85.eb62de22.js"><link rel="prefetch" href="/assets/js/86.7635121c.js"><link rel="prefetch" href="/assets/js/87.5bee4d72.js"><link rel="prefetch" href="/assets/js/88.04d56860.js"><link rel="prefetch" href="/assets/js/89.09a7d920.js"><link rel="prefetch" href="/assets/js/9.7f69b9b1.js"><link rel="prefetch" href="/assets/js/90.dac6a66e.js"><link rel="prefetch" href="/assets/js/91.14f101dd.js"><link rel="prefetch" href="/assets/js/92.d398eb09.js"><link rel="prefetch" href="/assets/js/93.7a5477fa.js"><link rel="prefetch" href="/assets/js/94.c4bf7674.js"><link rel="prefetch" href="/assets/js/95.a0c3c94c.js"><link rel="prefetch" href="/assets/js/96.c3a44db5.js"><link rel="prefetch" href="/assets/js/97.6956ed39.js"><link rel="prefetch" href="/assets/js/98.ad65fe08.js"><link rel="prefetch" href="/assets/js/99.4fe76e2f.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.cb5d1302.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd1f7b12.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Study &amp; Product </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/notebook/" class="nav-link router-link-active">Notebook</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Study &amp; Product </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/notebook/" class="nav-link router-link-active">Notebook</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper index-page"><div id="vuepress-theme-blog__post-layout"><aside class="sidebar"> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/notebook/wwdc/" class="sidebar-heading clickable router-link-active open"><span>WWDC</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2017</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>2019</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/wwdc/2019/documents/206.html" class="sidebar-link">206-Introducing SF Symbols</a></li><li><a href="/notebook/wwdc/2019/documents/212.html" class="sidebar-link">212-Introducing Multiple Windows on iPad</a></li><li><a href="/notebook/wwdc/2019/documents/214.html" class="sidebar-link">214-Implementing Dark Mode on iOS</a></li><li><a href="/notebook/wwdc/2019/documents/215.html" class="sidebar-link">215-Advances in Collection View Layout</a></li><li><a href="/notebook/wwdc/2019/documents/220.html" class="sidebar-link">220-Advances in UI Data Sources</a></li><li><a href="/notebook/wwdc/2019/documents/224.html" class="sidebar-link">224-Modernizing Your UI for iOS 13</a></li><li><a href="/notebook/wwdc/2019/documents/227.html" class="sidebar-link">227-Font Management and Text Scaling</a></li><li><a href="/notebook/wwdc/2019/documents/234.html" class="sidebar-link">234-Text Recognition in Vision Framework</a></li><li><a href="/notebook/wwdc/2019/documents/235.html" class="sidebar-link">235-Taking iPad Apps for Mac to the Next Level</a></li><li><a href="/notebook/wwdc/2019/documents/246.html" class="sidebar-link">246-Window Management in Your Multitasking App</a></li><li><a href="/notebook/wwdc/2019/documents/256.html" class="sidebar-link">256-Advances in Speech Recognition</a></li><li><a href="/notebook/wwdc/2019/documents/258.html" class="sidebar-link">258-Architecting Your App for Multiple Windows</a></li><li><a href="/notebook/wwdc/2019/documents/259.html" class="sidebar-link">259-Targeting Content with Multiple Windows</a></li><li><a href="/notebook/wwdc/2019/documents/401.html" class="sidebar-link">401-What's New in Xcode</a></li><li><a href="/notebook/wwdc/2019/documents/402.html" aria-current="page" class="active sidebar-link">402-What's New in Swift</a></li><li><a href="/notebook/wwdc/2019/documents/403.html" class="sidebar-link">403-Creating Great Localized Experiences with Xcode 11</a></li><li><a href="/notebook/wwdc/2019/documents/408.html" class="sidebar-link">408-Adopting Swift Packages in Xcode</a></li><li><a href="/notebook/wwdc/2019/documents/410.html" class="sidebar-link">410-Creating Swift Packages</a></li><li><a href="/notebook/wwdc/2019/documents/413.html" class="sidebar-link">413-Testing in Xcode</a></li><li><a href="/notebook/wwdc/2019/documents/416.html" class="sidebar-link">416-Binary Frameworks in Swift</a></li><li><a href="/notebook/wwdc/2019/documents/511.html" class="sidebar-link">511-Supporting Dark Mode in Your Web Content</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2020</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <a href="/notebook/wwdc/" class="back-to-list"><img src="/assets/img/back.png" width="20"> 返回列表
  </a> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-sidebar-content"><div itemprop="articleBody" class="content__default"><h1 id="_402-what-s-new-in-swift"><a href="#_402-what-s-new-in-swift" class="header-anchor">#</a> 402-What's New in Swift</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <ul><li><a href="#shared-swift-runtime-for-apps">Shared Swift Runtime for Apps</a></li> <li><a href="#binary-frameworks">Binary Frameworks</a></li> <li><a href="#library-evolution">Library Evolution</a></li> <li><a href="#shared-swift-runtime-for-apps">Shared Swift Runtime for Apps</a></li> <li><a href="#utf-8-string">UTF-8 String</a></li> <li><a href="#swift-tooling-and-open-source">Swift Tooling and Open Source</a></li> <li><a href="#language-and-standard-library">Language and Standard Library</a></li></ul> <h2 id="binary-frameworks"><a href="#binary-frameworks" class="header-anchor">#</a> Binary Frameworks</h2> <p><a href="https://swift.org/blog/abi-stability-and-more/" target="_blank" rel="noopener noreferrer">ABI Stability and More<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://onevcat.com/2019/02/swift-abi/" target="_blank" rel="noopener noreferrer">Swift ABI 稳定对我们到底意味着什么<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://swift.org/blog/abi-stability-and-apple/" target="_blank" rel="noopener noreferrer">Evolving Swift On Apple Platforms After ABI Stability<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Module + ABI stability
= Binary frameworks</p> <p>详情请看 <a href="/notebook/wwdc/2019/documents/416-Binary Frameworks in Swift.html">Binary Frameworks in Swift</a></p> <h3 id="什么是-abi-stability"><a href="#什么是-abi-stability" class="header-anchor">#</a> 什么是 ABI Stability</h3> <p>ABI = “Application Binary Interface”</p> <p>Specifies details of a program’s representation at runtime</p> <p>Compatible ABIs allows separately compiled code to interact at runtime</p> <p>ABI 决定了编译后的代码在运行时如何交互，比如像函数调用这样的细节。</p> <p>它到底是怎么工作的？参数中的值如何从调用方传递到被调用方？可用的元数据是什么？它在内存中是如何布局的？所有这些细节都是编译后的代码进行交互所必需的。</p> <p>Exec 使用来自 Framework 的 API，它们必须能够在运行时相互通信。为了让这个工作，他们必须有一个兼容的 ABI。Exec 和 Framework 是独立编译的，但编译后的代码需要协同工作。在 ABI 稳定性之前，我们唯一的保证是，如果使用同一个编译器构建这些 ABI，它们将具有兼容的 ABI。所以 ABI Stability 以前，编译的 App Bundle 里面有 Swift runtime。</p> <p>在 Swift 5 中，我们已经明确了这些细节，Swift 5 现在具有 ABI 稳定性，这意味着 App 和 Framework 不再需要用同一个编译器构建，只要它们是用 Swift 5 编译器或更高版本构建的就可以了。Swift runtime 已经存在 iOS 、macOS、tvOS 以及 watchOS 系统里了。</p> <p><img src="/assets/img/402-1.25d5288d.png" alt=""></p> <p><img src="/assets/img/402-2.f73b6ac0.png" alt=""></p> <h3 id="abi-stability-带来的好处"><a href="#abi-stability-带来的好处" class="header-anchor">#</a> ABI Stability 带来的好处</h3> <ol><li>App Size 减少。对于 iOS 12.2 的系统，因为它们预装了 Swift 5 的 runtime，所以不再需要 Swift 的库，它们会被从 app bundle 中删掉。</li> <li>因为系统集成了 Swift，所以大家都用同一个 Swift 了，App 启动的时候也就不需要额外加载 Swift，所以在新系统上会更快更省内存。</li> <li>对于 Apple 的工程师来说，他们终于能在系统的框架里使用 Swift 了。这样一来，很多东西就不必通过 Objective-C wrap 一遍，这会让代码运行效率提高很多。</li></ol> <h3 id="abi-stability-带来的坏处"><a href="#abi-stability-带来的坏处" class="header-anchor">#</a> ABI Stability 带来的坏处</h3> <p>在 ABI 稳定之前，Swift runtime 是作为开发工具的一部分，被作为库打包到 app 中的。这样一来，在开发时，我们可以随意使用新版本 Swift 的类型或特性，因为它们的版本是开发者自己决定的。不过，当 ABI 稳定后，Swift runtime 变为了用户系统的一部分，它从开发工具，变为了运行的环境，不再由我们开发者唯一决定。比如说，对应 iOS 13 的 Swift 5.1 的标准库中添加了某个类型 <code>A</code>，但是在 iOS 12.2 这个只搭载了 Swift 5 的系统中，并没有这个类型。这意味着我们需要在使用 Swift 的时候考虑设备兼容的问题：如果你需要兼容那些搭载了旧版本 Swift 的系统，那你将无法在代码里使用新版本的 Swift runtime 特性。</p> <p>这和我们一直以来适配新系统的 API 时候的情况差不多，在 Swift 5 以后，我们需要等到 deploy target 升级到对应的版本，才能开始使用对应的 Swift 特性。这意味着，我们可能会需要写一些这样的兼容代码：</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">if</span> #<span class="token function">available</span><span class="token punctuation">(</span>iOS <span class="token number">13.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Swift 5.1 标准库中存在 A</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不存在 A 时的处理</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>对于&quot;新添加的某个类型&quot;这种程度的兼容，我们可以用上面的方式处理。但是对于更靠近语言层面的一些东西 (比如现在已有的 <code>Codable</code> 这样的特性)，恐怕适配起来就没有那么简单了。在未来，Deployment target 可能会和 Swift 语言版本挂钩，新的语言特性出现后，我们可能需要等待一段时间才能实际用上。而除了那些纯编译期间的内容外，任何与 Swift runtime 有关的特性，都会要遵守这个规则。</p> <h3 id="什么是-module-stability"><a href="#什么是-module-stability" class="header-anchor">#</a> 什么是 Module Stability</h3> <p>Swift libraries and the APIs they export are known as “modules”</p> <p>ABI Stability 是关于在运行时混合不同的 Swift 版本。Module Stability 是关于编译时，主要是针对App使用的第三方库。以前用 Carthage 管理第三方库，当升级 Xcode 时，重新编译 App 的时候，经常提示第三库不是用当前编译器编译的，Module Stability 就是用来解决这个问题的。</p> <p>以前，如果使用一个 Framework提供的 API，则这些 API 称为模块，是共享命名空间的一部分。当 Swift 编译器构建该 Framework 时，它会生成该 Framework 中所有 API 的清单(manifest)，这个清单被称为 Swift module file。Swift module file与当前的 Swift 编译器绑定，这意味着如果 Framework 是用不同版本的 Swift 编译器构建的，应用程序开发人员就无法导入这个Framework。也就是说，应用程序开发人员和库作者必须使用相同版本的编译器。</p> <p>在 Swift 5.1中，我们引入了一个新的补充清单，它被称为 Swift module interface file，它更像是一个源文件。框架可以使用它来提供一个稳定的接口。现在 App 和 Framework 可以用不同的编译器进行编译。
<img src="/assets/img/402-3.c14b764a.png" alt=""></p> <p><img src="/assets/img/402-4.9b6f12ab.png" alt=""></p> <h2 id="library-evolution"><a href="#library-evolution" class="header-anchor">#</a> Library Evolution</h2> <p>现在，当 Swift Library 发生变化时，任何使用该 Library 的 App 必须重新编译。优点：因为编译器知道应用程序正在使用的 Library 的确切版本，所以它可以做出额外的假设，从而减少代码大小并使 App 运行得更快。但这些假设在 Library 的下一个版本的中可能不成立。</p> <p>Library Evolution：发布 Library 新版本时，不需要重新编译 App。</p> <p>Swift 已经实现了对 Library Evolution 的支持，非正式地称为<strong>弹性(resilience)</strong>。对于需要它的 Library 来说，这是一个可选的特性，它使用还没有定稿的标注在性能和未来灵活性之间取得平衡。这在标准库的源代码中可以看到。在 Swift 4.2（<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0193-cross-module-inlining-and-specialization.md" target="_blank" rel="noopener noreferrer">SE-0193<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）中添加了@inlineable，这是第一个 Swift Evolution 过程，期待将来更多关于 Swift Evolution 的提议。</p> <h2 id="shared-swift-runtime-for-apps"><a href="#shared-swift-runtime-for-apps" class="header-anchor">#</a> Shared Swift Runtime for Apps</h2> <p>In the OS</p> <ul><li>iOS 12.2</li> <li>macOS 10.14.4</li> <li>tvOS 12.2</li> <li>watchOS 5.2</li></ul> <p>iOS 12.2 及以上的系统使用 iOS 系统里的 Swift Runtime，iOS 12.2 以下的系统使用App Bundle里的 Swift Runtime。</p> <p>从 App Store 下载 App 时，如果 target 运行的是 iOS 12.2 及以上的系统，则thins out runtime copy。</p> <h3 id="疑问"><a href="#疑问" class="header-anchor">#</a> 疑问</h3> <p>Swift 5.1 的新特性能正常运行在 iOS 12.2（Swift 5 Runtime）上吗？</p> <p>答：有的可以，有的不可以</p> <p>比如 <strong>Opaque return types</strong> 这个新特性就不行，必须运行在iOS 13上，而 <strong>Property Wrappers</strong>  和 <strong>Implicit returns from single-expression functions</strong> 这个新特性就可以。如果不能运行 Xcode 编译时会提示。</p> <h2 id="utf-8-string"><a href="#utf-8-string" class="header-anchor">#</a> UTF-8 String</h2> <p>出于性能考虑，Swift 5 将 string 的编码方式由 UTF-16 转化为UTF-8， <a href="https://swift.org/blog/utf8-string/" target="_blank" rel="noopener noreferrer">UTF-8 String<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/assets/img/402-5.c5e02e2f.png" alt=""></p> <p>String 结构变化
<img src="/assets/img/402-6.75d10d77.png" alt=""></p> <h2 id="swift-tooling-and-open-source"><a href="#swift-tooling-and-open-source" class="header-anchor">#</a> Swift Tooling and Open Source</h2> <h3 id="swiftnio"><a href="#swiftnio" class="header-anchor">#</a> SwiftNIO</h3> <p><a href="https://github.com/apple/swift-nio" target="_blank" rel="noopener noreferrer">SwiftNIO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a cross-platform asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients.</p> <h4 id="sourcekit-lsp"><a href="#sourcekit-lsp" class="header-anchor">#</a> SourceKit-LSP</h4> <p><a href="https://github.com/apple/sourcekit-lsp" target="_blank" rel="noopener noreferrer">SourceKit-LSP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: Language Server Protocol implementation for Swift and C-based languages.  The SourceKit-LSP defines the protocol used between the editor or IDE and a language server that provides language features like autocomplete, jump to definition, or find our references. Using SourceKit-LSP, IDEs are editors which support the language server protocol, get these features for Swift packages.
<img src="/assets/img/402-7.fe9200b9.png" alt=""></p> <h2 id="language-and-standard-library"><a href="#language-and-standard-library" class="header-anchor">#</a> Language and Standard Library</h2> <p><a href="https://github.com/cp3hnu/What-s-New-in-Swift" target="_blank" rel="noopener noreferrer">What‘s New in Swift<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#overview" title="Overview">Overview</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#binary-frameworks" title="Binary Frameworks">Binary Frameworks</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#什么是-abi-stability" title="什么是 ABI Stability">什么是 ABI Stability</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#abi-stability-带来的好处" title="ABI Stability 带来的好处">ABI Stability 带来的好处</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#abi-stability-带来的坏处" title="ABI Stability 带来的坏处">ABI Stability 带来的坏处</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#什么是-module-stability" title="什么是 Module Stability">什么是 Module Stability</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#library-evolution" title="Library Evolution">Library Evolution</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#shared-swift-runtime-for-apps" title="Shared Swift Runtime for Apps">Shared Swift Runtime for Apps</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#疑问" title="疑问">疑问</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#utf-8-string" title="UTF-8 String">UTF-8 String</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#swift-tooling-and-open-source" title="Swift Tooling and Open Source">Swift Tooling and Open Source</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#swiftnio" title="SwiftNIO">SwiftNIO</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#language-and-standard-library" title="Language and Standard Library">Language and Standard Library</a></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b07256e7.js" defer></script><script src="/assets/js/34.49b71b2c.js" defer></script><script src="/assets/js/5.373c53f3.js" defer></script><script src="/assets/js/16.eb29ed80.js" defer></script>
  </body>
</html>
