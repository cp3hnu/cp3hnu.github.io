<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>223-Drag and Drop with Collection and Table View | Study &amp; Product</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="
Drag and Drop

UITableViewDragDelegate

protocol UITableViewDragDelegate : NSObjectProtocol {
  /// 提供 drag 的内容, 看 UIDragItem 详解
  func tableView(_ tableView: UITableView, itemsForBe ...">
    <meta name="algolia-site-verification" content="23333450F18E92C1">
    
    <link rel="preload" href="/assets/css/0.styles.cd1f7b12.css" as="style"><link rel="preload" href="/assets/js/app.b07256e7.js" as="script"><link rel="preload" href="/assets/js/34.49b71b2c.js" as="script"><link rel="preload" href="/assets/js/5.373c53f3.js" as="script"><link rel="preload" href="/assets/js/111.252f143f.js" as="script"><link rel="prefetch" href="/assets/js/10.7c5bc6fc.js"><link rel="prefetch" href="/assets/js/100.f675d046.js"><link rel="prefetch" href="/assets/js/101.92ede1ec.js"><link rel="prefetch" href="/assets/js/102.678a907d.js"><link rel="prefetch" href="/assets/js/103.959ad108.js"><link rel="prefetch" href="/assets/js/104.b15677eb.js"><link rel="prefetch" href="/assets/js/105.377da8a5.js"><link rel="prefetch" href="/assets/js/106.29a8c44d.js"><link rel="prefetch" href="/assets/js/107.64b19904.js"><link rel="prefetch" href="/assets/js/108.a3e75a67.js"><link rel="prefetch" href="/assets/js/109.283d92d8.js"><link rel="prefetch" href="/assets/js/11.e6a0311f.js"><link rel="prefetch" href="/assets/js/110.cbb6ea81.js"><link rel="prefetch" href="/assets/js/112.df62c9fe.js"><link rel="prefetch" href="/assets/js/113.66189350.js"><link rel="prefetch" href="/assets/js/114.890cd7de.js"><link rel="prefetch" href="/assets/js/115.53823707.js"><link rel="prefetch" href="/assets/js/116.caaa6eaa.js"><link rel="prefetch" href="/assets/js/117.b7b0f88f.js"><link rel="prefetch" href="/assets/js/118.03168974.js"><link rel="prefetch" href="/assets/js/119.90f4d7b7.js"><link rel="prefetch" href="/assets/js/12.8da07182.js"><link rel="prefetch" href="/assets/js/120.b654e5ee.js"><link rel="prefetch" href="/assets/js/121.92d87086.js"><link rel="prefetch" href="/assets/js/13.a9f90626.js"><link rel="prefetch" href="/assets/js/14.b18d5210.js"><link rel="prefetch" href="/assets/js/15.835c7671.js"><link rel="prefetch" href="/assets/js/16.eb29ed80.js"><link rel="prefetch" href="/assets/js/17.c4871518.js"><link rel="prefetch" href="/assets/js/18.606b879c.js"><link rel="prefetch" href="/assets/js/19.777086a8.js"><link rel="prefetch" href="/assets/js/20.c8e69fcc.js"><link rel="prefetch" href="/assets/js/21.6cda2658.js"><link rel="prefetch" href="/assets/js/22.19e356e1.js"><link rel="prefetch" href="/assets/js/23.ca8661ea.js"><link rel="prefetch" href="/assets/js/24.9f090eaf.js"><link rel="prefetch" href="/assets/js/25.be2c8a0c.js"><link rel="prefetch" href="/assets/js/26.5ce52eaa.js"><link rel="prefetch" href="/assets/js/27.d75e1151.js"><link rel="prefetch" href="/assets/js/28.6863d7e4.js"><link rel="prefetch" href="/assets/js/29.d8a1c4f2.js"><link rel="prefetch" href="/assets/js/3.276926dd.js"><link rel="prefetch" href="/assets/js/30.178b8dc0.js"><link rel="prefetch" href="/assets/js/31.4c488d0e.js"><link rel="prefetch" href="/assets/js/32.ce3ae3c7.js"><link rel="prefetch" href="/assets/js/33.828dd0d1.js"><link rel="prefetch" href="/assets/js/35.9496ed4c.js"><link rel="prefetch" href="/assets/js/36.33ada8e1.js"><link rel="prefetch" href="/assets/js/37.e9705ffe.js"><link rel="prefetch" href="/assets/js/38.f9c57096.js"><link rel="prefetch" href="/assets/js/39.75b77f83.js"><link rel="prefetch" href="/assets/js/4.c651aa9d.js"><link rel="prefetch" href="/assets/js/40.4496a5db.js"><link rel="prefetch" href="/assets/js/41.260393e3.js"><link rel="prefetch" href="/assets/js/42.083f9350.js"><link rel="prefetch" href="/assets/js/43.8d311a8e.js"><link rel="prefetch" href="/assets/js/44.df55763b.js"><link rel="prefetch" href="/assets/js/45.e19037c7.js"><link rel="prefetch" href="/assets/js/46.9529f37b.js"><link rel="prefetch" href="/assets/js/47.8d631e39.js"><link rel="prefetch" href="/assets/js/48.3acad59c.js"><link rel="prefetch" href="/assets/js/49.9a12a900.js"><link rel="prefetch" href="/assets/js/50.f30877b8.js"><link rel="prefetch" href="/assets/js/51.e8b2adf9.js"><link rel="prefetch" href="/assets/js/52.e6a458bb.js"><link rel="prefetch" href="/assets/js/53.e4027d0c.js"><link rel="prefetch" href="/assets/js/54.5a4be38d.js"><link rel="prefetch" href="/assets/js/55.924ee4f8.js"><link rel="prefetch" href="/assets/js/56.11ff1ccf.js"><link rel="prefetch" href="/assets/js/57.14327960.js"><link rel="prefetch" href="/assets/js/58.cea182b0.js"><link rel="prefetch" href="/assets/js/59.2db874c7.js"><link rel="prefetch" href="/assets/js/6.6878fac4.js"><link rel="prefetch" href="/assets/js/60.e3e4017b.js"><link rel="prefetch" href="/assets/js/61.d5cd385e.js"><link rel="prefetch" href="/assets/js/62.6929f93f.js"><link rel="prefetch" href="/assets/js/63.3f8bf719.js"><link rel="prefetch" href="/assets/js/64.e89e1572.js"><link rel="prefetch" href="/assets/js/65.a4335c65.js"><link rel="prefetch" href="/assets/js/66.cc9fb484.js"><link rel="prefetch" href="/assets/js/67.d5da8f2f.js"><link rel="prefetch" href="/assets/js/68.91a38f6d.js"><link rel="prefetch" href="/assets/js/69.800ca600.js"><link rel="prefetch" href="/assets/js/7.6f2558ea.js"><link rel="prefetch" href="/assets/js/70.f7b16ee7.js"><link rel="prefetch" href="/assets/js/71.e34929dc.js"><link rel="prefetch" href="/assets/js/72.175a64bf.js"><link rel="prefetch" href="/assets/js/73.c3dcfd4b.js"><link rel="prefetch" href="/assets/js/74.65978082.js"><link rel="prefetch" href="/assets/js/75.718d5152.js"><link rel="prefetch" href="/assets/js/76.2ed620b3.js"><link rel="prefetch" href="/assets/js/77.f8726387.js"><link rel="prefetch" href="/assets/js/78.1dea2e59.js"><link rel="prefetch" href="/assets/js/79.f62213a1.js"><link rel="prefetch" href="/assets/js/8.81ebcef8.js"><link rel="prefetch" href="/assets/js/80.7600ac29.js"><link rel="prefetch" href="/assets/js/81.ab94746f.js"><link rel="prefetch" href="/assets/js/82.26baf7f8.js"><link rel="prefetch" href="/assets/js/83.89a3942a.js"><link rel="prefetch" href="/assets/js/84.1a5577ac.js"><link rel="prefetch" href="/assets/js/85.eb62de22.js"><link rel="prefetch" href="/assets/js/86.7635121c.js"><link rel="prefetch" href="/assets/js/87.5bee4d72.js"><link rel="prefetch" href="/assets/js/88.04d56860.js"><link rel="prefetch" href="/assets/js/89.09a7d920.js"><link rel="prefetch" href="/assets/js/9.7f69b9b1.js"><link rel="prefetch" href="/assets/js/90.dac6a66e.js"><link rel="prefetch" href="/assets/js/91.14f101dd.js"><link rel="prefetch" href="/assets/js/92.d398eb09.js"><link rel="prefetch" href="/assets/js/93.7a5477fa.js"><link rel="prefetch" href="/assets/js/94.c4bf7674.js"><link rel="prefetch" href="/assets/js/95.a0c3c94c.js"><link rel="prefetch" href="/assets/js/96.c3a44db5.js"><link rel="prefetch" href="/assets/js/97.6956ed39.js"><link rel="prefetch" href="/assets/js/98.ad65fe08.js"><link rel="prefetch" href="/assets/js/99.4fe76e2f.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.cb5d1302.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd1f7b12.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Study &amp; Product </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/notebook/" class="nav-link router-link-active">Notebook</a></li><li class="nav-item"><a href="/about/" class="nav-link">About</a></li><li class="nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Study &amp; Product </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/notebook/" class="nav-link router-link-active">Notebook</a></li><li class="mobile-nav-item"><a href="/about/" class="nav-link">About</a></li><li class="mobile-nav-item"><a href="https://github.com/cp3hnu" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper index-page"><div id="vuepress-theme-blog__post-layout"><aside class="sidebar"> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/notebook/wwdc/" class="sidebar-heading clickable router-link-active open"><span>WWDC</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>2017</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/wwdc/2017/documents/220.html" class="sidebar-link">220-Customized Loading in WKWebView</a></li><li><a href="/notebook/wwdc/2017/documents/223.html" aria-current="page" class="active sidebar-link">223-Drag and Drop with Collection and Table View</a></li><li><a href="/notebook/wwdc/2017/documents/225.html" class="sidebar-link">225-What's new in Safari View Controller</a></li><li><a href="/notebook/wwdc/2017/documents/401.html" class="sidebar-link">401-Localizing with Xcode 9</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2019</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2020</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <a href="/notebook/wwdc/" class="back-to-list"><img src="/assets/img/back.png" width="20"> 返回列表
  </a> <article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-sidebar-content"><div itemprop="articleBody" class="content__default"><h1 id="_223-drag-and-drop-with-collection-and-table-view"><a href="#_223-drag-and-drop-with-collection-and-table-view" class="header-anchor">#</a> 223-Drag and Drop with Collection and Table View</h1> <h2 id="drag-and-drop"><a href="#drag-and-drop" class="header-anchor">#</a> Drag and Drop</h2> <h3 id="uitableviewdragdelegate"><a href="#uitableviewdragdelegate" class="header-anchor">#</a> UITableViewDragDelegate</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">protocol</span> <span class="token builtin">UITableViewDragDelegate</span> <span class="token punctuation">:</span> <span class="token builtin">NSObjectProtocol</span> <span class="token punctuation">{</span>
  <span class="token comment">/// 提供 drag 的内容, 看 UIDragItem 详解</span>
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> itemsForBeginning session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">,</span> at indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">UIDragItem</span><span class="token punctuation">]</span>
  <span class="token comment">/// 在 drag 的过程中，点击添加新 item</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> itemsForAddingTo session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">,</span> at indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> point<span class="token punctuation">:</span> <span class="token builtin">CGPoint</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">UIDragItem</span><span class="token punctuation">]</span>
  <span class="token comment">/// drag 开始和结束</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragSessionWillBegin session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">)</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragSessionDidEnd session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">)</span>

  <span class="token comment">/// 移动操作是否允许(默认允许)  </span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragSessionAllowsMoveOperation session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>
  
  <span class="token comment">/// 是否必须 drop 在当前应用(默认否)</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragSessionIsRestrictedToDraggingApplication session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>
  <span class="token comment">/// 自定义一些参数控制 drag 时 cell 的展示</span>
  <span class="token comment">/// Mac Catalyst 不起作用</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragPreviewParametersForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIDragPreviewParameters</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="uitableviewdropdelegate"><a href="#uitableviewdropdelegate" class="header-anchor">#</a> UITableViewDropDelegate</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">protocol</span> <span class="token builtin">UITableViewDropDelegate</span> <span class="token punctuation">:</span> <span class="token builtin">NSObjectProtocol</span> <span class="token punctuation">{</span>
  <span class="token comment">/// 接受 drop, 看 UITableViewDropCoordinator 详解</span>
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> performDropWith coordinator<span class="token punctuation">:</span> <span class="token builtin">UITableViewDropCoordinator</span><span class="token punctuation">)</span>

  <span class="token comment">/// tableView 能否接受 drop, 一般是判断 drag item 的数据类型     </span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> canHandle session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>
  
  <span class="token comment">/// 看 UITableViewDropProposal 详解</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropSessionDidUpdate session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">,</span> withDestinationIndexPath destinationIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UITableViewDropProposal</span>

  <span class="token comment">/// 进入、离开以及结束</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropSessionDidEnter session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">)</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropSessionDidExit session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">)</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropSessionDidEnd session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">)</span>

  <span class="token comment">//// 自定义一些参数控制 drop 时 cell 的展示</span>
  <span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropPreviewParametersForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIDragPreviewParameters</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="uidragitem"><a href="#uidragitem" class="header-anchor">#</a> UIDragItem</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">init</span><span class="token punctuation">(</span>itemProvider<span class="token punctuation">:</span> <span class="token builtin">NSItemProvider</span><span class="token punctuation">)</span>
<span class="token comment">/// 与 item 关联自定义的对象，只能用于本App</span>
<span class="token keyword">var</span> localObject<span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="nsitemprovider"><a href="#nsitemprovider" class="header-anchor">#</a> NSItemProvider</h3> <p>drag/drop, copy/paste, app/extension的数据核心</p> <p>提供四种方式</p> <ul><li>fileUrl</li> <li>实现 <em>NSItemProviderWriting</em> 协议的对象，NSString, UIImage 实现了这个协议</li> <li>实现 <em>NSSecureCoding</em> 协议的对象</li> <li>register data</li></ul> <h3 id="uitableviewdropproposal"><a href="#uitableviewdropproposal" class="header-anchor">#</a> UITableViewDropProposal</h3> <p>继承 UIDropProposal，有两个属性</p> <ul><li>operation:
<ul><li>cancel</li> <li>forbidden</li> <li>move</li> <li>copy</li></ul></li> <li>indent
<ul><li>unspecified</li> <li>insertAtDestinationIndexPath</li> <li>insertIntoDestinationIndexPath</li> <li>automatic</li></ul></li></ul> <h3 id="uitableviewdropcoordinator"><a href="#uitableviewdropcoordinator" class="header-anchor">#</a> UITableViewDropCoordinator</h3> <p>取得 drag item, destination indexPath, drop session, proposal 属性，以及执行插入动画</p> <h3 id="uidragsession"><a href="#uidragsession" class="header-anchor">#</a> UIDragSession</h3> <p>继承 UIDragDropSession</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">/// 自定义数据，只能用于 in-app</span>
<span class="token keyword">var</span> localContext<span class="token punctuation">:</span> <span class="token builtin">Any</span><span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token keyword">set</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="uidropsession"><a href="#uidropsession" class="header-anchor">#</a> UIDropSession</h3> <p>同样继承 UIDragDropSession</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">/// 取出 drag 数据，completion 运行在主线程上</span>
<span class="token keyword">func</span> <span class="token function">loadObjects</span><span class="token punctuation">(</span>ofClass aClass<span class="token punctuation">:</span> <span class="token builtin">NSItemProviderReading</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">,</span> completion<span class="token punctuation">:</span> @escaping <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">NSItemProviderReading</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Void</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Progress</span>

<span class="token comment">/// 对应的 drag session，只能用于 in-app drag</span>
<span class="token keyword">var</span> localDragSession<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="uidragdropsession"><a href="#uidragdropsession" class="header-anchor">#</a> UIDragDropSession</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">var</span> items<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">UIDragItem</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
<span class="token comment">/// drag location</span>

<span class="token keyword">func</span> <span class="token function">location</span><span class="token punctuation">(</span><span class="token keyword">in</span> view<span class="token punctuation">:</span> <span class="token builtin">UIView</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">CGPoint</span>

<span class="token comment">/// 可以 move </span>
<span class="token keyword">var</span> allowsMoveOperation<span class="token punctuation">:</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
    
<span class="token comment">/// 只能用于 in-app</span>
<span class="token keyword">var</span> isRestrictedToDraggingApplication<span class="token punctuation">:</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>

<span class="token comment">/// 至少有一个drag item 是 specified UTIs 类型的</span>
<span class="token keyword">func</span> <span class="token function">hasItemsConforming</span><span class="token punctuation">(</span>toTypeIdentifiers typeIdentifiers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>

<span class="token comment">/// 至少有一个drag item 是 NSItemProviderReading 类</span>
<span class="token keyword">func</span> <span class="token function">canLoadObjects</span><span class="token punctuation">(</span>ofClass aClass<span class="token punctuation">:</span> <span class="token builtin">NSItemProviderReading</span><span class="token punctuation">.</span><span class="token keyword">Type</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// Drag</span>
<span class="token keyword">extension</span> <span class="token builtin">RepoController</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewDragDelegate</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> itemsForBeginning session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">,</span> at indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">UIDragItem</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> repo <span class="token operator">=</span> <span class="token function">getRepo</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span>
    <span class="token keyword">let</span> itemProvider <span class="token operator">=</span> <span class="token function">NSItemProvider</span><span class="token punctuation">(</span>object<span class="token punctuation">:</span> <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">\(</span>repo<span class="token punctuation">.</span>id<span class="token delimiter variable">)</span></span>&quot;</span> <span class="token keyword">as</span> <span class="token builtin">NSItemProviderWriting</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token function">UIDragItem</span><span class="token punctuation">(</span>itemProvider<span class="token punctuation">:</span> itemProvider<span class="token punctuation">)</span>
    item<span class="token punctuation">.</span>localObject <span class="token operator">=</span> repo
    <span class="token keyword">return</span> <span class="token punctuation">[</span>item<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
    
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> itemsForAddingTo session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">,</span> at indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> point<span class="token punctuation">:</span> <span class="token builtin">CGPoint</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">UIDragItem</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>  
    <span class="token keyword">let</span> repo <span class="token operator">=</span> <span class="token function">getRepo</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> indexPath<span class="token punctuation">)</span>
    <span class="token keyword">let</span> itemProvider <span class="token operator">=</span> <span class="token function">NSItemProvider</span><span class="token punctuation">(</span>object<span class="token punctuation">:</span> <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">\(</span>repo<span class="token punctuation">.</span>id<span class="token delimiter variable">)</span></span>&quot;</span> <span class="token keyword">as</span> <span class="token builtin">NSItemProviderWriting</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> item <span class="token operator">=</span> <span class="token function">UIDragItem</span><span class="token punctuation">(</span>itemProvider<span class="token punctuation">:</span> itemProvider<span class="token punctuation">)</span>
    item<span class="token punctuation">.</span>localObject <span class="token operator">=</span> repo
    <span class="token keyword">return</span> <span class="token punctuation">[</span>item<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragSessionIsRestrictedToDraggingApplication session<span class="token punctuation">:</span> <span class="token builtin">UIDragSession</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Drop</span>
<span class="token keyword">extension</span> <span class="token builtin">GroupCtrlr</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewDropDelegate</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> performDropWith coordinator<span class="token punctuation">:</span> <span class="token builtin">UITableViewDropCoordinator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">guard</span> <span class="token keyword">let</span> dest <span class="token operator">=</span> coordinator<span class="token punctuation">.</span>destinationIndexPath <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 方法一, 使用 UIDropSession</span>
      coordinator<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">loadObjects</span><span class="token punctuation">(</span>ofClass<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> ids <span class="token keyword">in</span>
        <span class="token comment">// 主线程</span>
        <span class="token keyword">for</span> id <span class="token keyword">in</span> ids <span class="token punctuation">{</span>
          <span class="token keyword">let</span> repo <span class="token operator">=</span> <span class="token function">getRepo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    	  group<span class="token punctuation">.</span><span class="token function">addToRepo</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        tableview<span class="token punctuation">.</span><span class="token function">reloadSections</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> with<span class="token punctuation">:</span> <span class="token punctuation">.</span>automatic<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 方法二，使用 NSItemProvider</span>
      <span class="token keyword">let</span> dragItems <span class="token operator">=</span> coordinator<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token builtin">map</span> <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span>dragItem <span class="token punctuation">}</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> dragItems <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span>itemProvider<span class="token punctuation">.</span><span class="token function">loadObject</span><span class="token punctuation">(</span>ofClass<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
              <span class="token comment">/// 子线程</span>
              <span class="token keyword">if</span> <span class="token keyword">let</span> id <span class="token operator">=</span> value <span class="token punctuation">{</span>
                <span class="token keyword">let</span> repo <span class="token operator">=</span> <span class="token function">getRepo</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    	  	    group<span class="token punctuation">.</span><span class="token function">addToRepo</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span>
                 coordinator<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> toRowAt<span class="token punctuation">:</span> dest<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// 方法三，使用 localObject (in-app)</span>
        <span class="token keyword">let</span> repos <span class="token operator">=</span> coordinator<span class="token punctuation">.</span>items<span class="token punctuation">.</span>compactMap <span class="token punctuation">{</span> $<span class="token number">0</span><span class="token punctuation">.</span>dragItem<span class="token punctuation">.</span>localObject <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Repo</span> <span class="token punctuation">}</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dropSessionDidUpdate session<span class="token punctuation">:</span> <span class="token builtin">UIDropSession</span><span class="token punctuation">,</span> withDestinationIndexPath destinationIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UITableViewDropProposal</span> <span class="token punctuation">{</span>
    <span class="token keyword">guard</span> <span class="token keyword">let</span> dest <span class="token operator">=</span> destinationIndexPath<span class="token punctuation">,</span> dest<span class="token punctuation">.</span>section <span class="token operator">==</span> <span class="token number">2</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">UITableViewDropProposal</span><span class="token punctuation">(</span>operation<span class="token punctuation">:</span> <span class="token punctuation">.</span>forbidden<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
        
    <span class="token keyword">return</span> <span class="token function">UITableViewDropProposal</span><span class="token punctuation">(</span>operation<span class="token punctuation">:</span> <span class="token punctuation">.</span>copy<span class="token punctuation">,</span> intent<span class="token punctuation">:</span> <span class="token punctuation">.</span>insertIntoDestinationIndexPath<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h2 id="placeholder"><a href="#placeholder" class="header-anchor">#</a> PlaceHolder</h2> <p>Drop 时需要异步加载数据，临时插入的占位符</p> <p>Avoid <code>reloadData</code> , use <code>performBatchUpdates(_:completion:)</code> instead</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">/// Indicate whether the collection view contains drop placeholders or is reordering its items as part of handling a drop.</span>
<span class="token keyword">var</span> hasUncommittedUpdates<span class="token punctuation">:</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="demo-2"><a href="#demo-2" class="header-anchor">#</a> Demo</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">extension</span> <span class="token builtin">ViewCtrlr</span><span class="token punctuation">:</span> <span class="token builtin">UITableViewDropDelegate</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> performDropWith coordinator<span class="token punctuation">:</span> <span class="token builtin">UITableViewDropCoordinator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> item <span class="token keyword">in</span> coordinator<span class="token punctuation">.</span>items <span class="token punctuation">{</span>
    <span class="token keyword">let</span> placeholderContext <span class="token operator">=</span> coordinator<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>dragItem<span class="token punctuation">,</span> toPlaceholderInsertedAt<span class="token punctuation">:</span> destinationIndexPath<span class="token punctuation">,</span> withReuseIdentifier<span class="token punctuation">:</span> <span class="token string">&quot;PlaceholderCell&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> cell <span class="token keyword">in</span>
	  <span class="token comment">// Configure the placeholder cell</span>
	<span class="token punctuation">}</span>
	item<span class="token punctuation">.</span>dragItem<span class="token punctuation">.</span>itemProvider<span class="token punctuation">.</span><span class="token function">loadObject</span><span class="token punctuation">(</span>ofClass<span class="token punctuation">:</span> <span class="token builtin">UIImage</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>object<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token keyword">in</span>
	  <span class="token builtin">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>async <span class="token punctuation">{</span>
	    <span class="token keyword">if</span> <span class="token keyword">let</span> image <span class="token operator">=</span> object <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">UIImage</span> <span class="token punctuation">{</span>
	      <span class="token comment">// 插入真实数据</span>
	      placeholderContext<span class="token punctuation">.</span>commitInsertion <span class="token punctuation">{</span> insertionIndexPath <span class="token keyword">in</span>
	        <span class="token keyword">self</span><span class="token punctuation">.</span>imagesArray<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> at<span class="token punctuation">:</span> insertionIndexPath<span class="token punctuation">.</span>item<span class="token punctuation">)</span> <span class="token punctuation">}</span>
	      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
	        <span class="token comment">// 删除 place holder </span>
	        placeholderContext<span class="token punctuation">.</span><span class="token function">deletePlaceholder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	      <span class="token punctuation">}</span> 
	    <span class="token punctuation">}</span>
	  <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="supporting-reordering"><a href="#supporting-reordering" class="header-anchor">#</a> Supporting Reordering</h2> <h3 id="collection-view-reordering-cadence"><a href="#collection-view-reordering-cadence" class="header-anchor">#</a> Collection View Reordering Cadence</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">/// indicate the speed at which collection view items are reorganized during a drop</span>
<span class="token keyword">var</span> reorderingCadence<span class="token punctuation">:</span> <span class="token builtin">UICollectionView</span><span class="token punctuation">.</span><span class="token builtin">ReorderingCadence</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token keyword">set</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>immediate</li> <li>fast</li> <li>slow</li></ul> <h3 id="table-view-reordering-in-iphone"><a href="#table-view-reordering-in-iphone" class="header-anchor">#</a> Table View Reordering in iPhone</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">/*
The default value of this property is true on iPad and false on iPhone. Changing the value to true on iPhone makes it possible to drag content from the table view to another app on iPhone and to receive content from other apps.
*/</span>
tableView<span class="token punctuation">.</span>dragInteractionEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
tableView<span class="token punctuation">.</span>dragDelegate <span class="token operator">=</span> <span class="token keyword">self</span>

<span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> moveRowAt sourceIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> to destinationIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做操作</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以前 Table View 实现 Reordering 的方式</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code>tableView<span class="token punctuation">.</span>isEditing <span class="token operator">=</span> <span class="token boolean">true</span> 

<span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> canMoveRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> editingStyleForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UITableViewCell</span><span class="token punctuation">.</span><span class="token builtin">EditingStyle</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token keyword">none</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> shouldIndentWhileEditingRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> moveRowAt sourceIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> to destinationIndexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做操作</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><a href="https://developer.apple.com/documentation/uikit/drag_and_drop/adopting_drag_and_drop_in_a_table_view" target="_blank" rel="noopener noreferrer">Adopting Drag and Drop in a Table View<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="spring-loading"><a href="#spring-loading" class="header-anchor">#</a> Spring Loading</h2> <p>Spring loading is a way to actually navigate and activate controls throughout the system while you're in the middle of a drag session.</p> <p>在 drag 的过程中能激活控件，响应控件事件</p> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token comment">// UITableView 和 UICollectionView 实现了这个协议</span>
<span class="token keyword">protocol</span> <span class="token builtin">UISpringLoadedInteractionSupporting</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> isSpringLoaded<span class="token punctuation">:</span> <span class="token builtin">Bool</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token keyword">set</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果想控制某一行支持Spring loading</span>
<span class="token keyword">protocol</span> <span class="token builtin">UITableViewDelegate</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> shouldSpringLoadRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">,</span> with context<span class="token punctuation">:</span> <span class="token builtin">UISpringLoadedInteractionContext</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">Bool</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="customizing-cell-appearance"><a href="#customizing-cell-appearance" class="header-anchor">#</a> Customizing Cell Appearance</h2> <h3 id="跟踪-drag-状态变化-自定义-cell-appearance"><a href="#跟踪-drag-状态变化-自定义-cell-appearance" class="header-anchor">#</a> 跟踪 drag 状态变化，自定义 cell appearance</h3> <ul><li>none</li> <li>lifting</li> <li>dragging</li></ul> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">func</span> <span class="token function">dragStateDidChange</span><span class="token punctuation">(</span><span class="token number">_</span> dragState<span class="token punctuation">:</span> <span class="token builtin">UITableViewCell</span><span class="token punctuation">.</span><span class="token builtin">DragState</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="preview"><a href="#preview" class="header-anchor">#</a> Preview</h3> <div class="language-swift line-numbers-mode"><pre class="language-swift"><code><span class="token keyword">optional</span> <span class="token keyword">func</span> <span class="token function">tableView</span><span class="token punctuation">(</span><span class="token number">_</span> tableView<span class="token punctuation">:</span> <span class="token builtin">UITableView</span><span class="token punctuation">,</span> dragPreviewParametersForRowAt indexPath<span class="token punctuation">:</span> <span class="token builtin">IndexPath</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">UIDragPreviewParameters</span><span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#drag-and-drop" title="Drag and Drop">Drag and Drop</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uitableviewdragdelegate" title="UITableViewDragDelegate">UITableViewDragDelegate</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uitableviewdropdelegate" title="UITableViewDropDelegate">UITableViewDropDelegate</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uidragitem" title="UIDragItem">UIDragItem</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#nsitemprovider" title="NSItemProvider">NSItemProvider</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uitableviewdropproposal" title="UITableViewDropProposal">UITableViewDropProposal</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uitableviewdropcoordinator" title="UITableViewDropCoordinator">UITableViewDropCoordinator</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uidragsession" title="UIDragSession">UIDragSession</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uidropsession" title="UIDropSession">UIDropSession</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#uidragdropsession" title="UIDragDropSession">UIDragDropSession</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#demo" title="Demo">Demo</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#placeholder" title="PlaceHolder">PlaceHolder</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#demo-2" title="Demo">Demo</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#supporting-reordering" title="Supporting Reordering">Supporting Reordering</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#collection-view-reordering-cadence" title="Collection View Reordering Cadence">Collection View Reordering Cadence</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#table-view-reordering-in-iphone" title="Table View Reordering in iPhone">Table View Reordering in iPhone</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#spring-loading" title="Spring Loading">Spring Loading</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#customizing-cell-appearance" title="Customizing Cell Appearance">Customizing Cell Appearance</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#跟踪-drag-状态变化-自定义-cell-appearance" title="跟踪 drag 状态变化，自定义 cell appearance">跟踪 drag 状态变化，自定义 cell appearance</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#preview" title="Preview">Preview</a></div></div></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b07256e7.js" defer></script><script src="/assets/js/34.49b71b2c.js" defer></script><script src="/assets/js/5.373c53f3.js" defer></script><script src="/assets/js/111.252f143f.js" defer></script>
  </body>
</html>
